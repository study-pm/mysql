# Практические работы

- [Работа 2.O. «Работа в консольном клиенте СУБД MySQL»](#работа-2o-работа-в-консольном-клиенте-субд-mysql)
  - [Задание 2.1.2](#задание-212)
  - [Ход выполнения задания](#ход-выполнения-задания)
  - [Итоговый алгоритм](#итоговый-алгоритм)
- [Работа 3.O. «Создание таблиц»](#работа-3o-создание-таблиц)
  - [Задание 3.1.2](#задание-312)
    - [Описание предметной области](#описание-предметной-области)
  - [Ход выполнения задания](#ход-выполнения-задания-1)
    - [Составление инфологической модели](#составление-инфологической-модели)
    - [Создание базы данных](#создание-базы-данных)
    - [Создание таблиц](#создание-таблиц)
    - [Проверка](#проверка)
  - [Итоговый алгоритм](#итоговый-алгоритм-1)
- [Работа 4.O. «Разработка серверной части базы данных в СУБД MysQL. Изменение структуры таблиц»](#работа-4o-разработка-серверной-части-базы-данных-в-субд-mysql-изменение-структуры-таблиц)
  - [Задание 4.1.2](#задание-412)
    - [Цель работы](#цель-работы)
    - [Условия задач](#условия-задач)
    - [Задача 1](#задача-1)
    - [Задача 2](#задача-2)
    - [Задача 3](#задача-3)
    - [Задача 4](#задача-4)
    - [Задача 5](#задача-5)
    - [Задача 6](#задача-6)
    - [Задача 7](#задача-7)
    - [Задача 8](#задача-8)
    - [Задача 9](#задача-9)
    - [Задача 10](#задача-10)
    - [Задача 11](#задача-11)
    - [Задача 12](#задача-12)
- [Работа 5.O. «Разработка серверной части базы данных в СУБД  MySQL. Создание индексов (простых, уникальных)»](#работа-5o-разработка-серверной-части-базы-данных-в-субд--mysql-создание-индексов-простых-уникальных)
  - [Задание 5.1.2](#задание-512)
    - [Цель работы](#цель-работы-1)
    - [Условия задач](#условия-задач-1)
    - [Задача 1](#задача-1-1)
- [Работа 6.O. «Разработка серверной части базы данных в СУБД  MySQL. Установка ограничений и контроль ссылочной целостности»](#работа-6o-разработка-серверной-части-базы-данных-в-субд--mysql-установка-ограничений-и-контроль-ссылочной-целостности)
  - [Задание 5.1.2](#задание-512-1)
    - [Цель работы](#цель-работы-2)
    - [Условия задач](#условия-задач-2)
    - [Задача 1](#задача-1-2)
    - [Задача 2](#задача-2-1)
    - [Задача 3](#задача-3-1)
    - [Задача 4](#задача-4-1)
- [Работа 7.O. «Создание базы данных в среде MySQL Workbench»](#работа-7o-создание-базы-данных-в-среде-mysql-workbench)
- [Работа 9.O. «Простые запросы на выборку»](#работа-9o-простые-запросы-на-выборку)
  - [Задача 1](#задача-1-3)
  - [Задача 2](#задача-2-2)
  - [Задача 3](#задача-3-2)
  - [Задача 4](#задача-4-2)
  - [Задача 5](#задача-5-1)
  - [Задача 6](#задача-6-1)
  - [Задача 7](#задача-7-1)
  - [Задача 8](#задача-8-1)
- [Работа 10.O. «Специальные операторы в условиях выборки запроса»](#работа-10o-специальные-операторы-в-условиях-выборки-запроса)
  - [Задача 1](#задача-1-4)
  - [Задача 2](#задача-2-3)
  - [Задача 3](#задача-3-3)
  - [Задача 4](#задача-4-3)
  - [Задача 5](#задача-5-2)
  - [Задача 6](#задача-6-2)
  - [Задача 7](#задача-7-2)
  - [Задача 8](#задача-8-2)
  - [Задача 9](#задача-9-1)
  - [Задача 10](#задача-10-1)
- [Работа 11.O. «Создание запросов на выборку с использованием группировки данных»](#работа-11o-создание-запросов-на-выборку-с-использованием-группировки-данных)
  - [Задача 1](#задача-1-5)
  - [Задача 2](#задача-2-4)
  - [Задача 3](#задача-3-4)
  - [Задача 4](#задача-4-4)
  - [Задача 5](#задача-5-3)
  - [Задача 6](#задача-6-3)
  - [Задача 7](#задача-7-3)
  - [Задача 8](#задача-8-3)
- [Работа 12.O. «Создание запросов на выборку с использованием группировки данных»](#работа-12o-создание-запросов-на-выборку-с-использованием-группировки-данных)
  - [Задача 1](#задача-1-6)
  - [Задача 2](#задача-2-5)
  - [Задача 3](#задача-3-5)
  - [Задача 4](#задача-4-5)
  - [Задача 5](#задача-5-4)
  - [Задача 6](#задача-6-4)
- [Работа 13.O. «Создание запросов на объединение нескольких таблиц»](#работа-13o-создание-запросов-на-объединение-нескольких-таблиц)
  - [Задача 1](#задача-1-7)
  - [Задача 2](#задача-2-6)
  - [Задача 3](#задача-3-6)
  - [Задача 4](#задача-4-6)
  - [Задача 5](#задача-5-5)
  - [Задача 6](#задача-6-5)
  - [Задача 7](#задача-7-4)
  - [Задача 8](#задача-8-4)
- [Работа 14.O. «Создание запросов на объединение нескольких запросов»](#работа-14o-создание-запросов-на-объединение-нескольких-запросов)
  - [Задача 1](#задача-1-8)
  - [Задача 2](#задача-2-7)
  - [Задача 3](#задача-3-7)
- [Работа 15.O. «Создание вложенных запросов»](#работа-15o-создание-вложенных-запросов)
  - [Задача 1](#задача-1-9)
  - [Задача 2](#задача-2-8)
  - [Задача 3](#задача-3-8)
  - [Задача 4](#задача-4-7)
  - [Задача 5](#задача-5-6)
  - [Задача 6](#задача-6-6)
- [Работа 16.O. «Создание запросов на изменение данных»](#работа-16o-создание-запросов-на-изменение-данных)
  - [Задача 1](#задача-1-10)
  - [Задача 2](#задача-2-9)
  - [Задача 3](#задача-3-9)
  - [Задача 4](#задача-4-8)
  - [Задача 5](#задача-5-7)
  - [Задача 6](#задача-6-7)
  - [Задача 7](#задача-7-5)
  - [Задача 8](#задача-8-5)
- [Работа 19.O. «Резервное копирование и восстановление данных через клиентскую консоль MySQL и через MySQL Workbench»](#работа-19o-резервное-копирование-и-восстановление-данных-через-клиентскую-консоль-mysql-и-через-mysql-workbench)
  - [1 Цель работы](#1-цель-работы)
  - [2	Условия задач](#2условия-задач)
  - [3.1 Резервное копирование и восстановление БД с помощью утилиты mysqldump](#31-резервное-копирование-и-восстановление-бд-с-помощью-утилиты-mysqldump)
    - [3.1.1 Задача 1](#311-задача-1)
    - [3.1.2 Задача 2](#312-задача-2)
- [Работа 20.O. «Создание учетных записей пользователей»](#работа-20o-создание-учетных-записей-пользователей)
  - [1	Цель работы](#1цель-работы)
  - [2	Условия задач](#2условия-задач-1)
  - [3	Решение задач](#3решение-задач)
    - [3.1 Создание списка пользователей](#31-создание-списка-пользователей)
    - [3.2 Создание списка пользователей](#32-создание-списка-пользователей)
    - [3.3 Просмотреть список пользователей](#33-просмотреть-список-пользователей)
    - [3.4 Удалить созданных пользователей](#34-удалить-созданных-пользователей)
- [Работа 21.O. «Реализация доступа пользователей к базе данных»](#работа-21o-реализация-доступа-пользователей-к-базе-данных)
  - [3.1 Задача 1](#31-задача-1)
  - [3.2 Задача 2](#32-задача-2)
  - [3.3 Задача 3](#33-задача-3)
  - [3.4 Задача 4](#34-задача-4)
    - [3.4.1 US1/uzaba](#341-us1uzaba)
    - [3.4.2 read/readb](#342-readreadb)
    - [3.4.3 sman/sales](#343-smansales)
  - [3.5 Задача 5](#35-задача-5)
  - [3.6 Задача 6](#36-задача-6)
    - [3.6.1 US1/uzaba](#361-us1uzaba)
    - [3.6.2 read/readb](#362-readreadb)
    - [3.4.3 sman/sales](#343-smansales-1)
- [Работа 22.O «Создание представлений»](#работа-22o-создание-представлений)
  - [3.1 Задача 1](#31-задача-1-1)
  - [3.2 Задача 2](#32-задача-2-1)
  - [3.3 Задача 3](#33-задача-3-1)
  - [3.4 Задача 4](#34-задача-4-1)
  - [Задача 4](#задача-4-9)
- [Работа 23.O «Создание хранимых процедур»](#работа-23o-создание-хранимых-процедур)
  - [3.1 Задача 1](#31-задача-1-2)
  - [3.2 Задача 2](#32-задача-2-2)
  - [3.3 Задача 3](#33-задача-3-2)
  - [3.4 Задача 4](#34-задача-4-2)
- [Работа 24.O «Создание хранимых функций»](#работа-24o-создание-хранимых-функций)
  - [3.1 Задача 1](#31-задача-1-3)
  - [3.2 Задача 2](#32-задача-2-3)
  - [3.3 Задача 3](#33-задача-3-3)
- [Работа 25.O «Создание триггеров»](#работа-25o-создание-триггеров)
  - [3.1 Задача 1](#31-задача-1-4)
  - [3.2 Задача 2](#32-задача-2-4)
- [Работа 26.O «Создание курсоров»](#работа-26o-создание-курсоров)
  - [3.1 Задача 1](#31-задача-1-5)
  - [3.2 Задача 2](#32-задача-2-5)
- [Работа 27.O «Выполнение и отмена транзакций»](#работа-27o-выполнение-и-отмена-транзакций)
  - [3.1 Задача 1](#31-задача-1-6)

## Работа 2.O. «Работа в консольном клиенте СУБД MySQL»

### Задание 2.1.2

Используя команды, представленные в таблице, выполните пункты задания.
1. Войти в консоль MySQL
2. Посмотреть базы данных, которые есть на сервере
3. Сделать текущей одну из БД
4. Посмотреть, есть ли у нее таблицы. Если есть, то посмотреть структуры таблиц, если нет, то посмотреть другую БД.
5. Создать базу данных (любое имя, например, DBsalon)
6. Посмотреть наличие созданной БД на сервере
7. Сделать эту базу текущей.
8. Посмотреть настройки текущей БД.
9. Создать таблицу
10. Посмотреть структуру этой таблицы
11. Добавить данные в таблицу
12. Вывести данные из созданной таблицы
13. Удалить созданную таблицу
14. Удалить созданную БД
15. Посмотреть БД, которые остались на сервере

### Ход выполнения задания

1. Войти в консоль MySQL: `mysql -u root`

    <details>
    <summary><b>Result</b></summary>

    ```
    viktor@DESKTOP-H16DFJO c:\ospanel
    # mysql -u root
    Welcome to the MySQL monitor.  Commands end with ; or \g.
    Your MySQL connection id is 8
    Server version: 8.0.30 MySQL Community Server - GPL

    Copyright (c) 2000, 2022, Oracle and/or its affiliates.

    Oracle is a registered trademark of Oracle Corporation and/or its
    affiliates. Other names may be trademarks of their respective
    owners.

    Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
    ```

    </details>

2. Посмотреть базы данных, которые есть на сервере: `show databases`.

    <details>
    <summary><b>Result</b></summary>

    ```
    mysql> show databases;
    +--------------------+
    | Database           |
    +--------------------+
    | information_schema |
    | mysql              |
    | performance_schema |
    | sys                |
    +--------------------+
    4 rows in set (0.01 sec)
    ```

    </details>

3. Сделать текущей одну из БД: `use` *`db_name`*:

   <details>
    <summary><b>Result</b></summary>

    ```
    mysql> use mysql
    Database changed
    ```

    </details>

4. Посмотреть, есть ли у нее таблицы: `show tables`. Если есть, то посмотреть структуры таблиц (`describe` *`table_name`*), если нет, то посмотреть другую БД.

    <details>
    <summary><b>Result</b></summary>

    ```
    mysql> show tables;
    +------------------------------------------------------+
    | Tables_in_mysql                                      |
    +------------------------------------------------------+
    | columns_priv                                         |
    | component                                            |
    | db                                                   |
    | default_roles                                        |
    | engine_cost                                          |
    | func                                                 |
    | general_log                                          |
    | global_grants                                        |
    | gtid_executed                                        |
    | help_category                                        |
    | help_keyword                                         |
    | help_relation                                        |
    | help_topic                                           |
    | innodb_index_stats                                   |
    | innodb_table_stats                                   |
    | password_history                                     |
    | plugin                                               |
    | procs_priv                                           |
    | proxies_priv                                         |
    | replication_asynchronous_connection_failover         |
    | replication_asynchronous_connection_failover_managed |
    | replication_group_configuration_version              |
    | replication_group_member_actions                     |
    | role_edges                                           |
    | server_cost                                          |
    | servers                                              |
    | slave_master_info                                    |
    | slave_relay_log_info                                 |
    | slave_worker_info                                    |
    | slow_log                                             |
    | tables_priv                                          |
    | time_zone                                            |
    | time_zone_leap_second                                |
    | time_zone_name                                       |
    | time_zone_transition                                 |
    | time_zone_transition_type                            |
    | user                                                 |
    +------------------------------------------------------+
    37 rows in set (0.09 sec)

    mysql> describe db;
    +-----------------------+---------------+------+-----+---------+-------+
    | Field                 | Type          | Null | Key | Default | Extra |
    +-----------------------+---------------+------+-----+---------+-------+
    | Host                  | char(255)     | NO   | PRI |         |       |
    | Db                    | char(64)      | NO   | PRI |         |       |
    | User                  | char(32)      | NO   | PRI |         |       |
    | Select_priv           | enum('N','Y') | NO   |     | N       |       |
    | Insert_priv           | enum('N','Y') | NO   |     | N       |       |
    | Update_priv           | enum('N','Y') | NO   |     | N       |       |
    | Delete_priv           | enum('N','Y') | NO   |     | N       |       |
    | Create_priv           | enum('N','Y') | NO   |     | N       |       |
    | Drop_priv             | enum('N','Y') | NO   |     | N       |       |
    | Grant_priv            | enum('N','Y') | NO   |     | N       |       |
    | References_priv       | enum('N','Y') | NO   |     | N       |       |
    | Index_priv            | enum('N','Y') | NO   |     | N       |       |
    | Alter_priv            | enum('N','Y') | NO   |     | N       |       |
    | Create_tmp_table_priv | enum('N','Y') | NO   |     | N       |       |
    | Lock_tables_priv      | enum('N','Y') | NO   |     | N       |       |
    | Create_view_priv      | enum('N','Y') | NO   |     | N       |       |
    | Show_view_priv        | enum('N','Y') | NO   |     | N       |       |
    | Create_routine_priv   | enum('N','Y') | NO   |     | N       |       |
    | Alter_routine_priv    | enum('N','Y') | NO   |     | N       |       |
    | Execute_priv          | enum('N','Y') | NO   |     | N       |       |
    | Event_priv            | enum('N','Y') | NO   |     | N       |       |
    | Trigger_priv          | enum('N','Y') | NO   |     | N       |       |
    +-----------------------+---------------+------+-----+---------+-------+
    22 rows in set (0.09 sec)
    ```

    </details>

5. Создать базу данных (любое имя, например, DBsalon): `create database DBsalon`.

   <details>
    <summary><b>Result</b></summary>

    ```
    mysql> create database DBsalon;
    Query OK, 1 row affected (0.00 sec)
    ```

    </details>

6. Посмотреть наличие созданной БД на сервере: `show databases`.

    <details>
    <summary><b>Result</b></summary>

    ```
    mysql> show databases;
    +--------------------+
    | Database           |
    +--------------------+
    | DBsalon            |
    | information_schema |
    | mysql              |
    | performance_schema |
    | sys                |
    +--------------------+
    5 rows in set (0.00 sec)
    ```

    </details>

7. Сделать эту базу текущей: `use DBsalon`.

   <details>
    <summary><b>Result</b></summary>

    ```
    mysql> use DBsalon;
    Database changed
    ```

    </details>

8. Посмотреть настройки текущей БД.

9. Создать таблицу: `create table` *`table_name`* ([*`prop_name prop_type`*, ...]).

   <details>
    <summary><b>Result</b></summary>

    ```
    mysql> create table users (id int auto_increment primary key, name varchar(30), age int);
    Query OK, 0 rows affected (0.02 sec)
    ```

    </details>

10. Посмотреть структуру этой таблицы: `describe DBsalon`.

    <details>
    <summary><b>Result</b></summary>

    ```
    mysql> describe users;
    +-------+-------------+------+-----+---------+----------------+
    | Field | Type        | Null | Key | Default | Extra          |
    +-------+-------------+------+-----+---------+----------------+
    | id    | int         | NO   | PRI | NULL    | auto_increment |
    | name  | varchar(30) | YES  |     | NULL    |                |
    | age   | int         | YES  |     | NULL    |                |
    +-------+-------------+------+-----+---------+----------------+
    3 rows in set (0.00 sec)
    ```

    </details>

11. Добавить данные в таблицу: `insert into users (`[*prop_name, ...*]`) values ` [`(`*value1*, ...`)`, ...].

    <details>
    <summary><b>Result</b></summary>

    ```
    mysql> insert into users (name, age) values ('Nick', 25), ('Tom', 34), ('Angelica', 21);
    Query OK, 3 rows affected (0.09 sec)
    Records: 3  Duplicates: 0  Warnings: 0
    ```

    </details>

12. Вывести данные из созданной таблицы: `select * from users`.

    <details>
    <summary><b>Result</b></summary>

    ```
    mysql> select * from users;
    +----+----------+------+
    | id | name     | age  |
    +----+----------+------+
    |  1 | Nick     |   25 |
    |  2 | Tom      |   34 |
    |  3 | Angelica |   21 |
    +----+----------+------+
    3 rows in set (0.00 sec)
    ```

    </details>

13. Удалить созданную таблицу: `drop table users`.

    <details>
    <summary><b>Result</b></summary>

    ```
    mysql> drop table users;
    Query OK, 0 rows affected (0.01 sec)
    ```

    </details>

14. Удалить созданную БД: `drop database DBsalon`.

    <details>
    <summary><b>Result</b></summary>

    ```
    mysql> drop database DBsalon;
    Query OK, 0 rows affected (0.01 sec)
    ```

    </details>

15. Посмотреть БД, которые остались на сервере: `show databases`.

    <details>
    <summary><b>Result</b></summary>

    ```
    mysql> show databases;
    +--------------------+
    | Database           |
    +--------------------+
    | information_schema |
    | mysql              |
    | performance_schema |
    | sys                |
    +--------------------+
    4 rows in set (0.00 sec)
    ```

    </details>

### Итоговый алгоритм

```
mysql -u root
show databases;
use mysql;
show tables;
describe db;
create database DBsalon;
show databases;
use DBsalon;
describe users;
insert into users (name, age) values ('Nick', 25), ('Tom', 34), ('Angelica', 21);
drop table users;
drop database DBsalon;
show databases;
```

## Работа 3.O. «Создание таблиц»

### Задание 3.1.2

В соответствии с предметной областью своего варианта создайте таблицы, используя язык DDL.

#### Описание предметной области

**Вариант 2: Гостиница**

Гостиница предоставляет номера клиентам.  Каждый номер характеризуется вместимостью, комфортностью (люкс, полу люкс, обычный) и ценой.  О клиентах собирается определенная информация (фамилия, имя, отчество, паспортные данные, дата рождения, адрес жительства и некоторый комментарий).  Сдача номера (комфортность, количество человек, телефон) клиенту производится при наличии свободных мест в номерах, подходящих клиенту по указанным выше параметрам.  При заселении фиксируется дата заселения. При выезде из гостиницы для каждого места запоминается дата освобождения.Необходимо также осуществлять бронирование номеров.  Для постоянных клиентов, а также для определенных категорий клиентов предусмотрена система скидок. Скидки могут суммироваться.

### Ход выполнения задания

#### Составление инфологической модели

Полученная инфологическая модель предметной области представлена на рисунке 1.

![Рисунок 1 - Инфологическая модель предметной области](../img/infological_model.png)

#### Создание базы данных

```
mysql> CREATE DATABASE hotel;
Query OK, 1 row affected (0.00 sec)
```

#### Создание таблиц

<details>
<summary><b>Комфортабельность</b></summary>

```
mysql> CREATE TABLE comfort (
    _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    type_name VARCHAR(10) NOT NULL CHECK(type_name != '')
);
Query OK, 0 rows affected (0.01 sec)

mysql> CREATE TABLE comfort (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> type_name VARCHAR(10) NOT NULL
    -> );
Query OK, 0 rows affected (0.01 sec)

mysql> DESCRIBE comfort;
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| _id       | int unsigned | NO   | PRI | NULL    | auto_increment |
| type_name | varchar(10)  | NO   |     | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
2 rows in set (0.01 sec)
```

</details>

<details>
<summary><b>Номера</b></summary>

```
mysql> CREATE TABLE room (
    _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    number VARCHAR(10) NOT NULL UNIQUE,
    capacity TINYINT UNSIGNED NOT NULL,
    price DECIMAL(8, 2) NOT NULL,
    phone_number VARCHAR(10) NOT NULL UNIQUE,
    comfort_id INT UNSIGNED NOT NULL,
    CONSTRAINT check_price CHECK(price > 0),
    CONSTRAINT check_phone CHECK(phone_number regexp '^[+][0-9]{8}$')
);
Query OK, 0 rows affected (0.01 sec)

mysql> CREATE TABLE room (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> number VARCHAR(10) NOT NULL UNIQUE,
    -> capacity TINYINT UNSIGNED NOT NULL,
    -> price DECIMAL(8, 2) NOT NULL,
    -> phone_number VARCHAR(10) NOT NULL,
    -> comfort_id INT UNSIGNED NOT NULL
    -> );
Query OK, 0 rows affected (0.01 sec)

mysql> DESCRIBE room;
+--------------+------------------+------+-----+---------+----------------+
| Field        | Type             | Null | Key | Default | Extra          |
+--------------+------------------+------+-----+---------+----------------+
| _id          | int unsigned     | NO   | PRI | NULL    | auto_increment |
| number       | varchar(10)      | NO   | UNI | NULL    |                |
| capacity     | tinyint unsigned | NO   |     | NULL    |                |
| price        | decimal(8,2)     | NO   |     | NULL    |                |
| phone_number | varchar(10)      | NO   |     | NULL    |                |
| comfort_id   | int unsigned     | NO   |     | NULL    |                |
+--------------+------------------+------+-----+---------+----------------+
6 rows in set (0.00 sec)
```

</details>

<details>
<summary><b>Клиенты</b></summary>

```
mysql> CREATE TABLE client (
    _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    last_name VARCHAR(20) NOT NULL,
    first_name VARCHAR(20) NOT NULL,
    second_name VARCHAR(20) NOT NULL,
    passport_number CHAR(10) NOT NULL UNIQUE,
    birth_date DATE NOT NULL,
    address VARCHAR(100),
    comment TEXT,
    CONSTRAINT check_passport CHECK(passport_number regexp '^[+][0-9]{10}$')
);
Query OK, 0 rows affected (0.01 sec)

mysql> CREATE TABLE client (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> last_name VARCHAR(20) NOT NULL,
    -> first_name VARCHAR(20) NOT NULL,
    -> second_name VARCHAR(20) NOT NULL,
    -> passport_number CHAR(10) NOT NULL,
    -> birth_date DATE NOT NULL,
    -> address VARCHAR(100),
    -> comment TEXT
    -> );
Query OK, 0 rows affected (0.01 sec)

mysql> DESCRIBE client;
+-----------------+--------------+------+-----+---------+----------------+
| Field           | Type         | Null | Key | Default | Extra          |
+-----------------+--------------+------+-----+---------+----------------+
| _id             | int unsigned | NO   | PRI | NULL    | auto_increment |
| last_name       | varchar(20)  | NO   |     | NULL    |                |
| first_name      | varchar(20)  | NO   |     | NULL    |                |
| second_name     | varchar(20)  | NO   |     | NULL    |                |
| passport_number | char(10)     | NO   |     | NULL    |                |
| birth_date      | date         | NO   |     | NULL    |                |
| address         | varchar(100) | YES  |     | NULL    |                |
| comment         | text         | YES  |     | NULL    |                |
+-----------------+--------------+------+-----+---------+----------------+
8 rows in set (0.00 sec)
```

</details>

<details>
<summary><b>Скидки</b></summary>

```
mysql> CREATE TABLE discount (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> category_name VARCHAR(30) NOT NULL,
    -> value DECIMAL(3,2) NOT NULL
    -> );
Query OK, 0 rows affected (0.02 sec)

mysql> SHOW COLUMNS FROM discount;
+---------------+--------------+------+-----+---------+----------------+
| Field         | Type         | Null | Key | Default | Extra          |
+---------------+--------------+------+-----+---------+----------------+
| _id           | int unsigned | NO   | PRI | NULL    | auto_increment |
| category_name | varchar(30)  | NO   |     | NULL    |                |
| value         | decimal(3,2) | NO   |     | NULL    |                |
+---------------+--------------+------+-----+---------+----------------+
3 rows in set (0.00 sec)
```

</details>

<details>
<summary><b>Клиенты_Скидки</b></summary>

```
mysql> CREATE TABLE client_discount (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> client_id INT UNSIGNED NOT NULL,
    -> discount_id INT UNSIGNED NOT NULL
    -> );
Query OK, 0 rows affected (0.01 sec)

mysql> DESCRIBE client_discount;
+-------------+--------------+------+-----+---------+----------------+
| Field       | Type         | Null | Key | Default | Extra          |
+-------------+--------------+------+-----+---------+----------------+
| _id         | int unsigned | NO   | PRI | NULL    | auto_increment |
| client_id   | int unsigned | NO   |     | NULL    |                |
| discount_id | int unsigned | NO   |     | NULL    |                |
+-------------+--------------+------+-----+---------+----------------+
3 rows in set (0.00 sec)

```

</details>

<details>
<summary><b>Телефоны</b></summary>

```
mysql> CREATE TABLE phone (
    _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    number CHAR(12) NOT NULL UNIQUE CHECK(number regexp '^[+][0-9]{10}$'),
    client_id INT UNSIGNED NOT NULL
);
Query OK, 0 rows affected (0.01 sec)

mysql> CREATE TABLE phone (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> number CHAR(10) NOT NULL,
    -> client_id INT UNSIGNED NOT NULL
    -> );
Query OK, 0 rows affected (0.01 sec)

mysql> SHOW COLUMNS FROM phone;
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| _id       | int unsigned | NO   | PRI | NULL    | auto_increment |
| number    | char(10)     | NO   |     | NULL    |                |
| client_id | int unsigned | NO   |     | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
3 rows in set (0.00 sec)

```

</details>

<details>
<summary><b>Брони</b></summary>

```
mysql> CREATE TABLE reservation (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> date_ts TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    -> enter_date DATE NOT NULL,
    -> leave_date DATE NOT NULL,
    -> room_id INT UNSIGNED NOT NULL,
    -> client_id INT UNSIGNED NOT NULL
    -> );
Query OK, 0 rows affected (0.02 sec)

mysql> DESCRIBE reservation;
+------------+--------------+------+-----+-------------------+-------------------+
| Field      | Type         | Null | Key | Default           | Extra             |
+------------+--------------+------+-----+-------------------+-------------------+
| _id        | int unsigned | NO   | PRI | NULL              | auto_increment    |
| date_ts    | timestamp    | NO   |     | CURRENT_TIMESTAMP | DEFAULT_GENERATED |
| enter_date | date         | NO   |     | NULL              |                   |
| leave_date | date         | NO   |     | NULL              |                   |
| room_id    | int unsigned | NO   |     | NULL              |                   |
| client_id  | int unsigned | NO   |     | NULL              |                   |
+------------+--------------+------+-----+-------------------+-------------------+
6 rows in set (0.00 sec)

```

</details>

<details>
<summary><b>Поселения</b></summary>

```
mysql> CREATE TABLE checkin (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> date_ts TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    -> enter_date DATE NOT NULL,
    -> leave_date DATE NOT NULL,
    -> room_id INT UNSIGNED NOT NULL,
    -> client_id INT UNSIGNED NOT NULL
    -> );
Query OK, 0 rows affected (0.01 sec)

mysql> SHOW COLUMNS FROM checkin;
+------------+--------------+------+-----+-------------------+-------------------+
| Field      | Type         | Null | Key | Default           | Extra             |
+------------+--------------+------+-----+-------------------+-------------------+
| _id        | int unsigned | NO   | PRI | NULL              | auto_increment    |
| date_ts    | timestamp    | NO   |     | CURRENT_TIMESTAMP | DEFAULT_GENERATED |
| enter_date | date         | NO   |     | NULL              |                   |
| leave_date | date         | NO   |     | NULL              |                   |
| room_id    | int unsigned | NO   |     | NULL              |                   |
| client_id  | int unsigned | NO   |     | NULL              |                   |
+------------+--------------+------+-----+-------------------+-------------------+
6 rows in set (0.00 sec)

```

</details>

#### Проверка

Вывод списка таблиц.

```sql
mysql> SHOW TABLES;
+-----------------+
| Tables_in_hotel |
+-----------------+
| client          |
| client_discount |
| comfort         |
| discount        |
| phone           |
| reservation     |
| room            |
+-----------------+
7 rows in set (0.00 sec)
```

Проверка осуществляется выводом структур таблиц, вставкой пробных данных (валидных и невалидных) в созданные таблицы с выводом добавленных данных.

<details>
<summary><b>Комфортабельность</b></summary>

```
mysql> DESCRIBE comfort;
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| _id       | int unsigned | NO   | PRI | NULL    | auto_increment |
| type_name | varchar(30)  | NO   |     | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+

mysql> INSERT INTO comfort (type_name)
    VALUE ('Обычный');
Query OK, 0 rows affected (0.00 sec)


mysql> INSERT INTO comfort (type_name)
    VALUE (NULL);
ERROR 1048 (23000): Column 'type_name' cannot be null

mysql> INSERT INTO comfort (type_name)
    VALUE ('');
ERROR 3819 (HY000): Check constraint 'comfort_chk_1' is violated.

mysql> INSERT INTO comfort (type_name)
    VALUE ('Lorem ipsum dolor sit amet, consectetur adipiscing elit');
ERROR 1406 (22001): Data too long for column 'type_name' at row 1

mysql> select * from comfort;
+-----+-----------+
| _id | type_name |
+-----+-----------+
|   1 | Обычный   |
+-----+-----------+
1 row in set (0.00 sec)
```

</details>

### Итоговый алгоритм


## Работа 4.O. «Разработка серверной части базы данных в СУБД MysQL. Изменение структуры таблиц»

### Задание 4.1.2

#### Цель работы
- изучить основные положения теории баз данных, хранилищ данных, баз знаний;
- изучить методы описания схем баз данных в современных СУБД;
- сформировать умение создавать объекты баз данных в современных СУБД.

#### Условия задач
1) Cоздать таблицу с клиентами `clients (name varchar(20), age int, dolgnost vachar(15), dolgnost varchar(10))`.
2) Вставить в таблицу два поля `telephon char(11)` и `Name varchar(30)`.
3) Добавить уникальный индекс для поля `telephon` и простой индекс для поля `age`.
4) Изменить тип поля `dolgnost` на `char(12)` в таблице `client`.
5) Создать таблицу `ctrana(nazv_ctr varcar(10))`.
6) Добавить ключевое поле `id_cint` в таблицу `clients` и ключевое поле `id_c` в таблицу `ctrana`.
7) Добавить простой индекс для поля `age` и поставить его перед полем `name`.
8) Изменить имя и размер текстового поля `nazv_ctr` на `nazv_country varchar(20)` в таблице `ctrana`.
9) Переименовать поле `dolgnost` таблицы `clients` в post типа `varchar(15)`.
10) Добавить в таблицу `clients` внешний ключ `id_d` c `ON UPDATE RESTRICT`.
11) Удалить поле `dolgnost` из таблицы `clients`.
12) Переименовать таблицу `ctrana` в `country`.

#### Задача 1

Cоздать таблицу с клиентами `clients (name varchar(20), age int, dolgnost vachar(15), dolgnost varchar(10))`.


<details>
<summary><b>Создание и активация базы данных</b></summary>

```
mysql> CREATE DATABASE mytest;
Query OK, 1 row affected (0.00 sec)

mysql> USE mytest
Database changed
```

</details>

<details>
<summary><b>Создание таблицы с клиентами</b></summary>

```
mysql> CREATE TABLE clients (name varchar(20), age int, dolgnost vachar(15), dolgnost varchar(10));
ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'vachar(15), dolgnost varchar(10))' at line 1

mysql> CREATE TABLE clients (name VARCHAR(20), age INT, dolgnost VARCHAR(15));
Query OK, 0 rows affected (0.09 sec)

mysql> DESCRIBE clients;
+----------+-------------+------+-----+---------+-------+
| Field    | Type        | Null | Key | Default | Extra |
+----------+-------------+------+-----+---------+-------+
| name     | varchar(20) | YES  |     | NULL    |       |
| age      | int         | YES  |     | NULL    |       |
| dolgnost | varchar(15) | YES  |     | NULL    |       |
+----------+-------------+------+-----+---------+-------+
3 rows in set (0.01 sec)
```

</details>

#### Задача 2

<details>
<summary><b>Вставка полей</b></summary>

```
mysql> ALTER TABLE clients1 ADD COLUMN telephon char(11), ADD COLUMN Name varchar(30);
ERROR 1060 (42S21): Duplicate column name 'Name'

mysql> ALTER TABLE clients ADD COLUMN telephon char(11);
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESCRIBE clients;
+----------+-------------+------+-----+---------+-------+
| Field    | Type        | Null | Key | Default | Extra |
+----------+-------------+------+-----+---------+-------+
| name     | varchar(20) | YES  |     | NULL    |       |
| age      | int         | YES  |     | NULL    |       |
| dolgnost | varchar(15) | YES  |     | NULL    |       |
| telephon | char(11)    | YES  |     | NULL    |       |
+----------+-------------+------+-----+---------+-------+
4 rows in set (0.00 sec)
```

</details>

#### Задача 3

<details>
<summary><b>Добавление индексов</b></summary>

```
mysql> ALTER TABLE clients
    -> ADD UNIQUE INDEX (telephon),
    -> ADD INDEX (age)
    -> ;
Query OK, 0 rows affected (0.00 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESCRIBE clients;
+----------+-------------+------+-----+---------+-------+
| Field    | Type        | Null | Key | Default | Extra |
+----------+-------------+------+-----+---------+-------+
| name     | varchar(20) | YES  |     | NULL    |       |
| age      | int         | YES  | MUL | NULL    |       |
| dolgnost | varchar(15) | YES  |     | NULL    |       |
| telephon | char(11)    | YES  | UNI | NULL    |       |
+----------+-------------+------+-----+---------+-------+
4 rows in set (0.00 sec)
```

</details>

#### Задача 4

<details>
<summary><b>Изменение типа поля</b></summary>

```
mysql> ALTER TABLE clients
    -> MODIFY dolgnost CHAR(12)
    -> ;
Query OK, 0 rows affected (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESCRIBE clients;
+----------+-------------+------+-----+---------+-------+
| Field    | Type        | Null | Key | Default | Extra |
+----------+-------------+------+-----+---------+-------+
| name     | varchar(20) | YES  |     | NULL    |       |
| age      | int         | YES  | MUL | NULL    |       |
| dolgnost | char(12)    | YES  |     | NULL    |       |
| telephon | char(11)    | YES  | UNI | NULL    |       |
+----------+-------------+------+-----+---------+-------+
4 rows in set (0.00 sec)
```

</details>

#### Задача 5

<details>
<summary><b>Создание таблицы `ctrana`</b></summary>

```
mysql> CREATE TABLE ctrana(nazv_ctr varchar(10));
Query OK, 0 rows affected (0.01 sec)

mysql> DESCRIBE ctrana;
+----------+-------------+------+-----+---------+-------+
| Field    | Type        | Null | Key | Default | Extra |
+----------+-------------+------+-----+---------+-------+
| nazv_ctr | varchar(10) | YES  |     | NULL    |       |
+----------+-------------+------+-----+---------+-------+
1 row in set (0.00 sec)
```

</details>

#### Задача 6

<details>
<summary><b>Добавление ключевых полей</b></summary>

```
mysql> ALTER TABLE clients
    -> ADD id_cint INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY FIRST;
Query OK, 0 rows affected (0.03 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESCRIBE clients;
+----------+--------------+------+-----+---------+----------------+
| Field    | Type         | Null | Key | Default | Extra          |
+----------+--------------+------+-----+---------+----------------+
| id_cint  | int unsigned | NO   | PRI | NULL    | auto_increment |
| name     | varchar(20)  | YES  |     | NULL    |                |
| age      | int          | YES  | MUL | NULL    |                |
| dolgnost | char(12)     | YES  |     | NULL    |                |
| telephon | char(11)     | YES  | UNI | NULL    |                |
+----------+--------------+------+-----+---------+----------------+
5 rows in set (0.01 sec)

mysql> ALTER TABLE ctrana
    -> ADD id_c INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY FIRST;
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESCRIBE ctrana;
+----------+--------------+------+-----+---------+----------------+
| Field    | Type         | Null | Key | Default | Extra          |
+----------+--------------+------+-----+---------+----------------+
| id_c     | int unsigned | NO   | PRI | NULL    | auto_increment |
| nazv_ctr | varchar(10)  | YES  |     | NULL    |                |
+----------+--------------+------+-----+---------+----------------+
2 rows in set (0.00 sec)
```

</details>

#### Задача 7

<details>
<summary><b>Добавление простого индекса</b></summary>

```
mysql> ALTER TABLE clients
    -> ADD INDEX (age),
    -> MODIFY COLUMN age INT AFTER id_cint
    -> ;
Query OK, 0 rows affected, 1 warning (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 1

mysql> DESCRIBE clients;
+----------+--------------+------+-----+---------+----------------+
| Field    | Type         | Null | Key | Default | Extra          |
+----------+--------------+------+-----+---------+----------------+
| id_cint  | int unsigned | NO   | PRI | NULL    | auto_increment |
| age      | int          | YES  | MUL | NULL    |                |
| name     | varchar(20)  | YES  |     | NULL    |                |
| dolgnost | char(12)     | YES  |     | NULL    |                |
| telephon | char(11)     | YES  | UNI | NULL    |                |
+----------+--------------+------+-----+---------+----------------+
5 rows in set (0.00 sec)

mysql> SHOW INDEXES FROM clients;
+---------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
| Table   | Non_unique | Key_name | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |
+---------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
| clients |          0 | PRIMARY  |            1 | id_cint     | A         |           0 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
| clients |          0 | telephon |            1 | telephon    | A         |           0 |     NULL |   NULL | YES  | BTREE      |         |               | YES     | NULL       |
| clients |          1 | age      |            1 | age         | A         |           0 |     NULL |   NULL | YES  | BTREE      |         |               | YES     | NULL       |
+---------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
3 rows in set (0.00 sec)
```

</details>

#### Задача 8

<details>
<summary><b>Изменение поля</b></summary>

```
mysql> ALTER TABLE ctrana CHANGE nazv_ctr nazv_country VARCHAR(20);
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW COLUMNS FROM ctrana;
+--------------+--------------+------+-----+---------+----------------+
| Field        | Type         | Null | Key | Default | Extra          |
+--------------+--------------+------+-----+---------+----------------+
| id_c         | int unsigned | NO   | PRI | NULL    | auto_increment |
| nazv_country | varchar(20)  | YES  |     | NULL    |                |
+--------------+--------------+------+-----+---------+----------------+
2 rows in set (0.00 sec)
```

</details>

#### Задача 9

<details>
<summary><b>Изменение поля</b></summary>

```
mysql> ALTER TABLE clients CHANGE COLUMN dolgnost post VARCHAR(15);
Query OK, 0 rows affected (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESCRIBE clients;
+----------+--------------+------+-----+---------+----------------+
| Field    | Type         | Null | Key | Default | Extra          |
+----------+--------------+------+-----+---------+----------------+
| id_cint  | int unsigned | NO   | PRI | NULL    | auto_increment |
| age      | int          | YES  | MUL | NULL    |                |
| name     | varchar(20)  | YES  |     | NULL    |                |
| post     | varchar(15)  | YES  |     | NULL    |                |
| telephon | char(11)     | YES  | UNI | NULL    |                |
+----------+--------------+------+-----+---------+----------------+
5 rows in set (0.00 sec)
```

</details>

#### Задача 10

<details>
<summary><b>Добавление внешнего ключа</b></summary>

```
mysql> ALTER TABLE clients
    -> ADD id_d INT UNSIGNED,
    -> ADD FOREIGN KEY (id_d) REFERENCES ctrana (id_c) ON UPDATE RESTRICT
    -> ;
Query OK, 0 rows affected (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW CREATE TABLE clients;
+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table   | Create Table

                                                    |
+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| clients | CREATE TABLE `clients` (
  `id_cint` int unsigned NOT NULL AUTO_INCREMENT,
  `age` int DEFAULT NULL,
  `name` varchar(20) DEFAULT NULL,
  `post` varchar(15) DEFAULT NULL,
  `telephon` char(11) DEFAULT NULL,
  `id_d` int unsigned DEFAULT NULL,
  PRIMARY KEY (`id_cint`),
  UNIQUE KEY `telephon` (`telephon`),
  KEY `age` (`age`),
  KEY `id_d` (`id_d`),
  CONSTRAINT `clients_ibfk_1` FOREIGN KEY (`id_d`) REFERENCES `ctrana` (`id_c`) ON UPDATE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)
```

</details>

#### Задача 11

<details>
<summary><b>Удаление поля</b></summary>

```
mysql> > ALTER TABLE clients DROP dolgnost;
ERROR 1091 (42000): Can't DROP 'dolgnost'; check that column/key exists
mysql> ALTER TABLE clients DROP post;
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW COLUMNS FROM clients;
+----------+--------------+------+-----+---------+----------------+
| Field    | Type         | Null | Key | Default | Extra          |
+----------+--------------+------+-----+---------+----------------+
| id_cint  | int unsigned | NO   | PRI | NULL    | auto_increment |
| age      | int          | YES  | MUL | NULL    |                |
| name     | varchar(20)  | YES  |     | NULL    |                |
| telephon | char(11)     | YES  | UNI | NULL    |                |
| id_d     | int unsigned | YES  | MUL | NULL    |                |
+----------+--------------+------+-----+---------+----------------+
5 rows in set (0.00 sec)

```

</details>

#### Задача 12

<details>
<summary><b>Переименование таблицы</b></summary>

```
mysql> ALTER TABLE ctrana RENAME country;
Query OK, 0 rows affected (0.01 sec)

mysql> SHOW TABLES;
+------------------+
| Tables_in_mytest |
+------------------+
| clients          |
| country          |
+------------------+
2 rows in set (0.00 sec)
```

</details>

## Работа 5.O. «Разработка серверной части базы данных в СУБД  MySQL. Создание индексов (простых, уникальных)»

### Задание 5.1.2

#### Цель работы
- -	изучить cтруктуры данных СУБД, общий подход к организации представлений, таблиц, индексов и кластеров;
-	сформировать умение создавать объекты баз данных в современных СУБД.

#### Условия задач
1) Создать простые и уникальные индексы для своих таблиц (не менее пяти).

#### Задача 1

<details>
<summary><b>Создание уникального индекса для таблицы КОМФОРТАБЕЛЬНОСТЬ</b></summary>

```
mysql> CREATE UNIQUE INDEX type_name ON comfort (type_name);
Query OK, 0 rows affected (0.09 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESCRIBE hotel;
ERROR 1146 (42S02): Table 'hotel.hotel' doesn't exist
mysql> DESCRIBE comfort;
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| _id       | int unsigned | NO   | PRI | NULL    | auto_increment |
| type_name | varchar(10)  | NO   | UNI | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
2 rows in set (0.00 sec)

mysql> SHOW CREATE TABLE comfort;
+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table   | Create Table
         |
+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| comfort | CREATE TABLE `comfort` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `type_name` varchar(10) NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `type_name` (`type_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Создание уникального индекса для таблицы НОМЕРА</b></summary>

```
mysql> ALTER TABLE room ADD UNIQUE INDEX (phone_number);
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESCRIBE room;
+--------------+------------------+------+-----+---------+----------------+
| Field        | Type             | Null | Key | Default | Extra          |
+--------------+------------------+------+-----+---------+----------------+
| _id          | int unsigned     | NO   | PRI | NULL    | auto_increment |
| number       | varchar(10)      | NO   | UNI | NULL    |                |
| capacity     | tinyint unsigned | NO   |     | NULL    |                |
| price        | decimal(8,2)     | NO   |     | NULL    |                |
| phone_number | varchar(10)      | NO   | UNI | NULL    |                |
| comfort_id   | int unsigned     | NO   |     | NULL    |                |
+--------------+------------------+------+-----+---------+----------------+
6 rows in set (0.00 sec)

mysql> SHOW CREATE TABLE room;
+-------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table
                                                                                                                                                                                               |
+-------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| room  | CREATE TABLE `room` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `number` varchar(10) NOT NULL,
  `capacity` tinyint unsigned NOT NULL,
  `price` decimal(8,2) NOT NULL,
  `phone_number` varchar(10) NOT NULL,
  `comfort_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `number` (`number`),
  UNIQUE KEY `phone_number` (`phone_number`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)
```

</details>

<details>
<summary><b>Создание уникального и обычного индекса для таблицы КЛИЕНТЫ</b></summary>

```
mysql> ALTER TABLE client
    -> ADD INDEX (last_name),
    -> ADD UNIQUE INDEX (passport_number)
    -> ;
Query OK, 0 rows affected (0.01 sec)                                           
Records: 0  Duplicates: 0  Warnings: 0                                         
                                                                               
mysql> DESCRIBE client;                                                        
+-----------------+--------------+------+-----+---------+----------------+     
| Field           | Type         | Null | Key | Default | Extra          |     
+-----------------+--------------+------+-----+---------+----------------+     
| _id             | int unsigned | NO   | PRI | NULL    | auto_increment |     
| last_name       | varchar(20)  | NO   | MUL | NULL    |                |     
| first_name      | varchar(20)  | NO   |     | NULL    |                |     
| second_name     | varchar(20)  | NO   |     | NULL    |                |     
| passport_number | char(10)     | NO   | UNI | NULL    |                |     
| birth_date      | date         | NO   |     | NULL    |                |     
| address         | varchar(100) | YES  |     | NULL    |                |     
| comment         | text         | YES  |     | NULL    |                |     
+-----------------+--------------+------+-----+---------+----------------+     
8 rows in set (0.00 sec)                                                       
                                                                               
mysql> SHOW CREATE TABLE client;                                               
+--------+---------------------------------------------------------------------
-------------------------------------------------------------------------------
--------------+                                                                
| Table  | Create Table                                                        
                                                                               
              |                                                                
+--------+---------------------------------------------------------------------
-------------------------------------------------------------------------------
--------------+                                                                
| client | CREATE TABLE `client` (                                             
  `_id` int unsigned NOT NULL AUTO_INCREMENT,                                  
  `last_name` varchar(20) NOT NULL,                                            
  `first_name` varchar(20) NOT NULL,                                           
  `second_name` varchar(20) NOT NULL,                                          
  `passport_number` char(10) NOT NULL,                                         
  `birth_date` date NOT NULL,                                                  
  `address` varchar(100) DEFAULT NULL,                                         
  `comment` text,                                                              
  PRIMARY KEY (`_id`),                                                         
  UNIQUE KEY `passport_number` (`passport_number`),                            
  KEY `last_name` (`last_name`)                                                
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |           
+--------+---------------------------------------------------------------------
-------------------------------------------------------------------------------
--------------+                                                                
1 row in set (0.00 sec)                                                        
```

</details>

<details>
<summary><b>Создание уникального индекса для таблицы СКИДКИ</b></summary>

```
mysql> ALTER TABLE discount ADD UNIQUE INDEX (category_name);
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW COLUMNS FROM discount;
+---------------+--------------+------+-----+---------+----------------+
| Field         | Type         | Null | Key | Default | Extra          |
+---------------+--------------+------+-----+---------+----------------+
| _id           | int unsigned | NO   | PRI | NULL    | auto_increment |
| category_name | varchar(30)  | NO   | UNI | NULL    |                |
| value         | decimal(3,2) | NO   |     | NULL    |                |
+---------------+--------------+------+-----+---------+----------------+
3 rows in set (0.00 sec)

mysql> SHOW CREATE TABLE discount;
+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table    | Create Table
                                                        |
+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| discount | CREATE TABLE `discount` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `category_name` varchar(30) NOT NULL,
  `value` decimal(3,2) NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `category_name` (`category_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Создание уникального индекса для таблицы ТЕЛЕФОНЫ</b></summary>

```
mysql> CREATE UNIQUE INDEX phone_number ON phone(number);
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESCRIBE phone;
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| _id       | int unsigned | NO   | PRI | NULL    | auto_increment |
| number    | char(10)     | NO   | UNI | NULL    |                |
| client_id | int unsigned | NO   |     | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
3 rows in set (0.00 sec)

mysql> SHOW CREATE TABLE phone;
+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table
                                    |
+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| phone | CREATE TABLE `phone` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `number` char(10) NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `phone_number` (`number`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Создание простых индексов для таблицы БРОНИ</b></summary>

```
mysql> CREATE INDEX enter_date ON reservation (enter_date DESC);
Query OK, 0 rows affected (0.00 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> CREATE INDEX leave_date ON reservation (leave_date DESC);
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESCRIBE reservation;
+------------+--------------+------+-----+-------------------+-------------------+
| Field      | Type         | Null | Key | Default           | Extra             |
+------------+--------------+------+-----+-------------------+-------------------+
| _id        | int unsigned | NO   | PRI | NULL              | auto_increment    |
| date_ts    | timestamp    | NO   |     | CURRENT_TIMESTAMP | DEFAULT_GENERATED |
| enter_date | date         | NO   | MUL | NULL              |                   |
| leave_date | date         | NO   | MUL | NULL              |                   |
| room_id    | int unsigned | NO   |     | NULL              |                   |
| client_id  | int unsigned | NO   |     | NULL              |                   |
+------------+--------------+------+-----+-------------------+-------------------+
6 rows in set (0.00 sec)

mysql> SHOW INDEXES FROM reservation;
+-------------+------------+------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
| Table       | Non_unique | Key_name   | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |
+-------------+------------+------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
| reservation |          0 | PRIMARY    |            1 | _id         | A         |           0 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
| reservation |          1 | enter_date |            1 | enter_date  | D         |           0 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
| reservation |          1 | leave_date |            1 | leave_date  | D         |           0 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
+-------------+------------+------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
3 rows in set (0.00 sec)

mysql> SHOW CREATE TABLE reservation;
+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table       | Create Table
                                                                                                                                                                                                                   |
+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| reservation | CREATE TABLE `reservation` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `date_ts` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `enter_date` date NOT NULL,
  `leave_date` date NOT NULL,
  `room_id` int unsigned NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  KEY `enter_date` (`enter_date` DESC),
  KEY `leave_date` (`leave_date` DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Создание простых индексов для таблицы ПОСЕЛЕНИЯ</b></summary>

```
mysql> ALTER TABLE  checkin
    -> ADD INDEX (enter_date DESC),
    -> ADD INDEX (leave_date DESC)
    -> ;
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW COLUMNS FROM checkin;
+------------+--------------+------+-----+-------------------+-------------------+
| Field      | Type         | Null | Key | Default           | Extra             |
+------------+--------------+------+-----+-------------------+-------------------+
| _id        | int unsigned | NO   | PRI | NULL              | auto_increment    |
| date_ts    | timestamp    | NO   |     | CURRENT_TIMESTAMP | DEFAULT_GENERATED |
| enter_date | date         | NO   | MUL | NULL              |                   |
| leave_date | date         | NO   | MUL | NULL              |                   |
| room_id    | int unsigned | NO   |     | NULL              |                   |
| client_id  | int unsigned | NO   |     | NULL              |                   |
+------------+--------------+------+-----+-------------------+-------------------+
6 rows in set (0.00 sec)

mysql> SHOW INDEX FROM checkin;
+---------+------------+------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
| Table   | Non_unique | Key_name   | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |
+---------+------------+------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
| checkin |          0 | PRIMARY    |            1 | _id         | A         |           0 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
| checkin |          1 | enter_date |            1 | enter_date  | D         |           0 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
| checkin |          1 | leave_date |            1 | leave_date  | D         |           0 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
+---------+------------+------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
3 rows in set (0.00 sec)


mysql> SHOW CREATE TABLE checkin;
+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table   | Create Table
                                                                                                                                                                                                           |
+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| checkin | CREATE TABLE `checkin` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `date_ts` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `enter_date` date NOT NULL,
  `leave_date` date NOT NULL,
  `room_id` int unsigned NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  KEY `enter_date` (`enter_date` DESC),
  KEY `leave_date` (`leave_date` DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

## Работа 6.O. «Разработка серверной части базы данных в СУБД  MySQL. Установка ограничений и контроль ссылочной целостности»

### Задание 5.1.2

#### Цель работы
- изучить методы организации целостности данных;
- сформировать умение создавать объекты баз данных в современных СУБД.

#### Условия задач
В соответствии со своей предметной областью создать:
1)	Ограничения на уникальные индексы при создании таблиц.
2)	Ограничение на поля;
3)	Ограничение на внешние ключи;
4)	Удалить ограничения.

#### Задача 1

<details>
<summary><b>Установка ограничения на уникальные индексы</b></summary>

```
mysql> ALTER TABLE room ADD UNIQUE INDEX (phone_number);
Query OK, 0 rows affected (0.09 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESCRIBE hotel;
ERROR 1146 (42S02): Table 'hotel.hotel' doesn't exist
mysql> DESCRIBE comfort;
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| _id       | int unsigned | NO   | PRI | NULL    | auto_increment |
| type_name | varchar(10)  | NO   | UNI | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
2 rows in set (0.00 sec)

mysql> SHOW CREATE TABLE comfort;
+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table   | Create Table
         |
+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| comfort | CREATE TABLE `comfort` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `type_name` varchar(10) NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `type_name` (`type_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>


<details>
<summary><b>Создание ограничения на уникальные индексы при создании таблицы КОМФОРТАБЕЛЬНОСТЬ</b></summary>

```
mysql> CREATE TABLE comfort (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> type_name VARCHAR(10) NOT NULL,
    -> CONSTRAINT comfort_name_uq UNIQUE(type_name)
    -> );
Query OK, 0 rows affected (0.01 sec)

mysql> SHOW CREATE TABLE comfort;
+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table   | Create Table
               |
+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| comfort | CREATE TABLE `comfort` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `type_name` varchar(10) NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `comfort_name_uq` (`type_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Команда добавления ограничения уникальности</b></summary>

```
mysql> ALTER TABLE discount ADD CONSTRAINT UNIQUE (category_name);
Query OK, 0 rows affected (0.09 sec)
Records: 0  Duplicates: 0  Warnings: 0


mysql> SHOW COLUMNS FROM discount;
+---------------+--------------+------+-----+---------+----------------+
| Field         | Type         | Null | Key | Default | Extra          |
+---------------+--------------+------+-----+---------+----------------+
| _id           | int unsigned | NO   | PRI | NULL    | auto_increment |
| category_name | varchar(30)  | NO   | UNI | NULL    |                |
| value         | decimal(3,2) | NO   |     | NULL    |                |
+---------------+--------------+------+-----+---------+----------------+
3 rows in set (0.00 sec)

mysql> SHOW CREATE TABLE discount;
+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table    | Create Table
                                                        |
+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| discount | CREATE TABLE `discount` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `category_name` varchar(30) NOT NULL,
  `value` decimal(3,2) NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `category_name` (`category_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Создание ограничения на уникальные индексы при создании таблицы СКИДКИ</b></summary>

```
mysql> CREATE TABLE discount (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> category_name VARCHAR(30) NOT NULL,
    -> value DECIMAL(3,2) NOT NULL,
    -> CONSTRAINT discount_category_uq UNIQUE(category_name)
    -> );
Query OK, 0 rows affected (0.01 sec)

mysql> SHOW CREATE TABLE discount;
+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table    | Create Table
                                                               |
+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| discount | CREATE TABLE `discount` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `category_name` varchar(30) NOT NULL,
  `value` decimal(3,2) NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `discount_category_uq` (`category_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Добавление уникального индекса для таблицы ТЕЛЕФОНЫ</b></summary>

```
mysql> ALTER TABLE phone ADD UNIQUE KEY phone_number (number);
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESCRIBE phone;
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| _id       | int unsigned | NO   | PRI | NULL    | auto_increment |
| number    | char(10)     | NO   | UNI | NULL    |                |
| client_id | int unsigned | NO   |     | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
3 rows in set (0.00 sec)

mysql> SHOW CREATE TABLE phone;
+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table
                                    |
+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| phone | CREATE TABLE `phone` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `number` char(10) NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `phone_number` (`number`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>


<details>
<summary><b>Создание ограничения на уникальные индексы при создании таблицы ТЕЛЕФОНЫ</b></summary>

```
mysql> CREATE TABLE phone (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> number CHAR(10) NOT NULL,
    -> client_id INT UNSIGNED NOT NULL,
    -> CONSTRAINT phone_number_uq UNIQUE(number)
    -> );
Query OK, 0 rows affected (0.01 sec)

mysql> SHOW CREATE TABLE phone;
+-------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table
                                       |
+-------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| phone | CREATE TABLE `phone` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `number` char(10) NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `phone_number_uq` (`number`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

ALTER TABLE `table_name`
    ADD UNIQUE KEY `index_name` (`column_name`);

ALTER TABLE table_name ADD CONSTRAINT index_name UNIQUE (column_name)

ALTER TABLE test_table MODIFY COLUMN id INT NOT NULL UNIQUE;

#### Задача 2

<details>
<summary><b>Установка ограничений на поля таблицы КОМФОРТАБЕЛЬНОСТЬ</b></summary>

```
mysql> ALTER TABLE comfort ADD CONSTRAINT comfort_not_empty CHECK(type_name <> '');
Query OK, 0 rows affected (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW CREATE TABLE comfort;
+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table   | Create Table
                                                                             |
+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| comfort | CREATE TABLE `comfort` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `type_name` varchar(10) NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `type_name` (`type_name`),
  CONSTRAINT `comfort_not_empty` CHECK ((`type_name` <> _cp866''))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Создание ограничений на поля при создании таблицы КОМФОРТАБЕЛЬНОСТЬ</b></summary>

```
mysql> CREATE TABLE comfort (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> type_name VARCHAR(10) NOT NULL UNIQUE,
    -> CONSTRAINT comfort_name_ne_chk CHECK(type_name <> ''));
Query OK, 0 rows affected (0.01 sec)

mysql> SHOW CREATE TABLE comfort;
+---------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table   | Create Table
                                                                               |
+---------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| comfort | CREATE TABLE `comfort` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `type_name` varchar(10) NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `type_name` (`type_name`),
  CONSTRAINT `comfort_name_ne_chk` CHECK ((`type_name` <> _cp866''))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+---------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Установка ограничений на поля таблицы НОМЕРА</b></summary>

```
mysql> ALTER TABLE room
    -> ADD CONSTRAINT number_not_empty CHECK(number != ''),
    -> ADD CONSTRAINT capacity_range CHECK(capacity > 0 AND capacity < 20),
    -> ADD CONSTRAINT price_range CHECK(price>0),
    -> ADD CONSTRAINT phone_format CHECK(phone_number REGEXP '^[0-9]{1,10}$')
    -> ;
Query OK, 0 rows affected (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW CREATE TABLE room;
+-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table


               |
+-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| room  | CREATE TABLE `room` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `number` varchar(10) NOT NULL,
  `capacity` tinyint unsigned NOT NULL,
  `price` decimal(8,2) NOT NULL,
  `phone_number` varchar(10) NOT NULL,
  `comfort_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `number` (`number`),
  UNIQUE KEY `phone_number` (`phone_number`),
  CONSTRAINT `capacity_range` CHECK (((`capacity` > 0) and (`capacity` < 20))),
  CONSTRAINT `number_not_empty` CHECK ((`number` <> _utf8mb4'')),
  CONSTRAINT `phone_format` CHECK (regexp_like(`phone_number`,_utf8mb4'^[0-9]{1,10}$')),
  CONSTRAINT `price_range` CHECK ((`price` > 0))
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Установка ограничений на поля таблицы КЛИЕНТЫ</b></summary>

```
mysql> ALTER TABLE client
    -> ADD CONSTRAINT name_not_empty CHECK(last_name <> '' AND first_name <> ''),
    -> ADD CONSTRAINT passport_format CHECK(passport_number REGEXP '^[0-9]{10}$'),
    -> ADD CONSTRAINT age_range CHECK(birth_date > '1904-01-01')
    -> ;
Query OK, 0 rows affected (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW CREATE TABLE client;
+--------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table  | Create Table

                                                                                                                                                                                                  |
+--------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| client | CREATE TABLE `client` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `last_name` varchar(20) NOT NULL,
  `first_name` varchar(20) NOT NULL,
  `second_name` varchar(20) NOT NULL,
  `passport_number` char(10) NOT NULL,
  `birth_date` date NOT NULL,
  `address` varchar(100) DEFAULT NULL,
  `comment` text,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `passport_number` (`passport_number`),
  KEY `last_name` (`last_name`),
  CONSTRAINT `age_range` CHECK ((`birth_date` > _cp866'1904-01-01')),
  CONSTRAINT `name_not_empty` CHECK (((`last_name` <> _cp866'') and (`first_name` <> _cp866''))),
  CONSTRAINT `passport_format` CHECK (regexp_like(`passport_number`,_cp866'^[0-9]{1,10}$'))
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+--------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Создание ограничений на поля при создании таблицы КЛИЕНТЫ</b></summary>

```
mysql> CREATE TABLE client (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> last_name VARCHAR(20) NOT NULL,
    -> first_name VARCHAR(20) NOT NULL,
    -> second_name VARCHAR(20) NOT NULL,
    -> passport_number CHAR(10) NOT NULL UNIQUE,
    -> birth_date DATE NOT NULL,
    -> address VARCHAR(100),
    -> comment TEXT,
    -> CONSTRAINT client_name_ne CHECK(last_name != '' AND first_name != ''),
    -> CONSTRAINT client_passport_ft CHECK(passport_number REGEXP '^[0-9]{10}$'),
    -> CONSTRAINT client_birth_rg CHECK(birth_date > '1904-01-01')
    -> );
Query OK, 0 rows affected (0.10 sec)

mysql> SHOW CREATE TABLE client;
+--------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table  | Create Table


          |
+--------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| client | CREATE TABLE `client` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `last_name` varchar(20) NOT NULL,
  `first_name` varchar(20) NOT NULL,
  `second_name` varchar(20) NOT NULL,
  `passport_number` char(10) NOT NULL,
  `birth_date` date NOT NULL,
  `address` varchar(100) DEFAULT NULL,
  `comment` text,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `passport_number` (`passport_number`),
  CONSTRAINT `client_birth_rg` CHECK ((`birth_date` > _cp866'1904-01-01')),
  CONSTRAINT `client_name_ne` CHECK (((`last_name` <> _cp866'') and (`first_name` <> _cp866''))),
  CONSTRAINT `client_passport_ft` CHECK (regexp_like(`passport_number`,_cp866'^[0-9]{10}$'))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+--------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Установка ограничений на поля таблицы СКИДКИ</b></summary>

```
mysql> ALTER TABLE discount
    -> ADD CONSTRAINT category_not_empty CHECK(category_name != ''),
    -> ADD CONSTRAINT discount_value CHECK(value > 0)
    -> ;
Query OK, 0 rows affected (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW CREATE TABLE discount;
+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table    | Create Table
                                                                                                                                                                                      |
+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| discount | CREATE TABLE `discount` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `category_name` varchar(30) NOT NULL,
  `value` decimal(3,2) NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `category_name` (`category_name`),
  CONSTRAINT `category_not_empty` CHECK ((`category_name` <> _cp866'')),
  CONSTRAINT `discount_value` CHECK ((`value` > 0))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```
</details>

<details>
<summary><b>Создание ограничений на поля при создании таблицы СКИДКИ</b></summary>

```
mysql> CREATE TABLE discount (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> category_name VARCHAR(30) NOT NULL UNIQUE,
    -> value DECIMAL(3,2) NOT NULL,
    -> CONSTRAINT discount_category_ne CHECK(category_name <> ''),
    -> CONSTRAINT discount_value_rg CHECK(value > 0)
    -> );
Query OK, 0 rows affected (0.01 sec)

mysql> SHOW CREATE TABLE discount;
+----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table    | Create Table
                                                                                                                                                                                           |
+----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| discount | CREATE TABLE `discount` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `category_name` varchar(30) NOT NULL,
  `value` decimal(3,2) NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `category_name` (`category_name`),
  CONSTRAINT `discount_category_ne` CHECK ((`category_name` <> _cp866'')),
  CONSTRAINT `discount_value_rg` CHECK ((`value` > 0))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

</details>

<details>
<summary><b>Установка ограничений на поля таблицы ТЕЛЕФОНЫ</b></summary>

```
mysql> ALTER TABLE phone ADD CONSTRAINT phone_number CHECK(number REGEXP '^[0-9]{10}$');
Query OK, 0 rows affected (0.03 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW CREATE TABLE phone;
+-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table
                                                                                                                   |
+-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| phone | CREATE TABLE `phone` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `number` char(10) NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `phone_number` (`number`),
  CONSTRAINT `phone_number` CHECK (regexp_like(`number`,_cp866'^[0-9]{10}$'))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)


```

</details>

<details>
<summary><b>Установка ограничений на поля таблицы БРОНИ</b></summary>

```
mysql> ALTER TABLE reservation
    -> ADD CONSTRAINT reservation_ts CHECK (date_ts > '2020-01-01 00:00:00'),
    -> ADD CONSTRAINT reservation_date CHECK(enter_date > '2020-01-01' && leave_date > enter_date)
    -> ;
Query OK, 0 rows affected, 1 warning (0.03 sec)
Records: 0  Duplicates: 0  Warnings: 1

mysql> SHOW CREATE TABLE reservation;
+-------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table       | Create Table

                                                                                                                                                                      |
+-------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| reservation | CREATE TABLE `reservation` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `date_ts` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `enter_date` date NOT NULL,
  `leave_date` date NOT NULL,
  `room_id` int unsigned NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  KEY `enter_date` (`enter_date` DESC),
  KEY `leave_date` (`leave_date` DESC),
  CONSTRAINT `reservation_date` CHECK (((`enter_date` > _cp866'2020-01-01') and (`leave_date` > `enter_date`))),
  CONSTRAINT `reservation_ts` CHECK ((`date_ts` > _cp866'2020-01-01 00:00:00'))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>
<details>
<summary><b>Установка ограничений на поля таблицы ТЕЛЕФОНЫ</b></summary>

```
mysql> ALTER TABLE phone ADD CONSTRAINT phone_number CHECK(number REGEXP '^[0-9]{10}$');
Query OK, 0 rows affected (0.03 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW CREATE TABLE phone;
+-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table
                                                                                                                   |
+-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| phone | CREATE TABLE `phone` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `number` char(10) NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `phone_number` (`number`),
  CONSTRAINT `phone_number` CHECK (regexp_like(`number`,_cp866'^[0-9]{10}$'))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Установка ограничений на поля таблицы ПОСЕЛЕНИЯ</b></summary>

```
mysql> ALTER TABLE checkin
    -> ADD CONSTRAINT checkin_ts CHECK (date_ts > '2020-01-01 00:00:00'),
    -> ADD CONSTRAINT checkin_date CHECK(enter_date > '2020-01-01' && leave_date > enter_date)
    -> ;
Query OK, 0 rows affected, 1 warning (0.03 sec)
Records: 0  Duplicates: 0  Warnings: 1

mysql> SHOW CREATE TABLE checkin;
+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table   | Create Table

                                                                                                                                                      |
+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| checkin | CREATE TABLE `checkin` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `date_ts` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `enter_date` date NOT NULL,
  `leave_date` date NOT NULL,
  `room_id` int unsigned NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  KEY `enter_date` (`enter_date` DESC),
  KEY `leave_date` (`leave_date` DESC),
  CONSTRAINT `checkin_date` CHECK (((`enter_date` > _cp866'2020-01-01') and (`leave_date` > `enter_date`))),
  CONSTRAINT `checkin_ts` CHECK ((`date_ts` > _cp866'2020-01-01 00:00:00'))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

#### Задача 3

<details>
<summary><b>Установка ограничений внешнего ключа для таблицы НОМЕРА</b></summary>

```
mysql> ALTER TABLE room
    -> ADD CONSTRAINT room_comfort_fk
    -> FOREIGN KEY(comfort_id) REFERENCES comfort(_id) ON DELETE CASCADE
    -> ;
Query OK, 0 rows affected (0.03 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW COLUMNS IN room;
+--------------+------------------+------+-----+---------+----------------+
| Field        | Type             | Null | Key | Default | Extra          |
+--------------+------------------+------+-----+---------+----------------+
| _id          | int unsigned     | NO   | PRI | NULL    | auto_increment |
| number       | varchar(10)      | NO   | UNI | NULL    |                |
| capacity     | tinyint unsigned | NO   |     | NULL    |                |
| price        | decimal(8,2)     | NO   |     | NULL    |                |
| phone_number | varchar(10)      | NO   | UNI | NULL    |                |
| comfort_id   | int unsigned     | NO   | MUL | NULL    |                |
+--------------+------------------+------+-----+---------+----------------+
6 rows in set (0.00 sec)

mysql> SHOW CREATE TABLE room;
+-------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table


                                                                                                                                                |
+-------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| room  | CREATE TABLE `room` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `number` varchar(10) NOT NULL,
  `capacity` tinyint unsigned NOT NULL,
  `price` decimal(8,2) NOT NULL,
  `phone_number` varchar(10) NOT NULL,
  `comfort_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `number` (`number`),
  UNIQUE KEY `phone_number` (`phone_number`),
  KEY `room_comfort_fk` (`comfort_id`),
  CONSTRAINT `room_comfort_fk` FOREIGN KEY (`comfort_id`) REFERENCES `comfort` (`_id`) ON DELETE CASCADE,
  CONSTRAINT `capacity_range` CHECK (((`capacity` > 0) and (`capacity` < 20))),
  CONSTRAINT `number_not_empty` CHECK ((`number` <> _utf8mb4'')),
  CONSTRAINT `phone_format` CHECK (regexp_like(`phone_number`,_utf8mb4'^[0-9]{1,10}$')),
  CONSTRAINT `price_range` CHECK ((`price` > 0))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Создание ограничений на внешние ключи при создании таблицы НОМЕРА</b></summary>

```
mysql> CREATE TABLE room (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> number VARCHAR(10) NOT NULL,
    -> capacity TINYINT UNSIGNED NOT NULL,
    -> price DECIMAL(8, 2) NOT NULL,
    -> phone_number VARCHAR(10) NOT NULL,
    -> comfort_id INT UNSIGNED NOT NULL,
    -> CONSTRAINT room_number_uq UNIQUE(number),
    -> CONSTRAINT room_number_ne CHECK(number <> ''),
    -> CONSTRAINT room_capacity_rg CHECK(capacity > 0 AND capacity < 20),
    -> CONSTRAINT room_price_rg CHECK(price > 0),
    -> CONSTRAINT room_phone_uq UNIQUE(phone_number),
    -> CONSTRAINT room_phone_pt CHECK(phone_number REGEXP '^[0-9]{1,10}$'),
    -> CONSTRAINT room_comfort_fk FOREIGN KEY (comfort_id) REFERENCES comfort(_id) ON DELETE CASCADE
    -> );
Query OK, 0 rows affected (0.10 sec)

mysql> SHOW CREATE TABLE room;
+-------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table


                                                                                                                                                        |
+-------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| room  | CREATE TABLE `room` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `number` varchar(10) NOT NULL,
  `capacity` tinyint unsigned NOT NULL,
  `price` decimal(8,2) NOT NULL,
  `phone_number` varchar(10) NOT NULL,
  `comfort_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `room_number_uq` (`number`),
  UNIQUE KEY `room_phone_uq` (`phone_number`),
  KEY `room_comfort_fk` (`comfort_id`),
  CONSTRAINT `room_comfort_fk` FOREIGN KEY (`comfort_id`) REFERENCES `comfort` (`_id`) ON DELETE CASCADE,
  CONSTRAINT `room_capacity_rg` CHECK (((`capacity` > 0) and (`capacity` < 20))),
  CONSTRAINT `room_number_ne` CHECK ((`number` <> _cp866'')),
  CONSTRAINT `room_phone_pt` CHECK (regexp_like(`phone_number`,_cp866'^[0-9]{1,10}$')),
  CONSTRAINT `room_price_rg` CHECK ((`price` > 0))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Установка ограничений внешнего ключа для таблицы КЛИЕНТЫ_СКИДКИ</b></summary>

```
mysql> ALTER TABLE client_discount
    -> ADD FOREIGN KEY(client_id) REFERENCES client(_id) ON DELETE CASCADE,
    -> ADD FOREIGN KEY(discount_id) REFERENCES discount(_id) ON DELETE CASCADE
    -> ;
Query OK, 0 rows affected (0.03 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW CREATE TABLE client_discount;
+-----------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table           | Create Table

                                                                                  |
+-----------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| client_discount | CREATE TABLE `client_discount` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `client_id` int unsigned NOT NULL,
  `discount_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  KEY `client_id` (`client_id`),
  KEY `discount_id` (`discount_id`),
  CONSTRAINT `client_discount_ibfk_1` FOREIGN KEY (`client_id`) REFERENCES `client` (`_id`) ON DELETE CASCADE,
  CONSTRAINT `client_discount_ibfk_2` FOREIGN KEY (`discount_id`) REFERENCES `discount` (`_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-----------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Создание ограничений на внешние ключи при создании таблицы КЛИЕНТЫ_СКИДКИ</b></summary>

```
mysql> CREATE TABLE client_discount (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> client_id INT UNSIGNED NOT NULL,
    -> discount_id INT UNSIGNED NOT NULL,
    -> CONSTRAINT cd_client_fk FOREIGN KEY(client_id) REFERENCES client(_id) ON DELETE CASCADE,
    -> CONSTRAINT cd_discount_fk FOREIGN KEY(discount_id) REFERENCES discount(_id) ON DELETE CASCADE
    -> );
Query OK, 0 rows affected (0.02 sec)

mysql> SHOW CREATE TABLE client_discount;
+-----------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table           | Create Table

                                                                      |
+-----------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| client_discount | CREATE TABLE `client_discount` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `client_id` int unsigned NOT NULL,
  `discount_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  KEY `cd_client_fk` (`client_id`),
  KEY `cd_discount_fk` (`discount_id`),
  CONSTRAINT `cd_client_fk` FOREIGN KEY (`client_id`) REFERENCES `client` (`_id`) ON DELETE CASCADE,
  CONSTRAINT `cd_discount_fk` FOREIGN KEY (`discount_id`) REFERENCES `discount` (`_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-----------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Установка ограничений внешнего ключа для таблицы КЛИЕНТЫ_СКИДКИ</b></summary>

```
mysql> ALTER TABLE phone
    -> ADD CONSTRAINT phone_client_fk
    -> FOREIGN KEY(client_id) REFERENCES client(_id) ON DELETE CASCADE
    -> ;
Query OK, 1 row affected (0.11 sec)
Records: 1  Duplicates: 0  Warnings: 0

mysql> SHOW CREATE TABLE phone;
+-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table

                                      |
+-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| phone | CREATE TABLE `phone` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `number` char(10) NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `phone_number` (`number`),
  KEY `phone_client_fk` (`client_id`),
  CONSTRAINT `phone_client_fk` FOREIGN KEY (`client_id`) REFERENCES `client` (`_id`) ON DELETE CASCADE,
  CONSTRAINT `phone_number` CHECK (regexp_like(`number`,_utf8mb4'^[0-9]{10}$'))
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Создание ограничений на внешние ключи при создании таблицы ТЕЛЕФОНЫ</b></summary>

```
mysql> CREATE TABLE phone (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> number CHAR(10) NOT NULL,
    -> client_id INT UNSIGNED NOT NULL,
    -> CONSTRAINT phone_number_uq UNIQUE(number),
    -> CONSTRAINT phone_number_pt CHECK(number REGEXP '^[0-9]{10}$'),
    -> CONSTRAINT phone_client_fk FOREIGN KEY(client_id) REFERENCES client(_id) ON DELETE CASCADE
    -> );
Query OK, 0 rows affected (0.02 sec)

mysql> SHOW CREATE TABLE phone;
+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table

                         |
+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| phone | CREATE TABLE `phone` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `number` char(10) NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `phone_number_uq` (`number`),
  KEY `phone_client_fk` (`client_id`),
  CONSTRAINT `phone_client_fk` FOREIGN KEY (`client_id`) REFERENCES `client` (`_id`) ON DELETE CASCADE,
  CONSTRAINT `phone_number_pt` CHECK (regexp_like(`number`,_cp866'^[0-9]{10}$'))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Установка ограничений внешнего ключа для таблицы БРОНИ</b></summary>

```
mysql> ALTER TABLE reservation
    -> ADD FOREIGN KEY(client_id) REFERENCES client(_id) ON DELETE CASCADE,
    -> ADD FOREIGN KEY(room_id) REFERENCES room(_id) ON DELETE CASCADE
    -> ;
Query OK, 0 rows affected (0.04 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESCRIBE reservation;
+------------+--------------+------+-----+-------------------+-------------------+
| Field      | Type         | Null | Key | Default           | Extra             |
+------------+--------------+------+-----+-------------------+-------------------+
| _id        | int unsigned | NO   | PRI | NULL              | auto_increment    |
| date_ts    | timestamp    | NO   |     | CURRENT_TIMESTAMP | DEFAULT_GENERATED |
| enter_date | date         | NO   | MUL | NULL              |                   |
| leave_date | date         | NO   | MUL | NULL              |                   |
| room_id    | int unsigned | NO   | MUL | NULL              |                   |
| client_id  | int unsigned | NO   | MUL | NULL              |                   |
+------------+--------------+------+-----+-------------------+-------------------+
6 rows in set (0.00 sec)

mysql> SHOW CREATE TABLE reservation;
+-------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table       | Create Table


                                                                                                                                                                                                       |
+-------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| reservation | CREATE TABLE `reservation` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `date_ts` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `enter_date` date NOT NULL,
  `leave_date` date NOT NULL,
  `room_id` int unsigned NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  KEY `enter_date` (`enter_date` DESC),
  KEY `leave_date` (`leave_date` DESC),
  KEY `client_id` (`client_id`),
  KEY `room_id` (`room_id`),
  CONSTRAINT `reservation_ibfk_1` FOREIGN KEY (`client_id`) REFERENCES `client` (`_id`) ON DELETE CASCADE,
  CONSTRAINT `reservation_ibfk_2` FOREIGN KEY (`room_id`) REFERENCES `room` (`_id`) ON DELETE CASCADE,
  CONSTRAINT `reservation_date` CHECK (((`enter_date` > _cp866'2020-01-01') and (`leave_date` > `enter_date`))),
  CONSTRAINT `reservation_ts` CHECK ((`date_ts` > _cp866'2020-01-01 00:00:00'))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Создание ограничений на внешние ключи при создании таблицы БРОНИ</b></summary>

```
mysql> CREATE TABLE reservation (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> date_ts TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    -> enter_date DATE NOT NULL,
    -> leave_date DATE NOT NULL,
    -> room_id INT UNSIGNED NOT NULL,
    -> client_id INT UNSIGNED NOT NULL,
    -> CONSTRAINT reservation_ts_rg CHECK(date_ts > '2020-01-01 00:00:00'),
    -> CONSTRAINT reservation_date_chk CHECK(enter_date > '2020-01-01' && leave_date > enter_date),
    -> CONSTRAINT reservation_room_fk FOREIGN KEY(room_id) REFERENCES room(_id) ON DELETE CASCADE,
    -> CONSTRAINT reservation_client_fk FOREIGN KEY(client_id) REFERENCES client(_id) ON DELETE CASCADE
    -> );
Query OK, 0 rows affected, 1 warning (0.10 sec)

mysql> SHOW CREATE TABLE reservation;
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table       | Create Table


                                                                                                                                                          |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| reservation | CREATE TABLE `reservation` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `date_ts` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `enter_date` date NOT NULL,
  `leave_date` date NOT NULL,
  `room_id` int unsigned NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  KEY `reservation_room_fk` (`room_id`),
  KEY `reservation_client_fk` (`client_id`),
  CONSTRAINT `reservation_client_fk` FOREIGN KEY (`client_id`) REFERENCES `client` (`_id`) ON DELETE CASCADE,
  CONSTRAINT `reservation_room_fk` FOREIGN KEY (`room_id`) REFERENCES `room` (`_id`) ON DELETE CASCADE,
  CONSTRAINT `reservation_date_chk` CHECK (((`enter_date` > _cp866'2020-01-01') and (`leave_date` > `enter_date`))),
  CONSTRAINT `reservation_ts_rg` CHECK ((`date_ts` > _cp866'2020-01-01 00:00:00'))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Установка ограничений внешнего ключа для таблицы ПОСЕЛЕНИЯ</b></summary>

```
mysql> ALTER TABLE checkin
    -> ADD CONSTRAINT checkin_client_fk FOREIGN KEY(client_id)
    -> REFERENCES client(_id) ON DELETE CASCADE,
    -> ADD CONSTRAINT checkin_room_fk FOREIGN KEY(room_id)
    -> REFERENCES room(_id) ON DELETE CASCADE
    -> ;
Query OK, 0 rows affected (0.03 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW COLUMNS FROM checkin;
+------------+--------------+------+-----+-------------------+-------------------+
| Field      | Type         | Null | Key | Default           | Extra             |
+------------+--------------+------+-----+-------------------+-------------------+
| _id        | int unsigned | NO   | PRI | NULL              | auto_increment    |
| date_ts    | timestamp    | NO   |     | CURRENT_TIMESTAMP | DEFAULT_GENERATED |
| enter_date | date         | NO   | MUL | NULL              |                   |
| leave_date | date         | NO   | MUL | NULL              |                   |
| room_id    | int unsigned | NO   | MUL | NULL              |                   |
| client_id  | int unsigned | NO   | MUL | NULL              |                   |
+------------+--------------+------+-----+-------------------+-------------------+
6 rows in set (0.00 sec)

mysql> SHOW CREATE TABLE checkin;
+---------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table   | Create Table


                                                                                                                                                                                                   |
+---------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| checkin | CREATE TABLE `checkin` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `date_ts` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `enter_date` date NOT NULL,
  `leave_date` date NOT NULL,
  `room_id` int unsigned NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  KEY `enter_date` (`enter_date` DESC),
  KEY `leave_date` (`leave_date` DESC),
  KEY `checkin_client_fk` (`client_id`),
  KEY `checkin_room_fk` (`room_id`),
  CONSTRAINT `checkin_client_fk` FOREIGN KEY (`client_id`) REFERENCES `client` (`_id`) ON DELETE CASCADE,
  CONSTRAINT `checkin_room_fk` FOREIGN KEY (`room_id`) REFERENCES `room` (`_id`) ON DELETE CASCADE,
  CONSTRAINT `checkin_date` CHECK (((`enter_date` > _cp866'2020-01-01') and (`leave_date` > `enter_date`))),
  CONSTRAINT `checkin_ts` CHECK ((`date_ts` > _cp866'2020-01-01 00:00:00'))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+---------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Создание ограничений на внешние ключи при создании таблицы БРОНИ</b></summary>

```
mysql> CREATE TABLE checkin (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> date_ts TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    -> enter_date DATE NOT NULL,
    -> leave_date DATE NOT NULL,
    -> room_id INT UNSIGNED NOT NULL,
    -> client_id INT UNSIGNED NOT NULL,
    -> CONSTRAINT checkin_ts_rg CHECK(date_ts > '2020-01-01 00:00:00'),
    -> CONSTRAINT checkin_date_chk CHECK(enter_date > '2020-01-01' && leave_date > enter_date),
    -> CONSTRAINT checkin_room_fk FOREIGN KEY(room_id) REFERENCES room(_id) ON DELETE CASCADE,
    -> CONSTRAINT checkin_client_fk FOREIGN KEY(client_id) REFERENCES client(_id) ON DELETE CASCADE
    -> );
Query OK, 0 rows affected, 1 warning (0.10 sec)

mysql> SHOW CREATE TABLE checkin;
+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table   | Create Table


                                                                                                                          |
+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| checkin | CREATE TABLE `checkin` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `date_ts` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `enter_date` date NOT NULL,
  `leave_date` date NOT NULL,
  `room_id` int unsigned NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  KEY `checkin_room_fk` (`room_id`),
  KEY `checkin_client_fk` (`client_id`),
  CONSTRAINT `checkin_client_fk` FOREIGN KEY (`client_id`) REFERENCES `client` (`_id`) ON DELETE CASCADE,
  CONSTRAINT `checkin_room_fk` FOREIGN KEY (`room_id`) REFERENCES `room` (`_id`) ON DELETE CASCADE,
  CONSTRAINT `checkin_date_chk` CHECK (((`enter_date` > _cp866'2020-01-01') and (`leave_date` > `enter_date`))),
  CONSTRAINT `checkin_ts_rg` CHECK ((`date_ts` > _cp866'2020-01-01 00:00:00'))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>


#### Задача 4

<details>
<summary><b>Удаление ограничений для таблицы КОМФОРТ</b></summary>

```
mysql> ALTER TABLE comfort
    -> DROP CONSTRAINT comfort_name_ne_chk,
    -> DROP INDEX type_name
    -> ;
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW CREATE TABLE comfort;
+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table   | Create Table                                                                                                                                                                                        |
+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| comfort | CREATE TABLE `comfort` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `type_name` varchar(10) NOT NULL,
  PRIMARY KEY (`_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Удаление ограничений для таблицы НОМЕРА</b></summary>

```
mysql> ALTER TABLE room
    -> DROP CONSTRAINT room_comfort_fk,
    -> DROP CONSTRAINT room_capacity_rg,
    -> DROP CONSTRAINT room_number_ne,
    -> DROP CONSTRAINT room_phone_pt,
    -> DROP CONSTRAINT room_price_rg,
    -> DROP INDEX room_number_uq,
    -> DROP INDEX room_phone_uq,
    -> DROP INDEX room_comfort_fk
    -> ;
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW CREATE TABLE room;
+-------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table
                                                                                                               |
+-------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| room  | CREATE TABLE `room` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `number` varchar(10) NOT NULL,
  `capacity` tinyint unsigned NOT NULL,
  `price` decimal(8,2) NOT NULL,
  `phone_number` varchar(10) NOT NULL,
  `comfort_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Удаление ограничений для таблицы КЛИЕНТЫ</b></summary>

```
mysql> ALTER TABLE client
    -> DROP CONSTRAINT client_birth_rg,
    -> DROP CONSTRAINT client_name_ne,
    -> DROP CONSTRAINT client_passport_ft,
    -> DROP INDEX passport_number
    -> ;
Query OK, 0 rows affected (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW CREATE TABLE client;
+--------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table  | Create Table
                                                                                                                                                                        |
+--------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| client | CREATE TABLE `client` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `last_name` varchar(20) NOT NULL,
  `first_name` varchar(20) NOT NULL,
  `second_name` varchar(20) NOT NULL,
  `passport_number` char(10) NOT NULL,
  `birth_date` date NOT NULL,
  `address` varchar(100) DEFAULT NULL,
  `comment` text,
  PRIMARY KEY (`_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+--------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Удаление ограничений для таблицы СКИДКИ</b></summary>

```
mysql> ALTER TABLE discount
    -> DROP CONSTRAINT discount_category_ne,
    -> DROP CONSTRAINT discount_value_rg,
    -> DROP INDEX discount_category_uq
    -> ;
Query OK, 0 rows affected (0.09 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW CREATE TABLE discount;
+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table    | Create Table
        |
+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| discount | CREATE TABLE `discount` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `category_name` varchar(30) NOT NULL,
  `value` decimal(3,2) NOT NULL,
  PRIMARY KEY (`_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Удаление ограничений для таблицы ТЕЛЕФОНЫ</b></summary>

```
mysql> ALTER TABLE phone
    -> DROP CONSTRAINT phone_client_fk,
    -> DROP CONSTRAINT phone_number_pt,
    -> DROP INDEX phone_number_uq,
    -> DROP INDEX phone_client_fk
    -> ;
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW CREATE TABLE phone;
+-------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table                                                                                                                                                                                                                     |
+-------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| phone | CREATE TABLE `phone` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `number` char(10) NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Удаление ограничений для таблицы БРОНИ</b></summary>

```
mysql> ALTER TABLE reservation
    -> DROP CONSTRAINT reservation_client_fk,
    -> DROP CONSTRAINT reservation_room_fk,
    -> DROP CONSTRAINT reservation_date_chk,
    -> DROP CONSTRAINT reservation_ts_rg,
    -> DROP INDEX reservation_client_fk,
    -> DROP INDEX reservation_room_fk
    -> ;
Query OK, 0 rows affected (0.00 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW CREATE TABLE reservation;
+-------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table       | Create Table
                                                                                                                                   |
+-------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| reservation | CREATE TABLE `reservation` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `date_ts` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `enter_date` date NOT NULL,
  `leave_date` date NOT NULL,
  `room_id` int unsigned NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><b>Удаление ограничений для таблицы ПОСЕЛЕНИЯ</b></summary>

```
mysql> ALTER TABLE checkin
    -> DROP CONSTRAINT checkin_client_fk,
    -> DROP CONSTRAINT checkin_room_fk,
    -> DROP CONSTRAINT checkin_date_chk,
    -> DROP CONSTRAINT checkin_ts_rg,
    -> DROP INDEX checkin_client_fk,
    -> DROP INDEX checkin_room_fk
    -> ;
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW CREATE TABLE checkin;
+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table   | Create Table
                                                                                                                           |
+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| checkin | CREATE TABLE `checkin` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `date_ts` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `enter_date` date NOT NULL,
  `leave_date` date NOT NULL,
  `room_id` int unsigned NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

## Работа 7.O. «Создание базы данных в среде MySQL Workbench»

```
mysql> SHOW DATABASES;
+--------------------+
| Database           |
+--------------------+
| hotel              |
| information_schema |
| mysql              |
| mytest             |
| performance_schema |
| sys                |
+--------------------+
6 rows in set (0.00 sec)

mysql> USE hotel
Database changed
mysql> SHOW TABLES;
+-----------------+
| Tables_in_hotel |
+-----------------+
| checkin         |
| client          |
| client_discount |
| comfort         |
| discount        |
| phone           |
| reservation     |
| room            |
+-----------------+
8 rows in set (0.08 sec)
```

## Работа 9.O. «Простые запросы на выборку»

<details>
<summary><b>Скрипт вставки данных</b></summary>

```sql
INSERT INTO comfort(type_name)
    VALUES
    ("обычный"),
    ("полулюкс"),
    ("люкс")
;

INSERT INTO client(last_name, first_name, second_name, passport_number, birth_date, address, comment) 
    VALUES
    ('Капралов', 'Герман', 'Петрович', '6921698435', '1961-10-21', 'ул. Дуки, д. 80, г. Брянск, Брянская обл., 241050', NULL),
    ('Сидоров', 'Сидор', 'Сидорович', '7863523156', '1975-03-08', 'ул. Советская, д. 23, г. Тверь, Тверская обл., 170100', NULL),
    ('Иванов', 'Иван', 'Иванович', '0569836879', '1985-02-16', 'Воскресенский б-р, д. 3, г. Великий Новгород, Новгородская область, 173002', 'Не любит шум'),
    ('Суворова', 'Галина', 'Ивановна', '9874563215', '1975-04-03', 'пл. Ленина, д. 2, г. Махачкала, Республика Дагестан, 367000', NULL),
    ('Петров', 'Степан', 'Викторович', '0786534882', '1965-08-21', 'ул. Калиновская, д. 38, г. Кострома, Костромская обл., 156013', NULL),
    ('Решетникова', 'Анна', 'Владимировна', '6798563549', '1973-08-09', 'ул. Победы, д. 3, корп. С, г. Назрань, Республика Ингушетия, 386102', 'Крайне обидчива'),
    ('Ян', 'Мария', 'Григорьевна', '9804356987', '1994-05-24', 'ул. Свободы, д. 46, г. Ярославль, Ярославская обл., 150000', NULL),
    ('Самохвалов', 'Юрий', 'Петрович', '7888632153', '1952-02-22', 'ул. Холодильная, д. 58а, г. Тюмень, Тюменская обл., 625048', 'Очень уважаемый человек'),
    ('Чижиков', 'Михаил', 'Николаевич', '5468654932', '2001-07-14', 'ул. Московская, д. 55, г. Казань, Республика Татарстан, 420021', NULL),
    ('Капралова', 'Светлана', 'Борисовна', '5428965246', '1975-04-19', '4-я линия В.О., д. 13, лит. А, г. Санкт-Петербург, 199004', NULL),
    ('Лапина', 'Марина', 'Александровна', '0428456828', '1988-03-17', 'пр-т Ворошиловский, д. 2/2, офис 403, г. Ростов-на-Дону, Ростовская обл., 344006', NULL),
    ('Красавин', 'Вадим', 'Анатольевич', '7689254981', '1985-03-30', 'пр-т К. Маркса, д. 12А, г. Омск, Омская обл., 644010', 'Отличный парень'),
    ('Пень', 'Юрий', 'Васильевич', '7899245684', '1949-01-01', 'ул. Книповича, д. 9а, г. Мурманск, Мурманская обл., 183038', NULL),
    ('Мединская', 'Ирина', 'Глебовна', '7788654587', '2003-12-31', 'ул. Карла Либкнехта, д. 55, г. Киров, Кировская обл., 610020', NULL),
    ('Агапова', 'Софья', 'Филипповна', '4529999542', '1948-02-13', 'ул. Жарова, д. 10, г. Иваново, Ивановская обл., 153000', 'Добрая бабуля'),
    ('Соколов', 'Михаил', 'Иванович', '5793249563', '1988-07-16', 'ул. Ленина, д. 40, г. Майкоп, Республика Адыгея, 385000', NULL),
    ('Рогов', 'Александр', 'Владимирович', '8743698421', '1953-05-30', 'ул. Улагашева, д. 13, г. Горно-Алтайск, Республика Алтай, 649000', NULL),
    ('Васильев', 'Александр', 'Александрович', '5468983123', '1958-08-12', 'пр-т Калинина, д. 8, г. Барнаул, Алтайский край, 656002', 'Историк моды'),
    ('Фролов', 'Иван', 'Павлович', '7892697635', '1979-08-03', 'ул. Амурская, д. 150, г. Благовещенск, Амурская обл., 675000', NULL),
    ('Ампилов', 'Виктор', 'Иванович', '6548652325', '2005-10-02', 'ул. Большая Московская, д. 1, г. Владимир, Владимирская обл., 600000', NULL),
    ('Суриков', 'Василий', 'Петрович', '5498324568', '1956-12-20', 'ул. 7-я Гвардейская, д. 12, г. Волгоград, Волгоградская обл., 400005', NULL),
    ('Матвиенко', 'Александр', 'Александрович', '5469842632', '1996-05-02', 'ул. К. Либкнехта, д. 2, г. Архангельск, Архангельская обл., 163000', 'футболист'),
    ('Фролова', 'Анна', 'Тарасовна', '7842359821', '1997-07-19', 'ул. Шаумяна, д. 47, г. Астрахань, Астраханская обл., 414000', NULL),
    ('Симонов', 'Александр', 'Михайлович', '4569487532', '1974-11-15', 'ул. Пушкина, д. 95, г. Уфа, Республика Башкортостан, 450008', NULL),
    ('Северов', 'Нестор', 'Петрович', '7865243896', '1965-04-29', 'ул. Ленина, д. 55, г. Улан-Удэ, Республика Бурятия, 670000', 'Новенький')
;

INSERT INTO room(number, capacity, price, phone_number, comfort_id) VALUES
    ('213', 2, 2950, '512', 1),
    ('303', 2, 4320, '128', 2),
    ('506', 3, 7800, '32', 3),
    ('225', 1, 2100, '8', 1),
    ('202', 1, 2500, '4', 1),
    ('123', 3, 3400, '1024', 1),
    ('101', 1, 2950, '256', 1),
    ('11', 4, 7320, '3', 2),
    ('707', 5, 10580, '2', 3),
    ('555', 4, 9230, '64', 3),
    ('128', 2, 999, '1', 1),
    ('754', 2, 3225, '2048', 2),
    ('65', 3, 2999, '4096', 1),
    ('78', 3, 3134, '8192', 2)
;

INSERT INTO discount(category_name, value) VALUES
    ('Герой труда', 0.15),
    ('Ликвидатор', 0.1),
    ('Постоянный', 0.25),
    ('Ветеран труда', 0.1),
    ('Многодетный',', '0.05),
    ('Сотрудник', 0.33)
;

INSERT INTO client_discount(client_id, discount_id) VALUES
    (2, 3),
    (3, 3),
    (4, 5),
    (5, 3),
    (5, 4),
    (9, 6),
    (14, 6),
    (1, 1),
    (1, 2),
    (13, 1),
    (14, 6),
    (15, 1)
;

INSERT INTO phone(number, client_id) VALUES
    (9616594269, 1),
    (9015672132, 2),
    (9315685669, 3),
    (9815642465, 4),
    (9258746921, 5),
    (9315682215, 5),
    (3477217732, 6),
    (9625982531, 7),
    (9216942498, 7),
    (9125673223, 8),
    (9216489632, 9),
    (9315795328, 9),
    (9305482211, 10),
    (9227741318, 11),
    (9268972223, 12),
    (9265672369, 13),
    (9995465757, 14),
    (3216870002, 15)
;

INSERT INTO reservation(date_ts, enter_date, leave_date, room_id, client_id) VALUES
    ('2023-10-13', '2023-11-16', '2023-12-02', 1, 1),
    ('2023-11-14', '2023-12-28', '2024-01-17', 2, 2),
    ('2023-11-17', '2024-02-12', '2024-03-06', 5, 5),
    ('2023-12-25', '2024-02-03', '2024-03-11', 7, 2),
    ('2023-11-17', '2024-01-03', '2024-01-18', 8, 7),
    ('2023-11-22', '2024-02-01', '2024-02-22', 9, 8),
    ('2023-10-13', '2023-11-16', '2023-12-2', 1, 10),
    ('2023-11-20', '2024-02-03', '2024-03-04', 3, 6),
    ('2023-11-27', '2023-12-15', '2024-01-07', 10, 14),
    ('2023-12-04', '2024-04-14', '2024-04-28', 7, 15)
;


INSERT INTO checkin(date_ts, enter_date, leave_date, room_id, client_id) VALUES
    ('2023-11-16', '2023-11-16', '2023-12-10', 1, 1),
    ('2023-12-28', '2023-12-28', '2024-01-17', 2, 2),
    ('2023-11-14', '2023-11-14', '2023-11-28', 3, 3),
    ('2018-06-11', '2018-06-11', '2018-07-05', 7, 18),
    ('2023-12-01', '2023-12-01', '2023-12-29', 4, 4),
    ('2023-12-12', '2023-12-12', '2024-01-05', 6, 6),
    ('2021-04-01', '2021-04-01', '2021-04-29', 9, 16),
    ('2023-11-26', '2023-11-26', '2023-12-04', 10, 9),
    ('2023-11-16', '2023-11-16', '2023-12-10', 1, 10),
    ('2023-11-17', '2023-11-17', '2023-11-25', 5, 12),
    ('2022-04-12', '2022-04-12', '2022-06-18', 8, 15),
    ('2023-11-19', '2023-11-19', '2023-11-23', 5, 11),
    ('2023-11-16', '2023-11-16', '2023-12-31', 2, 13),
    ('2018-07-15', '2018-07-15', '2018-08-30', 11, 20),
    ('2023-12-12', '2023-12-12', '2024-01-01', 15, 23),
    ('2024-04-05', '2024-04-05', '2024-05-01', 7, 14),
    ('2018-01-01', '2018-01-01', '2018-04-28', 15, 23),
    ('2023-04-30', '2023-04-30', '2024-06-21', 10, 17)
;

```

</details>

### Задача 1
Вывести данные о клиентах: ФИО, номер паспорта, отсортировать по убыванию паспорта.

<details>
<summary><b>Простой запрос</b></summary>

```
SELECT last_name AS "Фамилия", 
  first_name AS "Имя", 
  second_name AS "Отчество", 
  passport_number AS "Номер паспорта*"
  FROM client
  ORDER BY passport_number DESC
;

mysql> SELECT last_name AS "Фамилия", first_name AS "Имя", second_name AS "Отчество", passport_number AS "Номер паспорта*"
    -> FROM client
    -> ORDER BY passport_number DESC
    -> ;
+-------------+-----------+---------------+-----------------+
| Фамилия     | Имя       | Отчество      | Номер паспорта* |
+-------------+-----------+---------------+-----------------+
| Суворова    | Галина    | Ивановна      | 9874563215      |
| Ян          | Мария     | Григорьевна   | 9804356987      |
| Рогов       | Александр | Владимирович  | 8743698421      |
| Пень        | Юрий      | Васильевич    | 7899245684      |
| Фролов      | Иван      | Павлович      | 7892697635      |
| Самохвалов  | Юрий      | Петрович      | 7888632153      |
| Северов     | Нестор    | Петрович      | 7865243896      |
| Сидоров     | Сидор     | Сидорович     | 7863523156      |
| Фролова     | Анна      | Тарасовна     | 7842359821      |
| Мединская   | Ирина     | Глебовна      | 7788654587      |
| Красавин    | Вадим     | Анатольевич   | 7689254981      |
| Капралов    | Герман    | Петрович      | 6921698435      |
| Решетникова | Анна      | Владимировна  | 6798563549      |
| Ампилов     | Виктор    | Иванович      | 6548652325      |
| Соколов     | Михаил    | Иванович      | 5793249563      |
| Суриков     | Василий   | Петрович      | 5498324568      |
| Матвиенко   | Александр | Александрович | 5469842632      |
| Васильев    | Александр | Александрович | 5468983123      |
| Чижиков     | Михаил    | Николаевич    | 5468654932      |
| Капралова   | Светлана  | Борисовна     | 5428965246      |
| Симонов     | Александр | Михайлович    | 4569487532      |
| Агапова     | Софья     | Филипповна    | 4529999542      |
| Петров      | Степан    | Викторович    | 0786534882      |
| Иванов      | Иван      | Иванович      | 0569836879      |
| Лапина      | Марина    | Александровна | 0428456828      |
+-------------+-----------+---------------+-----------------+
25 rows in set (0.00 sec)

```
</details>

```sql
SELECT 
  CONCAT(last_name, ' ', first_name, ' ', second_name) AS "ФИО", 
  CONCAT(SUBSTRING(passport_number, 1, 4), ' ', SUBSTRING(passport_number, 5)) AS "Номер паспорта*"
  FROM client
  ORDER BY passport_number DESC
;
```

<details>
<summary><b>Запрос с форматированием вывода</b></summary>

```
mysql> SELECT
    -> CONCAT(last_name, ' ', first_name, ' ', second_name) AS "ФИО",
    -> CONCAT(SUBSTRING(passport_number, 1, 4), ' ', SUBSTRING(passport_number, 5)) AS "Номер паспорта*"
    -> FROM client
    -> ORDER BY passport_number DESC
    -> ;
+-----------------------------------+-----------------+
| ФИО                               | Номер паспорта* |
+-----------------------------------+-----------------+
| Суворова Галина Ивановна          | 9874 563215     |
| Ян Мария Григорьевна              | 9804 356987     |
| Рогов Александр Владимирович      | 8743 698421     |
| Пень Юрий Васильевич              | 7899 245684     |
| Фролов Иван Павлович              | 7892 697635     |
| Самохвалов Юрий Петрович          | 7888 632153     |
| Северов Нестор Петрович           | 7865 243896     |
| Сидоров Сидор Сидорович           | 7863 523156     |
| Фролова Анна Тарасовна            | 7842 359821     |
| Мединская Ирина Глебовна          | 7788 654587     |
| Красавин Вадим Анатольевич        | 7689 254981     |
| Капралов Герман Петрович          | 6921 698435     |
| Решетникова Анна Владимировна     | 6798 563549     |
| Ампилов Виктор Иванович           | 6548 652325     |
| Соколов Михаил Иванович           | 5793 249563     |
| Суриков Василий Петрович          | 5498 324568     |
| Матвиенко Александр Александрович | 5469 842632     |
| Васильев Александр Александрович  | 5468 983123     |
| Чижиков Михаил Николаевич         | 5468 654932     |
| Капралова Светлана Борисовна      | 5428 965246     |
| Симонов Александр Михайлович      | 4569 487532     |
| Агапова Софья Филипповна          | 4529 999542     |
| Петров Степан Викторович          | 0786 534882     |
| Иванов Иван Иванович              | 0569 836879     |
| Лапина Марина Александровна       | 0428 456828     |
+-----------------------------------+-----------------+
25 rows in set (0.00 sec)

```
</details>

### Задача 2
Вывести две первые записи о номерах, в которых комфортность люкс.

```sql
SELECT * 
  FROM room
  WHERE comfort_id=3
  LIMIT 2
;
```

<details>
<summary><b>Простой запрос</b></summary>

```
mysql> SELECT *
    -> FROM room
    -> WHERE comfort_id=3
    -> LIMIT 2
    -> ;
+-----+--------+----------+----------+--------------+------------+
| _id | number | capacity | price    | phone_number | comfort_id |
+-----+--------+----------+----------+--------------+------------+
|   3 | 506    |        3 |  7800.00 | 32           |          3 |
|   8 | 707    |        5 | 10580.00 | 2            |          3 |
+-----+--------+----------+----------+--------------+------------+
2 rows in set (0.00 sec)

```
</details>

### Задача 3
Вывести три записи с кодами клиентов, которые поселились в апреле.

```sql
SELECT * 
  FROM checkin
  WHERE MONTH(enter_date)=4
  LIMIT 3
;
```

<details>
<summary><b>Простой запрос</b></summary>

```
mysql> SELECT *
    -> FROM checkin
    -> WHERE MONTH(enter_date)=4
    -> LIMIT 3
    -> ;
+-----+---------------------+------------+------------+---------+-----------+
| _id | date_ts             | enter_date | leave_date | room_id | client_id |
+-----+---------------------+------------+------------+---------+-----------+
|   6 | 2024-05-08 02:02:10 | 2021-04-01 | 2021-04-29 |       9 |        16 |
|  10 | 2024-05-08 02:02:10 | 2022-04-12 | 2022-06-18 |       8 |        15 |
|  15 | 2024-05-08 02:02:10 | 2024-04-05 | 2024-05-01 |       7 |        14 |
+-----+---------------------+------------+------------+---------+-----------+
3 rows in set (0.00 sec)

```
</details>

### Задача 4
Вывести номера, где количество человек не 4.

<details>
<summary><b>Простой запрос</b></summary>

```
SELECT * 
  FROM room
  WHERE capacity <> 4
;

mysql> SELECT *
    -> FROM room
    -> WHERE capacity <> 4
    -> ;
+-----+--------+----------+----------+--------------+------------+
| _id | number | capacity | price    | phone_number | comfort_id |
+-----+--------+----------+----------+--------------+------------+
|   1 | 213    |        2 |  2950.00 | 512          |          1 |
|   2 | 303    |        2 |  4320.00 | 128          |          2 |
|   3 | 506    |        3 |  7800.00 | 32           |          3 |
|   4 | 225    |        1 |  2100.00 | 8            |          1 |
|   5 | 202    |        1 |  2500.00 | 4            |          1 |
|   6 | 123    |        3 |  3400.00 | 1024         |          1 |
|   7 | 101    |        1 |  2950.00 | 256          |          1 |
|   9 | 707    |        5 | 10580.00 | 2            |          3 |
|  11 | 128    |        2 |   999.00 | 1            |          1 |
|  12 | 754    |        2 |  3225.00 | 2048         |          2 |
|  13 | 65     |        3 |  2999.00 | 4096         |          1 |
|  14 | 78     |        3 |  3134.00 | 8192         |          2 |
+-----+--------+----------+----------+--------------+------------+
12 rows in set (0.01 sec)

```
</details>

### Задача 5
Вывести данные о номерах, в которых цена номера более 5000 и комфортность полулюкс.

```sql
SELECT * 
  FROM room
  WHERE price > 5000 AND comfort_id = 2
;
```

<details>
<summary><b>Простой запрос</b></summary>

```
mysql> SELECT *
    -> FROM room
    -> WHERE price > 5000 AND comfort_id = 2
    -> ;
+-----+--------+----------+---------+--------------+------------+
| _id | number | capacity | price   | phone_number | comfort_id |
+-----+--------+----------+---------+--------------+------------+
|   8 | 11     |        4 | 7320.00 | 3            |          2 |
+-----+--------+----------+---------+--------------+------------+
1 row in set (0.00 sec)

```
</details>

### Задача 6
Вывести номера на двоих с обычной комфортностью и стоимостью не более 1000.

```sql
SELECT * 
  FROM room
  WHERE comfort_id = 1 AND price <= 1000
;
```

<details>
<summary><b>Простой запрос</b></summary>

```
mysql> SELECT *
    -> FROM room
    -> WHERE comfort_id = 1 AND price <= 1000
    -> ;
+-----+--------+----------+--------+--------------+------------+
| _id | number | capacity | price  | phone_number | comfort_id |
+-----+--------+----------+--------+--------------+------------+
|  11 | 128    |        2 | 999.00 | 1            |          1 |
+-----+--------+----------+--------+--------------+------------+
1 row in set (0.00 sec)

```
</details>

### Задача 7
Вывести номера, где комфортность не люкс и цена не 1000.

<details>
<summary><b>Простой запрос</b></summary>

```
SELECT * 
  FROM room
  WHERE (comfort_id <> 3 AND price <> 1000)
;

mysql> SELECT *
    -> FROM room
    -> WHERE comfort_id != 3 && price <> 1000
    -> ;
+-----+--------+----------+---------+--------------+------------+
| _id | number | capacity | price   | phone_number | comfort_id |
+-----+--------+----------+---------+--------------+------------+
|   1 | 213    |        2 | 2950.00 | 512          |          1 |
|   2 | 303    |        2 | 4320.00 | 128          |          2 |
|   4 | 225    |        1 | 2100.00 | 8            |          1 |
|   5 | 202    |        1 | 2500.00 | 4            |          1 |
|   6 | 123    |        3 | 3400.00 | 1024         |          1 |
|   7 | 101    |        1 | 2950.00 | 256          |          1 |
|   8 | 11     |        4 | 7320.00 | 3            |          2 |
|  11 | 128    |        2 |  999.00 | 1            |          1 |
|  12 | 754    |        2 | 3225.00 | 2048         |          2 |
|  13 | 65     |        3 | 2999.00 | 4096         |          1 |
|  14 | 78     |        3 | 3134.00 | 8192         |          2 |
+-----+--------+----------+---------+--------------+------------+
11 rows in set (0.00 sec)

```
</details>

### Задача 8
Вывести данные о номерах, в которых количество человек в номере от 1 до 3, а цена менее 3500 руб

```sql
SELECT * 
  FROM room
  WHERE capacity BETWEEN 1 AND 3 && price < 3500
;
```

<details>
<summary><b>Простой запрос</b></summary>

```
mysql> SELECT *
    -> FROM room
    -> WHERE capacity BETWEEN 1 AND 3 && price < 3500
    -> ;
+-----+--------+----------+---------+--------------+------------+
| _id | number | capacity | price   | phone_number | comfort_id |
+-----+--------+----------+---------+--------------+------------+
|   1 | 213    |        2 | 2950.00 | 512          |          1 |
|   4 | 225    |        1 | 2100.00 | 8            |          1 |
|   5 | 202    |        1 | 2500.00 | 4            |          1 |
|   6 | 123    |        3 | 3400.00 | 1024         |          1 |
|   7 | 101    |        1 | 2950.00 | 256          |          1 |
|  11 | 128    |        2 |  999.00 | 1            |          1 |
|  12 | 754    |        2 | 3225.00 | 2048         |          2 |
|  13 | 65     |        3 | 2999.00 | 4096         |          1 |
|  14 | 78     |        3 | 3134.00 | 8192         |          2 |
+-----+--------+----------+---------+--------------+------------+
9 rows in set, 1 warning (0.00 sec)

```
</details>

## Работа 10.O. «Специальные операторы в условиях выборки запроса»

### Задача 1
Вывести данные о номерах, в которых цена номера от 2000 руб. до 5000 руб.

```sql
SELECT *
  FROM room
  WHERE price BETWEEN 2000 AND 5000
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT *
    -> FROM room
    -> WHERE price BETWEEN 2000 AND 5000
    -> ;
+-----+--------+----------+---------+--------------+------------+
| _id | number | capacity | price   | phone_number | comfort_id |
+-----+--------+----------+---------+--------------+------------+
|   1 | 213    |        2 | 2950.00 | 512          |          1 |
|   2 | 303    |        2 | 4320.00 | 128          |          2 |
|   4 | 225    |        1 | 2100.00 | 8            |          1 |
|   5 | 4      |        4 | 4000.00 | 202          |          1 |
|   6 | 202    |        1 | 2500.00 | 4            |          1 |
|   7 | 123    |        3 | 3400.00 | 1024         |          1 |
|   8 | 101    |        1 | 2950.00 | 256          |          1 |
|  10 | 5      |        5 | 5000.00 | 5            |          2 |
|  14 | 754    |        2 | 3225.00 | 2048         |          2 |
|  16 | 65     |        3 | 2999.00 | 4096         |          1 |
|  17 | 78     |        3 | 3134.00 | 8192         |          2 |
+-----+--------+----------+---------+--------------+------------+
11 rows in set (0.00 sec)

```
</details>

### Задача 2
Вывести данные о номерах, в которых количество человек в номере от 1 до 3, а цена менее 3500 руб.

```sql
SELECT *
  FROM room
  WHERE capacity BETWEEN 1 AND 3 && price < 3500
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT *
    -> FROM room
    -> WHERE capacity BETWEEN 1 AND 3 && price < 3500
    -> ;
+-----+--------+----------+---------+--------------+------------+
| _id | number | capacity | price   | phone_number | comfort_id |
+-----+--------+----------+---------+--------------+------------+
|   1 | 213    |        2 | 2950.00 | 512          |          1 |
|   4 | 225    |        1 | 2100.00 | 8            |          1 |
|   6 | 202    |        1 | 2500.00 | 4            |          1 |
|   7 | 123    |        3 | 3400.00 | 1024         |          1 |
|   8 | 101    |        1 | 2950.00 | 256          |          1 |
|  13 | 128    |        2 |  999.00 | 1            |          1 |
|  14 | 754    |        2 | 3225.00 | 2048         |          2 |
|  16 | 65     |        3 | 2999.00 | 4096         |          1 |
|  17 | 78     |        3 | 3134.00 | 8192         |          2 |
+-----+--------+----------+---------+--------------+------------+
9 rows in set, 1 warning (0.00 sec)

```
</details>

### Задача 3
Вывести данные о поселении в номера, которые не были заключены с 11.06.2018 г. по 29.08.2018.

```sql
SELECT *
  FROM checkin
  WHERE date_ts NOT BETWEEN "2018-06-11" AND "2018-08-29"
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT *
    -> FROM checkin
    -> WHERE date_ts NOT BETWEEN "2018-06-11" AND "2018-08-29"
    -> ;
+-----+---------------------+------------+------------+---------+-----------+
| _id | date_ts             | enter_date | leave_date | room_id | client_id |
+-----+---------------------+------------+------------+---------+-----------+
|   1 | 2023-11-16 12:25:36 | 2023-11-16 | 2023-12-10 |       1 |         1 |
|   2 | 2023-12-28 09:32:48 | 2023-12-28 | 2024-01-17 |       2 |         2 |
|   3 | 2023-11-14 11:06:12 | 2023-11-14 | 2023-11-28 |       3 |         3 |
|   5 | 2023-12-01 17:04:30 | 2023-12-01 | 2023-12-29 |       4 |         4 |
|   6 | 2023-12-12 18:07:15 | 2023-12-12 | 2024-01-05 |       6 |         6 |
|   7 | 2021-04-01 14:04:06 | 2021-04-01 | 2021-04-29 |       9 |        16 |
|   8 | 2023-11-26 13:12:02 | 2023-11-26 | 2023-12-04 |      10 |         9 |
|   9 | 2023-11-16 12:10:23 | 2023-11-16 | 2023-12-10 |       1 |        10 |
|  10 | 2023-11-17 16:11:52 | 2023-11-17 | 2023-11-25 |       5 |        12 |
|  11 | 2022-04-12 10:44:56 | 2022-04-12 | 2022-06-18 |       8 |        15 |
|  12 | 2023-11-19 19:12:38 | 2023-11-19 | 2023-11-23 |       5 |        11 |
|  13 | 2023-11-16 12:31:20 | 2023-11-16 | 2023-12-31 |       2 |        13 |
|  15 | 2023-12-12 14:23:12 | 2023-12-12 | 2024-01-01 |      14 |        23 |
|  16 | 2024-04-05 07:14:54 | 2024-04-05 | 2024-05-01 |       7 |        14 |
|  17 | 2018-01-02 13:23:48 | 2018-01-02 | 2018-04-28 |      13 |        23 |
|  18 | 2023-04-30 10:17:32 | 2023-04-30 | 2024-06-21 |      10 |        17 |
+-----+---------------------+------------+------------+---------+-----------+
16 rows in set (0.00 sec)

```
</details>

### Задача 4
Вывести данные о клиентах Соловьеве, или Агафонове, или Прокофьеве.

```sql
SELECT *
  FROM client
  WHERE last_name IN ('Соловьев', 'Агафонов', 'Прокофьев')
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT *
    -> FROM client
    -> WHERE last_name IN ('Соловьев', 'Агафонов', 'Прокофьев')
    -> ;
+-----+-----------+------------+---------------+-----------------+------------+-------------------------------------------------------------------+--------------------------------------------+
| _id | last_name | first_name | second_name   | passport_number | birth_date | address                                                           | comment                                    |
+-----+-----------+------------+---------------+-----------------+------------+-------------------------------------------------------------------+--------------------------------------------+
|   8 | Агафонов  | Валерий    | Борисович     | 6349197041      | 1941-03-10 | ул. Марата, д. 9, г. Курск, Курская обл., 305000                  | певец                                      |
|  15 | Соловьев  | Владимир   | Рудовольфович | 5679546321      | 1963-10-20 | наб. Варкауса, д. 1А, г. Петрозаводск, Республика Карелия, 185031 | российский журналист, радио- и телеведущий |
+-----+-----------+------------+---------------+-----------------+------------+-------------------------------------------------------------------+--------------------------------------------+
2 rows in set (0.00 sec)

```
</details>

### Задача 5
Вывести данные о номерах с ценами не 4000 руб., или не 5000 руб., или не 6500 руб.

```sql
SELECT *
  FROM room
  WHERE price NOT IN (4000, 5000, 6500)
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT *
    -> FROM room
    -> WHERE price NOT IN (4000, 5000, 6500)
    -> ;
+-----+--------+----------+----------+--------------+------------+
| _id | number | capacity | price    | phone_number | comfort_id |
+-----+--------+----------+----------+--------------+------------+
|   1 | 213    |        2 |  2950.00 | 512          |          1 |
|   2 | 303    |        2 |  4320.00 | 128          |          2 |
|   3 | 506    |        3 |  7800.00 | 32           |          3 |
|   4 | 225    |        1 |  2100.00 | 8            |          1 |
|   6 | 202    |        1 |  2500.00 | 4            |          1 |
|   7 | 123    |        3 |  3400.00 | 1024         |          1 |
|   8 | 101    |        1 |  2950.00 | 256          |          1 |
|   9 | 11     |        4 |  7320.00 | 3            |          2 |
|  11 | 707    |        5 | 10580.00 | 2            |          3 |
|  12 | 555    |        4 |  9230.00 | 64           |          3 |
|  13 | 128    |        2 |   999.00 | 1            |          1 |
|  14 | 754    |        2 |  3225.00 | 2048         |          2 |
|  15 | 6      |        6 |  6000.00 | 6            |          3 |
|  16 | 65     |        3 |  2999.00 | 4096         |          1 |
|  17 | 78     |        3 |  3134.00 | 8192         |          2 |
+-----+--------+----------+----------+--------------+------------+
15 rows in set (0.00 sec)

```
</details>

### Задача 6
Вывести сведения о номерах с кодом комфортности 2, или 4, или 5 и ценой не 3500 руб., или не 4500, или не 5000 руб.

```sql
SELECT *
  FROM room
  WHERE comfort_id IN (2, 4, 5) AND price NOT IN (3500, 4500, 5000)
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT *
    -> FROM room
    -> WHERE comfort_id IN (2, 4, 5) AND price NOT IN (3500, 4500, 5000)
    -> ;
+-----+--------+----------+---------+--------------+------------+
| _id | number | capacity | price   | phone_number | comfort_id |
+-----+--------+----------+---------+--------------+------------+
|   2 | 303    |        2 | 4320.00 | 128          |          2 |
|   9 | 11     |        4 | 7320.00 | 3            |          2 |
|  14 | 754    |        2 | 3225.00 | 2048         |          2 |
|  17 | 78     |        3 | 3134.00 | 8192         |          2 |
+-----+--------+----------+---------+--------------+------------+
4 rows in set (0.00 sec)

```
</details>

### Задача 7
Вывести сведения о клиентах, фамилии которых не начинаются на букву «С».

```sql
SELECT *
  FROM client
  WHERE last_name NOT LIKE "С%"
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT * FROM client WHERE last_name NOT LIKE "С%";
+-----+-------------+------------+---------------+-----------------+------------+----------------------------------------------------------------------------------+-----------------+
| _id | last_name   | first_name | second_name   | passport_number | birth_date | address                                                                          | comment         |
+-----+-------------+------------+---------------+-----------------+------------+----------------------------------------------------------------------------------+-----------------+
|   1 | Капралов    | Герман     | Петрович      | 6921698435      | 1961-10-21 | ул. Дуки, д. 80, г. Брянск, Брянская обл., 241050                                | NULL            |
|   3 | Иванов      | Иван       | Иванович      | 0569836879      | 1985-02-16 | Воскресенский б-р, д. 3, г. Великий Новгород, Новгородская область, 173002       | Не любит шум    |
|   5 | Петров      | Степан     | Викторович    | 0786534882      | 1965-08-21 | ул. Калиновская, д. 38, г. Кострома, Костромская обл., 156013                    | NULL            |
|   6 | Решетникова | Анна       | Владимировна  | 6798563549      | 1973-08-09 | ул. Победы, д. 3, корп. С, г. Назрань, Республика Ингушетия, 386102              | Крайне обидчива |
|   7 | Ян          | Мария      | Григорьевна   | 9804356987      | 1994-05-24 | ул. Свободы, д. 46, г. Ярославль, Ярославская обл., 150000                       | NULL            |
|   8 | Агафонов    | Валерий    | Борисович     | 6349197041      | 1941-03-10 | ул. Марата, д. 9, г. Курск, Курская обл., 305000                                 | певец           |
|  10 | Чижиков     | Михаил     | Николаевич    | 5468654932      | 2001-07-14 | ул. Московская, д. 55, г. Казань, Республика Татарстан, 420021                   | NULL            |
|  11 | Капралова   | Светлана   | Борисовна     | 5428965246      | 1975-04-19 | 4-я линия В.О., д. 13, лит. А, г. Санкт-Петербург, 199004                        | NULL            |
|  12 | Лапина      | Марина     | Александровна | 0428456828      | 1988-03-17 | пр-т Ворошиловский, д. 2/2, офис 403, г. Ростов-на-Дону, Ростовская обл., 344006 | NULL            |
|  13 | Красавин    | Вадим      | Анатольевич   | 7689254981      | 1985-03-30 | пр-т К. Маркса, д. 12А, г. Омск, Омская обл., 644010                             | Отличный парень |
|  14 | Пень        | Юрий       | Васильевич    | 7899245684      | 1949-01-01 | ул. Книповича, д. 9а, г. Мурманск, Мурманская обл., 183038                       | NULL            |
|  16 | Мединская   | Ирина      | Глебовна      | 7788654587      | 2003-12-31 | ул. Карла Либкнехта, д. 55, г. Киров, Кировская обл., 610020                     | NULL            |
|  17 | Агапова     | Софья      | Филипповна    | 4529999542      | 1948-02-13 | ул. Жарова, д. 10, г. Иваново, Ивановская обл., 153000                           | Добрая бабуля   |
|  19 | Рогов       | Александр  | Владимирович  | 8743698421      | 1953-05-30 | ул. Улагашева, д. 13, г. Горно-Алтайск, Республика Алтай, 649000                 | NULL            |
|  20 | Васильев    | Александр  | Александрович | 5468983123      | 1958-08-12 | пр-т Калинина, д. 8, г. Барнаул, Алтайский край, 656002                          | Историк моды    |
|  21 | Фролов      | Иван       | Павлович      | 7892697635      | 1979-08-03 | ул. Амурская, д. 150, г. Благовещенск, Амурская обл., 675000                     | NULL            |
|  22 | Ампилов     | Виктор     | Иванович      | 6548652325      | 2005-10-02 | ул. Большая Московская, д. 1, г. Владимир, Владимирская обл., 600000             | NULL            |
|  24 | Матвиенко   | Александр  | Александрович | 5469842632      | 1996-05-02 | ул. К. Либкнехта, д. 2, г. Архангельск, Архангельская обл., 163000               | футболист       |
|  25 | Фролова     | Анна       | Тарасовна     | 7842359821      | 1997-07-19 | ул. Шаумяна, д. 47, г. Астрахань, Астраханская обл., 414000                      | NULL            |
|  28 | Просов      | Владимир   | Тимофеевич    | 1998653478      | 1991-03-03 | Мясницкий проезд, д. 4, стр. 1, г. Москва, 107078                                | NULL            |
+-----+-------------+------------+---------------+-----------------+------------+----------------------------------------------------------------------------------+-----------------+
20 rows in set (0.00 sec)

```
</details>

### Задача 8
Вывести сведения о клиентах, в фамилии которых неизвестна первая, третья и четвертая буквы.

```sql
SELECT *
  FROM client
  WHERE last_name LIKE "_а__алов"
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT *
    -> FROM client
    -> WHERE last_name LIKE "_а__алов"
    -> ;
+-----+-----------+------------+-------------+-----------------+------------+---------------------------------------------------+---------+
| _id | last_name | first_name | second_name | passport_number | birth_date | address                                           | comment |
+-----+-----------+------------+-------------+-----------------+------------+---------------------------------------------------+---------+
|   1 | Капралов  | Герман     | Петрович    | 6921698435      | 1961-10-21 | ул. Дуки, д. 80, г. Брянск, Брянская обл., 241050 | NULL    |
+-----+-----------+------------+-------------+-----------------+------------+---------------------------------------------------+---------+
1 row in set (0.00 sec)

```
</details>

### Задача 9
Вывести сведения о клиентах, фамилии которых имеют сочетание букв «осо», а отчество начинается с буквы «Т».

```sql
SELECT *
  FROM client
  WHERE last_name LIKE "%осо%" AND second_name LIKE "Т%"
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT *
    -> FROM client
    -> WHERE last_name LIKE "_а__алов"
    -> ;
+-----+-----------+------------+-------------+-----------------+------------+---------------------------------------------------+---------+
| _id | last_name | first_name | second_name | passport_number | birth_date | address                                           | comment |
+-----+-----------+------------+-------------+-----------------+------------+---------------------------------------------------+---------+
|  28 | Просов    | Владимир   | Тимофеевич  | 1998653478      | 1991-03-03 | Мясницкий проезд, д. 4, стр. 1, г. Москва, 107078 | NULL    |
+-----+-----------+------------+-------------+-----------------+------------+---------------------------------------------------+---------+
1 row in set (0.00 sec)

```
</details>

### Задача 10
Вывести сведения о клиентах, фамилии которых начинаются с буквы «В» по букву «П», а имя начинается с буквы «С».

```sql
SELECT *
  FROM client
  WHERE last_name REGEXP '^[В-П]' AND first_name LIKE "С%"
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT *
    -> FROM client
    -> WHERE last_name REGEXP '^[В-П]' AND first_name LIKE "С%"
    -> ;
+-----+-----------+------------+-------------+-----------------+------------+---------------------------------------------------------------+---------+
| _id | last_name | first_name | second_name | passport_number | birth_date | address                                                       | comment |
+-----+-----------+------------+-------------+-----------------+------------+---------------------------------------------------------------+---------+
|   5 | Петров    | Степан     | Викторович  | 0786534882      | 1965-08-21 | ул. Калиновская, д. 38, г. Кострома, Костромская обл., 156013 | NULL    |
|  11 | Капралова | Светлана   | Борисовна   | 5428965246      | 1975-04-19 | 4-я линия В.О., д. 13, лит. А, г. Санкт-Петербург, 199004     | NULL    |
+-----+-----------+------------+-------------+-----------------+------------+---------------------------------------------------------------+---------+
2 rows in set (0.00 sec)

```
</details>

## Работа 11.O. «Создание запросов на выборку с использованием группировки данных»

### Задача 1
Вывести минимальную и максимальную цену за номер.

```sql
SELECT MIN(price) AS "Минимальная цена", MAX(price) AS "Максимальная цена"
  FROM room
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT MIN(price) AS "Минимальная цена", MAX(price) AS "Максимальная цена"
    -> FROM room
    -> ;
+------------------+-------------------+
| Минимальная цена | Максимальная цена |
+------------------+-------------------+
|           999.00 |          10580.00 |
+------------------+-------------------+
1 row in set (0.00 sec)

```
</details>

### Задача 2
Вывести среднюю цену за номер.

```sql
SELECT ROUND(AVG(price), 2) AS "Средняя цена за номер"
  FROM room
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT ROUND(AVG(price), 2) AS "Средняя цена за номер"
    -> FROM room
    -> ;
+-----------------------+
| Средняя цена за номер |
+-----------------------+
|               4455.94 |
+-----------------------+
1 row in set (0.00 sec)

```
</details>

### Задача 3
Вывести общую сумму человек, которые могут разместиться в гостинице.

```sql
SELECT SUM(capacity) AS "Общая вместимость"
  FROM room
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT SUM(capacity) AS "Общая вместимость"
    -> FROM room
    -> ;
+-------------------+
| Общая вместимость |
+-------------------+
|                52 |
+-------------------+
1 row in set (0.00 sec)

```
</details>

### Задача 4
Вывести количество человек, которые были поселены в каждом году.

```sql
SELECT YEAR(enter_date) AS Год, COUNT(*) AS "Количество посетителей"
  FROM checkin
  GROUP BY Год
  ORDER BY Год DESC
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT YEAR(enter_date) AS Год, COUNT(*) AS "Количество посетителей"
    -> FROM checkin
    -> GROUP BY Год
    -> ORDER BY Год DESC
    -> ;
+------+------------------------+
| Год  | Количество посетителей |
+------+------------------------+
| 2024 |                      1 |
| 2023 |                     12 |
| 2022 |                      1 |
| 2021 |                      1 |
| 2018 |                      3 |
+------+------------------------+
5 rows in set (0.00 sec)

```
</details>

### Задача 5
Вывести количество клиентов с фамилией Симонов.

```sql
SELECT COUNT(*) AS "Количество Симоновых"
  FROM client
  WHERE last_name="Симонов"
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT COUNT(*) AS "Количество Симоновых"
    -> FROM client
    -> WHERE last_name="Симонов"
    -> ;
+----------------------+
| Количество Симоновых |
+----------------------+
|                    1 |
+----------------------+
1 row in set (0.00 sec)

```
</details>

### Задача 6
Показать количество клиентов, зафиксированных в базе, у которых имя не Наталия.

```sql
SELECT COUNT(*) AS "Не Наталий"
  FROM client
  WHERE first_name <> "Наталия"
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT COUNT(*) AS "Не Наталий"
    -> FROM client
    -> WHERE first_name <> "Наталия"
    -> ;
+------------+
| Не Наталий |
+------------+
|         28 |
+------------+
1 row in set (0.00 sec)

```
</details>

### Задача 7
Вывести среднюю цену за номера, в которых она не превышает 1700 руб.

```sql
SELECT ROUND(AVG(price), 2) "Средняя цена за номера в пределах 1700 руб."
  FROM room
  WHERE price <= 1700
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT ROUND(AVG(price), 2) "Средняя цена за номера в пределах 1700 руб."
    -> FROM room
    -> WHERE price <= 1700
    -> ;
+---------------------------------------------+
| Средняя цена за номера в пределах 1700 руб. |
+---------------------------------------------+
|                                     1349.50 |
+---------------------------------------------+
1 row in set (0.00 sec)

```
</details>

### Задача 8
Вывести количество человек, которые освободили номера в каждом году. Показать количество, не превышающее 5 человек, а код номера 2 или 4.

```sql
SELECT YEAR(leave_date) AS Год, COUNT(*) AS "Количество освободивших номер"
  FROM checkin
  WHERE room_id IN (2, 4)
  GROUP BY Год
  HAVING COUNT(*) <= 5
  ORDER BY Год DESC
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT YEAR(leave_date) AS Год, COUNT(*) AS "Количество освободивших номер"
    -> FROM checkin
    -> WHERE room_id IN (2, 4)
    -> GROUP BY Год
    -> HAVING COUNT(*) <= 5
    -> ORDER BY Год DESC
    -> ;
+------+-------------------------------+
| Год  | Количество освободивших номер |
+------+-------------------------------+
| 2024 |                             1 |
| 2023 |                             2 |
+------+-------------------------------+
2 rows in set (0.00 sec)

```
</details>

## Работа 12.O. «Создание запросов на выборку с использованием группировки данных»

Для более точного соответствия условиям запроса отношение «Клиенты» следует расширить полем «пол», что потребует изменения структуры таблицы КЛИЕНТЫ с последующим дополнением данных.


```sql
ALTER TABLE client
  ADD COLUMN sex ENUM('m', 'f') NOT NULL
  AFTER second_name
  ;

UPDATE client
  SET sex = 'f'
  WHERE _id IN (4, 6, 7, 11, 12, 16, 17, 25)
;

UPDATE checkin SET date_ts='2023-11-16 12:25:36' WHERE _id=1;
UPDATE checkin SET date_ts='' WHERE _id=;
```

Get Age:

SELECT TIMESTAMPDIFF (YEAR, birth_date, CURDATE()) FROM client AS Age;

<details>
<summary><b>Запрос</b></summary>


```
mysql> ALTER TABLE client
    -> ADD COLUMN sex ENUM('m', 'f') NOT NULL
    -> AFTER second_name
    -> ;
Query OK, 0 rows affected (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> UPDATE client
    -> SET sex = 'f'
    -> WHERE _id IN (4, 6, 7, 11, 12, 16, 17, 25)
    -> ;
Query OK, 8 rows affected (0.00 sec)
Rows matched: 8  Changed: 8  Warnings: 0

mysql> select * from client;
+-----+-------------+------------+---------------+-----+-----------------+------------+----------------------------------------------------------------------------------+--------------------------------------------+
| _id | last_name   | first_name | second_name   | sex | passport_number | birth_date | address                                                                          | comment                                    |
+-----+-------------+------------+---------------+-----+-----------------+------------+----------------------------------------------------------------------------------+--------------------------------------------+
|   1 | Капралов    | Герман     | Петрович      | m   | 6921698435      | 1961-10-21 | ул. Дуки, д. 80, г. Брянск, Брянская обл., 241050                                | NULL                                       |
|   2 | Сидоров     | Сидор      | Сидорович     | m   | 7863523156      | 1975-03-08 | ул. Советская, д. 23, г. Тверь, Тверская обл., 170100                            | NULL                                       |
|   3 | Иванов      | Иван       | Иванович      | m   | 0569836879      | 1985-02-16 | Воскресенский б-р, д. 3, г. Великий Новгород, Новгородская область, 173002       | Не любит шум                               |
|   4 | Суворова    | Галина     | Ивановна      | f   | 9874563215      | 1975-04-03 | пл. Ленина, д. 2, г. Махачкала, Республика Дагестан, 367000                      | NULL                                       |
|   5 | Петров      | Степан     | Викторович    | m   | 0786534882      | 1965-08-21 | ул. Калиновская, д. 38, г. Кострома, Костромская обл., 156013                    | NULL                                       |
|   6 | Решетникова | Анна       | Владимировна  | f   | 6798563549      | 1973-08-09 | ул. Победы, д. 3, корп. С, г. Назрань, Республика Ингушетия, 386102              | Крайне обидчива                            |
|   7 | Ян          | Мария      | Григорьевна   | f   | 9804356987      | 1994-05-24 | ул. Свободы, д. 46, г. Ярославль, Ярославская обл., 150000                       | NULL                                       |
|   8 | Агафонов    | Валерий    | Борисович     | m   | 6349197041      | 1941-03-10 | ул. Марата, д. 9, г. Курск, Курская обл., 305000                                 | певец                                      |
|   9 | Самохвалов  | Юрий       | Петрович      | m   | 7888632153      | 1952-02-22 | ул. Холодильная, д. 58а, г. Тюмень, Тюменская обл., 625048                       | Очень уважаемый человек                    |
|  10 | Чижиков     | Михаил     | Николаевич    | m   | 5468654932      | 2001-07-14 | ул. Московская, д. 55, г. Казань, Республика Татарстан, 420021                   | NULL                                       |
|  11 | Капралова   | Светлана   | Борисовна     | f   | 5428965246      | 1975-04-19 | 4-я линия В.О., д. 13, лит. А, г. Санкт-Петербург, 199004                        | NULL                                       |
|  12 | Лапина      | Марина     | Александровна | f   | 0428456828      | 1988-03-17 | пр-т Ворошиловский, д. 2/2, офис 403, г. Ростов-на-Дону, Ростовская обл., 344006 | NULL                                       |
|  13 | Красавин    | Вадим      | Анатольевич   | m   | 7689254981      | 1985-03-30 | пр-т К. Маркса, д. 12А, г. Омск, Омская обл., 644010                             | Отличный парень                            |
|  14 | Пень        | Юрий       | Васильевич    | m   | 7899245684      | 1949-01-01 | ул. Книповича, д. 9а, г. Мурманск, Мурманская обл., 183038                       | NULL                                       |
|  15 | Соловьев    | Владимир   | Рудовольфович | m   | 5679546321      | 1963-10-20 | наб. Варкауса, д. 1А, г. Петрозаводск, Республика Карелия, 185031                | российский журналист, радио- и телеведущий |
|  16 | Мединская   | Ирина      | Глебовна      | f   | 7788654587      | 2003-12-31 | ул. Карла Либкнехта, д. 55, г. Киров, Кировская обл., 610020                     | NULL                                       |
|  17 | Агапова     | Софья      | Филипповна    | f   | 4529999542      | 1948-02-13 | ул. Жарова, д. 10, г. Иваново, Ивановская обл., 153000                           | Добрая бабуля                              |
|  18 | Соколов     | Михаил     | Иванович      | m   | 5793249563      | 1988-07-16 | ул. Ленина, д. 40, г. Майкоп, Республика Адыгея, 385000                          | NULL                                       |
|  19 | Рогов       | Александр  | Владимирович  | m   | 8743698421      | 1953-05-30 | ул. Улагашева, д. 13, г. Горно-Алтайск, Республика Алтай, 649000                 | NULL                                       |
|  20 | Васильев    | Александр  | Александрович | m   | 5468983123      | 1958-08-12 | пр-т Калинина, д. 8, г. Барнаул, Алтайский край, 656002                          | Историк моды                               |
|  21 | Фролов      | Иван       | Павлович      | m   | 7892697635      | 1979-08-03 | ул. Амурская, д. 150, г. Благовещенск, Амурская обл., 675000                     | NULL                                       |
|  22 | Ампилов     | Виктор     | Иванович      | m   | 6548652325      | 2005-10-02 | ул. Большая Московская, д. 1, г. Владимир, Владимирская обл., 600000             | NULL                                       |
|  23 | Суриков     | Василий    | Петрович      | m   | 5498324568      | 1956-12-20 | ул. 7-я Гвардейская, д. 12, г. Волгоград, Волгоградская обл., 400005             | NULL                                       |
|  24 | Матвиенко   | Александр  | Александрович | m   | 5469842632      | 1996-05-02 | ул. К. Либкнехта, д. 2, г. Архангельск, Архангельская обл., 163000               | футболист                                  |
|  25 | Фролова     | Анна       | Тарасовна     | f   | 7842359821      | 1997-07-19 | ул. Шаумяна, д. 47, г. Астрахань, Астраханская обл., 414000                      | NULL                                       |
|  26 | Симонов     | Александр  | Михайлович    | m   | 4569487532      | 1974-11-15 | ул. Пушкина, д. 95, г. Уфа, Республика Башкортостан, 450008                      | NULL                                       |
|  27 | Северов     | Нестор     | Петрович      | m   | 7865243896      | 1965-04-29 | ул. Ленина, д. 55, г. Улан-Удэ, Республика Бурятия, 670000                       | Новенький                                  |
|  28 | Просов      | Владимир   | Тимофеевич    | m   | 1998653478      | 1991-03-03 | Мясницкий проезд, д. 4, стр. 1, г. Москва, 107078                                | NULL                                       |
+-----+-------------+------------+---------------+-----+-----------------+------------+----------------------------------------------------------------------------------+--------------------------------------------+
28 rows in set (0.00 sec)

```

</details>

### Задача 1
Создать вычисляемое поле Кол_дней, которое определяет количество дней, на которое поселится клиент (Дата освобождения- Дата поселения).

```sql
SELECT *, DATEDIFF(leave_date, enter_date) AS Кол_дней
  FROM checkin
  ;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT *, DATEDIFF(leave_date, enter_date) AS Кол_дней
    -> FROM checkin
    -> ;
+-----+---------------------+------------+------------+---------+-----------+----------+
| _id | date_ts             | enter_date | leave_date | room_id | client_id | Кол_дней |
+-----+---------------------+------------+------------+---------+-----------+----------+
|   1 | 2023-11-16 12:25:36 | 2023-11-16 | 2023-12-10 |       1 |         1 |       24 |
|   2 | 2023-12-28 09:32:48 | 2023-12-28 | 2024-01-17 |       2 |         2 |       20 |
|   3 | 2023-11-14 11:06:12 | 2023-11-14 | 2023-11-28 |       3 |         3 |       14 |
|   4 | 2018-06-11 13:12:06 | 2018-06-11 | 2018-07-05 |       7 |        18 |       24 |
|   5 | 2023-12-01 17:04:30 | 2023-12-01 | 2023-12-29 |       4 |         4 |       28 |
|   6 | 2023-12-12 18:07:15 | 2023-12-12 | 2024-01-05 |       6 |         6 |       24 |
|   7 | 2021-04-01 14:04:06 | 2021-04-01 | 2021-04-29 |       9 |        16 |       28 |
|   8 | 2023-11-26 13:12:02 | 2023-11-26 | 2023-12-04 |      10 |         9 |        8 |
|   9 | 2023-11-16 12:10:23 | 2023-11-16 | 2023-12-10 |       1 |        10 |       24 |
|  10 | 2023-11-17 16:11:52 | 2023-11-17 | 2023-11-25 |       5 |        12 |        8 |
|  11 | 2022-04-12 10:44:56 | 2022-04-12 | 2022-06-18 |       8 |        15 |       67 |
|  12 | 2023-11-19 19:12:38 | 2023-11-19 | 2023-11-23 |       5 |        11 |        4 |
|  13 | 2023-11-16 12:31:20 | 2023-11-16 | 2023-12-31 |       2 |        13 |       45 |
|  14 | 2018-07-15 08:31:18 | 2018-07-15 | 2018-08-30 |      11 |        20 |       46 |
|  15 | 2023-12-12 14:23:12 | 2023-12-12 | 2024-01-01 |      14 |        23 |       20 |
|  16 | 2024-04-05 07:14:54 | 2024-04-05 | 2024-05-01 |       7 |        14 |       26 |
|  17 | 2018-01-02 13:23:48 | 2018-01-02 | 2018-04-28 |      13 |        23 |      116 |
|  18 | 2023-04-30 10:17:32 | 2023-04-30 | 2024-06-21 |      10 |        17 |      418 |
+-----+---------------------+------------+------------+---------+-----------+----------+
18 rows in set (0.01 sec)

```
</details>

### Задача 2
Создать вычисляемое поле, которое определит клиентов старше 44 лет.

```sql
SELECT _id,
  last_name AS Фамилия, first_name AS Имя, second_name AS Отчество,
  CONCAT(SUBSTRING(passport_number, 1, 4), ' ', SUBSTRING(passport_number, 5)) AS "Паспорт (серия номер)",
  birth_date AS "Дата рождения",
  TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) AS Возраст,
  (SELECT IF(Возраст > 44, "Да", "Нет")) AS "Старше 44"
  FROM client
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT _id,
    -> last_name AS Фамилия, first_name AS Имя, second_name AS Отчество,
    -> CONCAT(SUBSTRING(passport_number, 1, 4), ' ', SUBSTRING(passport_number, 5)) AS "Паспорт (серия номер)",
    -> birth_date AS "Дата рождения",
    -> TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) AS Возраст,
    -> (SELECT IF(Возраст > 44, "Да", "Нет")) AS "Старше 44"
    -> FROM client
    -> ;
+-----+-------------+-----------+---------------+-----------------------+---------------+---------+-----------+
| _id | Фамилия     | Имя       | Отчество      | Паспорт (серия номер) | Дата рождения | Возраст | Старше 44 |
+-----+-------------+-----------+---------------+-----------------------+---------------+---------+-----------+
|   1 | Капралов    | Герман    | Петрович      | 6921 698435           | 1961-10-21    |      62 | Да        |
|   2 | Сидоров     | Сидор     | Сидорович     | 7863 523156           | 1975-03-08    |      49 | Да        |
|   3 | Иванов      | Иван      | Иванович      | 0569 836879           | 1985-02-16    |      39 | Нет       |
|   4 | Суворова    | Галина    | Ивановна      | 9874 563215           | 1975-04-03    |      49 | Да        |
|   5 | Петров      | Степан    | Викторович    | 0786 534882           | 1965-08-21    |      58 | Да        |
|   6 | Решетникова | Анна      | Владимировна  | 6798 563549           | 1973-08-09    |      50 | Да        |
|   7 | Ян          | Мария     | Григорьевна   | 9804 356987           | 1994-05-24    |      29 | Нет       |
|   8 | Агафонов    | Валерий   | Борисович     | 6349 197041           | 1941-03-10    |      83 | Да        |
|   9 | Самохвалов  | Юрий      | Петрович      | 7888 632153           | 1952-02-22    |      72 | Да        |
|  10 | Чижиков     | Михаил    | Николаевич    | 5468 654932           | 2001-07-14    |      22 | Нет       |
|  11 | Капралова   | Светлана  | Борисовна     | 5428 965246           | 1975-04-19    |      49 | Да        |
|  12 | Лапина      | Марина    | Александровна | 0428 456828           | 1988-03-17    |      36 | Нет       |
|  13 | Красавин    | Вадим     | Анатольевич   | 7689 254981           | 1985-03-30    |      39 | Нет       |
|  14 | Пень        | Юрий      | Васильевич    | 7899 245684           | 1949-01-01    |      75 | Да        |
|  15 | Соловьев    | Владимир  | Рудовольфович | 5679 546321           | 1963-10-20    |      60 | Да        |
|  16 | Мединская   | Ирина     | Глебовна      | 7788 654587           | 2003-12-31    |      20 | Нет       |
|  17 | Агапова     | Софья     | Филипповна    | 4529 999542           | 1948-02-13    |      76 | Да        |
|  18 | Соколов     | Михаил    | Иванович      | 5793 249563           | 1988-07-16    |      35 | Нет       |
|  19 | Рогов       | Александр | Владимирович  | 8743 698421           | 1953-05-30    |      70 | Да        |
|  20 | Васильев    | Александр | Александрович | 5468 983123           | 1958-08-12    |      65 | Да        |
|  21 | Фролов      | Иван      | Павлович      | 7892 697635           | 1979-08-03    |      44 | Нет       |
|  22 | Ампилов     | Виктор    | Иванович      | 6548 652325           | 2005-10-02    |      18 | Нет       |
|  23 | Суриков     | Василий   | Петрович      | 5498 324568           | 1956-12-20    |      67 | Да        |
|  24 | Матвиенко   | Александр | Александрович | 5469 842632           | 1996-05-02    |      28 | Нет       |
|  25 | Фролова     | Анна      | Тарасовна     | 7842 359821           | 1997-07-19    |      26 | Нет       |
|  26 | Симонов     | Александр | Михайлович    | 4569 487532           | 1974-11-15    |      49 | Да        |
|  27 | Северов     | Нестор    | Петрович      | 7865 243896           | 1965-04-29    |      59 | Да        |
|  28 | Просов      | Владимир  | Тимофеевич    | 1998 653478           | 1991-03-03    |      33 | Нет       |
+-----+-------------+-----------+---------------+-----------------------+---------------+---------+-----------+
28 rows in set (0.00 sec)

```
</details>

### Задача 3
Создать вычисляемое поле, определяющее призывников. Вывести ФИО клиентов-призывников (18 лет). Для более точного соответствия условиям запроса отношение «Клиенты» следует расширить полем «пол», что потребует изменения структуры таблицы КЛИЕНТЫ с последующим дополнением данных.

```sql
ALTER TABLE client
  ADD COLUMN sex ENUM('m', 'f') NOT NULL
  AFTER second_name
  ;

UPDATE client
  SET sex = 'f'
  WHERE _id IN (4, 6, 7, 11, 12, 16, 17, 25)
;

SELECT _id, last_name, first_name, second_name, sex
  FROM client
  ;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> ALTER TABLE client 
    -> ADD COLUMN sex ENUM('m', 'f') NOT NULL
    -> AFTER second_name;
Query OK, 0 rows affected (0.03 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> UPDATE client
    -> SET sex = 'f'
    -> WHERE _id IN (4, 6, 7, 11, 12, 16, 17, 25);
Query OK, 8 rows affected (0.00 sec)
Rows matched: 8  Changed: 8  Warnings: 0

mysql> SELECT _id, last_name, first_name, second_name, sex
    -> FROM client;
+-----+-------------+------------+---------------+-----+
| _id | last_name   | first_name | second_name   | sex |
+-----+-------------+------------+---------------+-----+
|   1 | Капралов    | Герман     | Петрович      | m   |
|   2 | Сидоров     | Сидор      | Сидорович     | m   |
|   3 | Иванов      | Иван       | Иванович      | m   |
|   4 | Суворова    | Галина     | Ивановна      | f   |
|   5 | Петров      | Степан     | Викторович    | m   |
|   6 | Решетникова | Анна       | Владимировна  | f   |
|   7 | Ян          | Мария      | Григорьевна   | f   |
|   8 | Агафонов    | Валерий    | Борисович     | m   |
|   9 | Самохвалов  | Юрий       | Петрович      | m   |
|  10 | Чижиков     | Михаил     | Николаевич    | m   |
|  11 | Капралова   | Светлана   | Борисовна     | f   |
|  12 | Лапина      | Марина     | Александровна | f   |
|  13 | Красавин    | Вадим      | Анатольевич   | m   |
|  14 | Пень        | Юрий       | Васильевич    | m   |
|  15 | Соловьев    | Владимир   | Рудовольфович | m   |
|  16 | Мединская   | Ирина      | Глебовна      | f   |
|  17 | Агапова     | Софья      | Филипповна    | f   |
|  18 | Соколов     | Михаил     | Иванович      | m   |
|  19 | Рогов       | Александр  | Владимирович  | m   |
|  20 | Васильев    | Александр  | Александрович | m   |
|  21 | Фролов      | Иван       | Павлович      | m   |
|  22 | Ампилов     | Виктор     | Иванович      | m   |
|  23 | Суриков     | Василий    | Петрович      | m   |
|  24 | Матвиенко   | Александр  | Александрович | m   |
|  25 | Фролова     | Анна       | Тарасовна     | f   |
|  26 | Симонов     | Александр  | Михайлович    | m   |
|  27 | Северов     | Нестор     | Петрович      | m   |
|  28 | Просов      | Владимир   | Тимофеевич    | m   |
+-----+-------------+------------+---------------+-----+
28 rows in set (0.00 sec)

```
</details>


```sql
SELECT males.name AS "ФИО призывника", males.age AS "Возраст" FROM
  (SELECT
    TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) AS age,
    CONCAT(last_name, ' ', first_name, ' ', second_name) AS name
    FROM client
    WHERE sex = 'm'
  ) males
  WHERE males.age = 18
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT males.name AS "ФИО призывника", males.age AS "Возраст" FROM
    -> (SELECT
    -> TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) AS age,
    -> CONCAT(last_name, ' ', first_name, ' ', second_name) AS name
    -> FROM client
    -> WHERE sex = 'm'
    -> ) males
    -> WHERE males.age = 18
    -> ;
+-------------------------+---------+
| ФИО призывника          | Возраст |
+-------------------------+---------+
| Ампилов Виктор Иванович |      18 |
+-------------------------+---------+
1 row in set (0.00 sec)

```
</details>

### Задача 4
Создать вычисляемое поле. Вывести ФИО и возраст клиентов пенсионного возраста. (Для женщин 55 лет, для мужчин – 60 лет).

```sql
SELECT name AS "ФИО пенсионера", age AS Возраст
  FROM
  (SELECT
    CONCAT(last_name, ' ', first_name, ' ', second_name) AS name,
    sex,
    TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) AS age
    FROM client
  ) people
  WHERE sex = 'f' && age >= 55 OR sex = 'm' && age >= 60
;

```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT name AS "ФИО пенсионера", age AS Возраст
    -> FROM
    -> (SELECT
    -> CONCAT(last_name, ' ', first_name, ' ', second_name) AS name,
    -> sex,
    -> TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) AS age
    -> FROM client
    -> ) people
    -> WHERE sex = 'f' && age >= 55 OR sex = 'm' && age >= 60
    -> ;
+----------------------------------+---------+
| ФИО пенсионера                   | Возраст |
+----------------------------------+---------+
| Капралов Герман Петрович         |      62 |
| Агафонов Валерий Борисович       |      83 |
| Самохвалов Юрий Петрович         |      72 |
| Пень Юрий Васильевич             |      75 |
| Соловьев Владимир Рудовольфович  |      60 |
| Агапова Софья Филипповна         |      76 |
| Рогов Александр Владимирович     |      70 |
| Васильев Александр Александрович |      65 |
| Суриков Василий Петрович         |      67 |
+----------------------------------+---------+
9 rows in set, 2 warnings (0.00 sec)

```
</details>

### Задача 5
Создать вычисляемое поле, которое будет выводить фамилию клиентов с инициалами.

```sql
SELECT
  CONCAT(last_name, ' ', SUBSTRING(first_name, 1, 1), '.', SUBSTRING(second_name, 1, 1), '.') AS "Фамилия И.О.",
  CONCAT(SUBSTRING(passport_number, 1, 4), ' ', SUBSTRING(passport_number, 5)) AS "Паспорт (серия номер)",
  birth_date AS "Дата рождения",
  IF (LENGTH(address) > 20, CONCAT(SUBSTRING(address, 1, 30), '...'), address) AS "Адрес",
  IF (comment IS NOT NULL, comment, '') AS "Комментарий"
  FROM client
;

```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT
    -> CONCAT(last_name, ' ', SUBSTRING(first_name, 1, 1), '.', SUBSTRING(second_name, 1, 1), '.') AS "Фамилия И.О.",
    -> CONCAT(SUBSTRING(passport_number, 1, 4), ' ', SUBSTRING(passport_number, 5)) AS "Паспорт (серия номер)",
    -> birth_date AS "Дата рождения",
    -> IF (LENGTH(address) > 20, CONCAT(SUBSTRING(address, 1, 30), '...'), address) AS "Адрес",
    -> IF (comment IS NOT NULL, comment, '') AS "Комментарий"
    -> FROM client
    -> ;
+------------------+-----------------------+---------------+-----------------------------------+--------------------------------------------+
| Фамилия И.О.     | Паспорт (серия номер) | Дата рождения | Адрес                             | Комментарий                                |
+------------------+-----------------------+---------------+-----------------------------------+--------------------------------------------+
| Капралов Г.П.    | 6921 698435           | 1961-10-21    | ул. Дуки, д. 80, г. Брянск, Бр... |                                            |
| Сидоров С.С.     | 7863 523156           | 1975-03-08    | ул. Советская, д. 23, г. Тверь... |                                            |
| Иванов И.И.      | 0569 836879           | 1985-02-16    | Воскресенский б-р, д. 3, г. Ве... | Не любит шум                               |
| Суворова Г.И.    | 9874 563215           | 1975-04-03    | пл. Ленина, д. 2, г. Махачкала... |                                            |
| Петров С.В.      | 0786 534882           | 1965-08-21    | ул. Калиновская, д. 38, г. Кос... |                                            |
| Решетникова А.В. | 6798 563549           | 1973-08-09    | ул. Победы, д. 3, корп. С, г. ... | Крайне обидчива                            |
| Ян М.Г.          | 9804 356987           | 1994-05-24    | ул. Свободы, д. 46, г. Ярослав... |                                            |
| Агафонов В.Б.    | 6349 197041           | 1941-03-10    | ул. Марата, д. 9, г. Курск, Ку... | певец                                      |
| Самохвалов Ю.П.  | 7888 632153           | 1952-02-22    | ул. Холодильная, д. 58а, г. Тю... | Очень уважаемый человек                    |
| Чижиков М.Н.     | 5468 654932           | 2001-07-14    | ул. Московская, д. 55, г. Каза... |                                            |
| Капралова С.Б.   | 5428 965246           | 1975-04-19    | 4-я линия В.О., д. 13, лит. А,... |                                            |
| Лапина М.А.      | 0428 456828           | 1988-03-17    | пр-т Ворошиловский, д. 2/2, оф... |                                            |
| Красавин В.А.    | 7689 254981           | 1985-03-30    | пр-т К. Маркса, д. 12А, г. Омс... | Отличный парень                            |
| Пень Ю.В.        | 7899 245684           | 1949-01-01    | ул. Книповича, д. 9а, г. Мурма... |                                            |
| Соловьев В.Р.    | 5679 546321           | 1963-10-20    | наб. Варкауса, д. 1А, г. Петро... | российский журналист, радио- и телеведущий |
| Мединская И.Г.   | 7788 654587           | 2003-12-31    | ул. Карла Либкнехта, д. 55, г.... |                                            |
| Агапова С.Ф.     | 4529 999542           | 1948-02-13    | ул. Жарова, д. 10, г. Иваново,... | Добрая бабуля                              |
| Соколов М.И.     | 5793 249563           | 1988-07-16    | ул. Ленина, д. 40, г. Майкоп, ... |                                            |
| Рогов А.В.       | 8743 698421           | 1953-05-30    | ул. Улагашева, д. 13, г. Горно... |                                            |
| Васильев А.А.    | 5468 983123           | 1958-08-12    | пр-т Калинина, д. 8, г. Барнау... | Историк моды                               |
| Фролов И.П.      | 7892 697635           | 1979-08-03    | ул. Амурская, д. 150, г. Благо... |                                            |
| Ампилов В.И.     | 6548 652325           | 2005-10-02    | ул. Большая Московская, д. 1, ... |                                            |
| Суриков В.П.     | 5498 324568           | 1956-12-20    | ул. 7-я Гвардейская, д. 12, г.... |                                            |
| Матвиенко А.А.   | 5469 842632           | 1996-05-02    | ул. К. Либкнехта, д. 2, г. Арх... | футболист                                  |
| Фролова А.Т.     | 7842 359821           | 1997-07-19    | ул. Шаумяна, д. 47, г. Астраха... |                                            |
| Симонов А.М.     | 4569 487532           | 1974-11-15    | ул. Пушкина, д. 95, г. Уфа, Ре... |                                            |
| Северов Н.П.     | 7865 243896           | 1965-04-29    | ул. Ленина, д. 55, г. Улан-Удэ... | Новенький                                  |
| Просов В.Т.      | 1998 653478           | 1991-03-03    | Мясницкий проезд, д. 4, стр. 1... |                                            |
+------------------+-----------------------+---------------+-----------------------------------+--------------------------------------------+
28 rows in set (0.00 sec)

```
</details>

### Задача 6
Создать вычисляемое поле с полным именем клиентов (Фамилия Имя Отчество), дату его рождения и текст «Поздравляем с днем рождения!», если у него сегодня день рождения.

```sql
SELECT
  CONCAT(last_name, ' ', first_name, ' ', second_name) AS "Фамилия Имя Отчество",
  birth_date AS "Дата рождения",
  IF(MONTH(birth_date) = MONTH(CURDATE()) && DAY(birth_date) = DAY(CURDATE()),
    '***Поздравляем с днем рождения!***', '') AS "Примечание"
  FROM client
;

SELECT
  CONCAT(
    last_name, ' ', first_name, ' ', second_name, ', ', birth_date,
    IF(MONTH(birth_date) = MONTH(CURDATE()) && DAY(birth_date) = DAY(CURDATE()),
        ' ***Поздравляем с днем рождения!***', '')
    ) AS "Фамилия Имя Отчество, дата рождения"
  FROM client;

```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT
    -> CONCAT(last_name, ' ', first_name, ' ', second_name) AS "Фамилия Имя Отчество",
    -> birth_date AS "Дата рождения",
    -> IF(MONTH(birth_date) = MONTH(CURDATE()) && DAY(birth_date) = DAY(CURDATE()),
    -> '***Поздравляем с днем рождения!***', '') AS "Примечание"
    -> FROM client
    -> ;
+-----------------------------------+---------------+------------------------------------+
| Фамилия Имя Отчество              | Дата рождения | Примечание                         |
+-----------------------------------+---------------+------------------------------------+
| Капралов Герман Петрович          | 1961-10-21    |                                    |
| Сидоров Сидор Сидорович           | 1975-03-08    |                                    |
| Иванов Иван Иванович              | 1985-02-16    |                                    |
| Суворова Галина Ивановна          | 1975-04-03    |                                    |
| Петров Степан Викторович          | 1965-08-21    |                                    |
| Решетникова Анна Владимировна     | 1973-08-09    |                                    |
| Ян Мария Григорьевна              | 1994-05-24    |                                    |
| Агафонов Валерий Борисович        | 1941-03-10    |                                    |
| Самохвалов Юрий Петрович          | 1952-02-22    |                                    |
| Чижиков Михаил Николаевич         | 2001-07-14    |                                    |
| Капралова Светлана Борисовна      | 1975-04-19    |                                    |
| Лапина Марина Александровна       | 1988-03-17    |                                    |
| Красавин Вадим Анатольевич        | 1985-03-30    |                                    |
| Пень Юрий Васильевич              | 1949-01-01    |                                    |
| Соловьев Владимир Рудовольфович   | 1963-10-20    |                                    |
| Мединская Ирина Глебовна          | 2003-12-31    |                                    |
| Агапова Софья Филипповна          | 1948-02-13    |                                    |
| Соколов Михаил Иванович           | 1988-07-16    |                                    |
| Рогов Александр Владимирович      | 1953-05-30    |                                    |
| Васильев Александр Александрович  | 1958-08-12    |                                    |
| Фролов Иван Павлович              | 1979-08-03    |                                    |
| Ампилов Виктор Иванович           | 2005-10-02    |                                    |
| Суриков Василий Петрович          | 1956-12-20    |                                    |
| Матвиенко Александр Александрович | 1996-05-02    | ***Поздравляем с днем рождения!*** |
| Фролова Анна Тарасовна            | 1997-07-19    |                                    |
| Симонов Александр Михайлович      | 1974-11-15    |                                    |
| Северов Нестор Петрович           | 1965-04-29    |                                    |
| Просов Владимир Тимофеевич        | 1991-03-03    |                                    |
+-----------------------------------+---------------+------------------------------------+
28 rows in set, 1 warning (0.00 sec)

mysql> SELECT
    -> CONCAT(
    -> last_name, ' ', first_name, ' ', second_name, ', ', birth_date,
    -> IF(MONTH(birth_date) = MONTH(CURDATE()) && DAY(birth_date) = DAY(CURDATE()),
    -> ' ***Поздравляем с днем рождения!***', '')
    -> ) AS "Фамилия Имя Отчество, дата рождения"
    -> FROM client;
+----------------------------------------------------------------------------------+
| Фамилия Имя Отчество, дата рождения                                              |
+----------------------------------------------------------------------------------+
| Капралов Герман Петрович, 1961-10-21                                             |
| Сидоров Сидор Сидорович, 1975-03-08                                              |
| Иванов Иван Иванович, 1985-02-16                                                 |
| Суворова Галина Ивановна, 1975-04-03                                             |
| Петров Степан Викторович, 1965-08-21                                             |
| Решетникова Анна Владимировна, 1973-08-09                                        |
| Ян Мария Григорьевна, 1994-05-24                                                 |
| Агафонов Валерий Борисович, 1941-03-10                                           |
| Самохвалов Юрий Петрович, 1952-02-22                                             |
| Чижиков Михаил Николаевич, 2001-07-14                                            |
| Капралова Светлана Борисовна, 1975-04-19                                         |
| Лапина Марина Александровна, 1988-03-17                                          |
| Красавин Вадим Анатольевич, 1985-03-30                                           |
| Пень Юрий Васильевич, 1949-01-01                                                 |
| Соловьев Владимир Рудовольфович, 1963-10-20                                      |
| Мединская Ирина Глебовна, 2003-12-31                                             |
| Агапова Софья Филипповна, 1948-02-13                                             |
| Соколов Михаил Иванович, 1988-07-16                                              |
| Рогов Александр Владимирович, 1953-05-30                                         |
| Васильев Александр Александрович, 1958-08-12                                     |
| Фролов Иван Павлович, 1979-08-03                                                 |
| Ампилов Виктор Иванович, 2005-10-02                                              |
| Суриков Василий Петрович, 1956-12-20                                             |
| Матвиенко Александр Александрович, 1996-05-02 ***Поздравляем с днем рождения!*** |
| Фролова Анна Тарасовна, 1997-07-19                                               |
| Симонов Александр Михайлович, 1974-11-15                                         |
| Северов Нестор Петрович, 1965-04-29                                              |
| Просов Владимир Тимофеевич, 1991-03-03                                           |
+----------------------------------------------------------------------------------+
28 rows in set, 1 warning (0.00 sec)

```
</details>

## Работа 13.O. «Создание запросов на объединение нескольких таблиц»

### Задача 1
Вывести ФИО клиентов, номер, в который он поселился и дату поселения. Сортировать по дате.

```sql
SELECT
  client.last_name AS "Фамилия", client.first_name AS "Имя", client.second_name AS "Отчество",
  room.number AS "Номер",
  checkin.enter_date AS "Дата поселения*"
  FROM client INNER JOIN
    (room INNER JOIN checkin ON room._id = checkin.room_id)
    ON client._id = checkin.client_id
  ORDER BY checkin.enter_date DESC
;

SELECT
  client.last_name AS "Фамилия", client.first_name AS "Имя", client.second_name AS "Отчество",
  room.number AS "Номер",
  checkin.enter_date AS "Дата поселения*"
  FROM room JOIN
    (client JOIN checkin ON client._id = checkin.client_id)
    ON room._id = checkin.room_id
  ORDER BY checkin.enter_date DESC
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT
    -> client.last_name AS "Фамилия", client.first_name AS "Имя", client.second_name AS "Отчество",
    -> room.number AS "Номер",
    -> checkin.enter_date AS "Дата поселения*"
    -> FROM client INNER JOIN
    -> (room INNER JOIN checkin ON room._id = checkin.room_id)
    -> ON client._id = checkin.client_id
    -> ORDER BY checkin.enter_date DESC
    -> ;
+-------------+-----------+---------------+-------+-----------------+
| Фамилия     | Имя       | Отчество      | Номер | Дата поселения* |
+-------------+-----------+---------------+-------+-----------------+
| Пень        | Юрий      | Васильевич    | 123   | 2024-04-05      |
| Сидоров     | Сидор     | Сидорович     | 303   | 2023-12-28      |
| Решетникова | Анна      | Владимировна  | 202   | 2023-12-12      |
| Суриков     | Василий   | Петрович      | 754   | 2023-12-12      |
| Суворова    | Галина    | Ивановна      | 225   | 2023-12-01      |
| Самохвалов  | Юрий      | Петрович      | 5     | 2023-11-26      |
| Капралова   | Светлана  | Борисовна     | 4     | 2023-11-19      |
| Лапина      | Марина    | Александровна | 4     | 2023-11-17      |
| Капралов    | Герман    | Петрович      | 213   | 2023-11-16      |
| Чижиков     | Михаил    | Николаевич    | 213   | 2023-11-16      |
| Красавин    | Вадим     | Анатольевич   | 303   | 2023-11-16      |
| Иванов      | Иван      | Иванович      | 506   | 2023-11-14      |
| Агапова     | Софья     | Филипповна    | 5     | 2023-04-30      |
| Соловьев    | Владимир  | Рудовольфович | 101   | 2022-04-12      |
| Мединская   | Ирина     | Глебовна      | 11    | 2021-04-01      |
| Васильев    | Александр | Александрович | 707   | 2018-07-15      |
| Соколов     | Михаил    | Иванович      | 123   | 2018-06-11      |
| Ампилов     | Виктор    | Иванович      | 12    | 2018-04-01      |
| Суриков     | Василий   | Петрович      | 128   | 2018-01-02      |
+-------------+-----------+---------------+-------+-----------------+
19 rows in set (0.00 sec)

```
</details>

### Задача 2
Вывести номер, название комфортности, цену номера.

```sql
SELECT
  room.number AS "Номер",
  comfort.type_name AS "Комфортность",
  room.price AS "Цена"
  FROM comfort LEFT JOIN room
    ON comfort._id = room.comfort_id
;

SELECT
  room.number AS "Номер",
  comfort.type_name AS "Комфортность",
  room.price AS "Цена"
  FROM room INNER JOIN comfort
    ON comfort._id = room.comfort_id
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT
    -> room.number AS "Номер",
    -> comfort.type_name AS "Комфортность",
    -> room.price AS "Цена"
    -> FROM comfort LEFT JOIN room
    -> ON comfort._id = room.comfort_id
    -> ;
+-------+--------------+----------+
| Номер | Комфортность | Цена     |
+-------+--------------+----------+
| 506   | люкс         |  7800.00 |
| 707   | люкс         | 10580.00 |
| 555   | люкс         |  9230.00 |
| 6     | люкс         |  6000.00 |
| 45    | люкс         |  4500.00 |
| 213   | обычный      |  2950.00 |
| 225   | обычный      |  2100.00 |
| 4     | обычный      |  4000.00 |
| 202   | обычный      |  2500.00 |
| 123   | обычный      |  3400.00 |
| 101   | обычный      |  2950.00 |
| 128   | обычный      |   999.00 |
| 65    | обычный      |  2999.00 |
| 12    | обычный      |  1250.00 |
| 7     | обычный      |  1700.00 |
| 303   | полулюкс     |  4320.00 |
| 11    | полулюкс     |  7320.00 |
| 5     | полулюкс     |  5000.00 |
| 754   | полулюкс     |  3225.00 |
| 78    | полулюкс     |  3134.00 |
| 23    | полулюкс     |  2500.00 |
+-------+--------------+----------+
21 rows in set (0.00 sec)

```
</details>

### Задача 3
Вывести данные по номерам 45, 23 и 12.

```sql
SELECT
  room.number AS "Номер",
  room.capacity AS "Вместимость",
  room.price AS "Цена",
  room.phone_number AS "Телефон",
  comfort.type_name AS "Комфортность"
  FROM comfort RIGHT JOIN room
    ON comfort._id = room.comfort_id
  WHERE room.number IN ('45', '23', '12')
;

```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT
    -> room.number AS "Номер",
    -> room.capacity AS "Вместимость",
    -> room.price AS "Цена",
    -> room.phone_number AS "Телефон",
    -> comfort.type_name AS "Комфортность"
    -> FROM comfort RIGHT JOIN room
    -> ON comfort._id = room.comfort_id
    -> WHERE room.number IN ('45', '23', '12')
    -> ;
+-------+-------------+---------+---------+--------------+
| Номер | Вместимость | Цена    | Телефон | Комфортность |
+-------+-------------+---------+---------+--------------+
| 12    |           1 | 1250.00 | 12      | обычный      |
| 23    |           2 | 2500.00 | 23      | полулюкс     |
| 45    |           4 | 4500.00 | 45      | люкс         |
+-------+-------------+---------+---------+--------------+
3 rows in set (0.00 sec)

```
</details>

### Задача 4
Вывести номер, количество человек в номере, комфортность «1 категории» и «2 категории», в которых цена от 3000 руб. до 5000 руб.

```sql
SELECT
  room.number AS "Номер",
  room.capacity AS "Количество человек",
  room.price AS "Цена",
  comfort.type_name AS "Комфортность",
  CASE
    WHEN comfort._id = 1 THEN '1 категория'
    WHEN comfort._id = 2 THEN '2 категория'
    END AS "Категория"
  FROM room LEFT JOIN comfort
    ON comfort._id = room.comfort_id
  WHERE room.price BETWEEN 3000 AND 5000 && comfort._id IN (1, 2)
;

```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT
    -> room.number AS "Номер",
    -> room.capacity AS "Количество человек",
    -> room.price AS "Цена",
    -> comfort.type_name AS "Комфортность",
    -> CASE
    -> WHEN comfort._id = 1 THEN '1 категория'
    -> WHEN comfort._id = 2 THEN '2 категория'
    -> END AS "Категория"
    -> FROM room LEFT JOIN comfort
    -> ON comfort._id = room.comfort_id
    -> WHERE room.price BETWEEN 3000 AND 5000 && comfort._id IN (1, 2)
    -> ;
+-------+--------------------+---------+--------------+-------------+
| Номер | Количество человек | Цена    | Комфортность | Категория   |
+-------+--------------------+---------+--------------+-------------+
| 303   |                  2 | 4320.00 | полулюкс     | 2 категория |
| 4     |                  4 | 4000.00 | обычный      | 1 категория |
| 123   |                  3 | 3400.00 | обычный      | 1 категория |
| 5     |                  5 | 5000.00 | полулюкс     | 2 категория |
| 754   |                  2 | 3225.00 | полулюкс     | 2 категория |
| 78    |                  3 | 3134.00 | полулюкс     | 2 категория |
+-------+--------------------+---------+--------------+-------------+
6 rows in set, 1 warning (0.00 sec)


```
</details>

### Задача 5
Вывести ФИО клиентов, номер и дату освобождения номера с апреля 2018 по ноябрь 2018 г.

```sql
SELECT
  client.last_name AS "Фамилия",
  client.first_name AS "Имя",
  client.second_name AS "Отчество",
  room.number AS "Номер",
  checkin.leave_date AS "Дата освобождения"
  FROM room INNER JOIN
    (client RIGHT JOIN checkin ON client._id = checkin.client_id)
    ON room._id = checkin.room_id
  WHERE checkin.leave_date BETWEEN '2018-04-01' AND '2018-11-30'
  ORDER BY checkin.leave_date DESC
;

```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT
    -> client.last_name AS "Фамилия",
    -> client.first_name AS "Имя",
    -> client.second_name AS "Отчество",
    -> room.number AS "Номер",
    -> checkin.leave_date AS "Дата освобождения"
    -> FROM room INNER JOIN
    -> (client RIGHT JOIN checkin ON client._id = checkin.client_id)
    -> ON room._id = checkin.room_id
    -> WHERE checkin.leave_date BETWEEN '2018-04-01' AND '2018-11-30'
    -> ORDER BY checkin.leave_date DESC
    -> ;
+----------+-----------+---------------+-------+-------------------+
| Фамилия  | Имя       | Отчество      | Номер | Дата освобождения |
+----------+-----------+---------------+-------+-------------------+
| Васильев | Александр | Александрович | 707   | 2018-08-30        |
| Соколов  | Михаил    | Иванович      | 123   | 2018-07-05        |
| Суриков  | Василий   | Петрович      | 128   | 2018-04-28        |
| Ампилов  | Виктор    | Иванович      | 12    | 2018-04-22        |
+----------+-----------+---------------+-------+-------------------+
4 rows in set (0.00 sec)

```
</details>

### Задача 6
Вывести количество номеров по каждому виду комфортности.

```sql
SELECT
  CONCAT(
    UCASE(SUBSTRING(comfort.type_name, 1, 1)),
    SUBSTRING(comfort.type_name, 2)
  ) AS "Вид комфортности",
  COUNT(*) AS "Количество номеров"
  FROM room INNER JOIN comfort
    ON comfort._id = room.comfort_id
  GROUP BY room.comfort_id
  ORDER BY room.comfort_id
;

```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT
    -> CONCAT(
    -> UCASE(SUBSTRING(comfort.type_name, 1, 1)),
    -> SUBSTRING(comfort.type_name, 2)
    -> ) AS "Вид комфортности",
    -> COUNT(*) AS "Количество номеров"
    -> FROM room INNER JOIN comfort
    -> ON comfort._id = room.comfort_id
    -> GROUP BY room.comfort_id
    -> ORDER BY room.comfort_id
    -> ;
+------------------+--------------------+
| Вид комфортности | Количество номеров |
+------------------+--------------------+
| Обычный          |                 10 |
| Полулюкс         |                  6 |
| Люкс             |                  5 |
+------------------+--------------------+
3 rows in set (0.02 sec)

```
</details>

### Задача 7
Вывести общее количество человек, которые были заселены в каждый номер в июне 2018 г.

```sql
SELECT
  room.number AS "Номер",
  COUNT(*) AS "Количество человек"
  FROM room INNER JOIN checkin
    ON room._id = checkin.room_id
  WHERE MONTH(checkin.enter_date)=6 AND YEAR(checkin.enter_date)=2018
  GROUP BY room._id  
;

SELECT
  room.number AS "Номер",
  COUNT(*) AS "Количество человек"
  FROM room INNER JOIN checkin
    ON room._id = checkin.room_id
  WHERE checkin.enter_date BETWEEN "2018-06-01" AND "2018-06-30"
  GROUP BY room._id
;

```


<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT
    -> room.number AS "Номер",
    -> COUNT(*) AS "Количество человек"
    -> FROM room INNER JOIN checkin
    -> ON room._id = checkin.room_id
    -> WHERE checkin.enter_date BETWEEN "2018-06-01" AND "2018-06-30"
    -> GROUP BY room._id
    -> ;
+-------+--------------------+
| Номер | Количество человек |
+-------+--------------------+
| 123   |                  1 |
+-------+--------------------+
1 row in set (0.00 sec)

```
</details>

### Задача 8
Вывести среднее значение суммы оплаты номера для каждого клиента, если она не превышает 5000 руб. и дата поселения с 14.02.2018 по 23.09.2018. Сортировать по фамилии.

```sql
SELECT
  ROUND(AVG(room.price), 2) AS "Средняя оплата",
  client.last_name AS "Фамилия*",
  client.first_name AS "Имя",
  client.second_name AS "Отчество"
  FROM client INNER JOIN
    (checkin LEFT JOIN room ON checkin.room_id = room._id)
    ON client._id = checkin.client_id
  WHERE checkin.enter_date BETWEEN "2018-02-14" AND "2018-09-23"
  GROUP BY client.last_name, client.first_name, client.second_name
  HAVING AVG(room.price) <= 5000
  ORDER BY client.last_name
;

```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT
    -> ROUND(AVG(room.price), 2) AS "Средняя оплата",
    -> client.last_name AS "Фамилия",
    -> client.first_name AS "Имя",
    -> client.second_name AS "Отчество"
    -> FROM client INNER JOIN
    -> (checkin LEFT JOIN room ON checkin.room_id = room._id)
    -> ON client._id = checkin.client_id
    -> WHERE checkin.enter_date BETWEEN "2018-02-14" AND "2018-09-23"
    -> GROUP BY client.last_name, client.first_name, client.second_name
    -> HAVING AVG(room.price) <= 5000
    -> ORDER BY client.last_name
    -> ;
+----------------+----------+--------+----------+
| Средняя оплата | Фамилия* | Имя    | Отчество |
+----------------+----------+--------+----------+
|        1250.00 | Ампилов  | Виктор | Иванович |
|        3400.00 | Соколов  | Михаил | Иванович |
+----------------+----------+--------+----------+
2 rows in set (0.00 sec)

```
</details>

## Работа 14.O. «Создание запросов на объединение нескольких запросов»

```sql
CREATE DATABASE store;

USE store

CREATE TABLE Vinil (
  _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
  price INT UNSIGNED NOT NULL
);

CREATE TABLE Paper (
  _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
  price INT UNSIGNED NOT NULL
);

INSERT INTO Vinil(price) VALUES (400), (500), (530), (610), (720), (800), (850);

INSERT INTO Paper(price) VALUES (300), (320), (360), (400), (430), (500), (530);

```

<details>
<summary><b>Запрос</b></summary>

```
mysql> CREATE DATABASE store;
Query OK, 1 row affected (0.00 sec)

mysql> USE store
Database changed
mysql> CREATE TABLE Vinil (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> price INT UNSIGNED NOT NULL
    -> );
Query OK, 0 rows affected (0.01 sec)

mysql> CREATE TABLE Paper (
    -> _id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -> price INT UNSIGNED NOT NULL
    -> );
Query OK, 0 rows affected (0.01 sec)

mysql> INSERT INTO Vinil(price) VALUES (400), (500), (530), (610), (720), (800), (850);
Query OK, 7 rows affected (0.00 sec)
Records: 7  Duplicates: 0  Warnings: 0

```
</details>

### Задача 1
Получить сведения о ценах обоев из таблицы Vinil, содержащей данные о виниловых обоях.

```sql
SELECT price FROM Vinil;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT price FROM Vinil;
+-------+
| price |
+-------+
|   400 |
|   500 |
|   530 |
|   610 |
|   720 |
|   800 |
|   850 |
+-------+
7 rows in set (0.01 sec)

```
</details>

### Задача 2
Получить сведения о ценах обоев из таблицы Paper, содержащей данные о бумажных обоях.

```sql
SELECT price FROM Paper;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT price FROM Paper;
+-------+
| price |
+-------+
|   300 |
|   320 |
|   360 |
|   400 |
|   430 |
|   500 |
|   530 |
+-------+
7 rows in set (0.00 sec)

```
</details>

### Задача 3
Написать запрос, позволяющий узнать сведения о ценах обоев из обеих вышеуказанных таблиц.

```sql
(SELECT price FROM Vinil)
UNION
(SELECT price FROM Paper)
ORDER BY price
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> (SELECT price FROM Vinil)
    -> UNION
    -> (SELECT price FROM Paper)
    -> ORDER BY price
    -> ;
+-------+
| price |
+-------+
|   300 |
|   320 |
|   360 |
|   400 |
|   430 |
|   500 |
|   530 |
|   610 |
|   720 |
|   800 |
|   850 |
+-------+
11 rows in set (0.08 sec)

```
</details>

## Работа 15.O. «Создание вложенных запросов»

### Задача 1
Вывести данные о номерах с максимальной ценой.

```sql
SELECT *
FROM room
WHERE price=(SELECT MAX(price) FROM room)
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT *
    -> FROM room
    -> WHERE price=(SELECT MAX(price) FROM room)
    -> ;
+-----+--------+----------+----------+--------------+------------+
| _id | number | capacity | price    | phone_number | comfort_id |
+-----+--------+----------+----------+--------------+------------+
|  11 | 707    |        5 | 10580.00 | 2            |          3 |
+-----+--------+----------+----------+--------------+------------+
1 row in set (0.00 sec)

```
</details>

### Задача 2
Вывести данные о номерах, имеющих не самую низкую цену.

```sql
SELECT *
FROM room
WHERE price > ANY(SELECT price FROM room)
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT *
    -> FROM room
    -> WHERE price > ANY(SELECT price FROM room)
    -> ;
+-----+--------+----------+----------+--------------+------------+
| _id | number | capacity | price    | phone_number | comfort_id |
+-----+--------+----------+----------+--------------+------------+
|   1 | 213    |        2 |  2950.00 | 512          |          1 |
|   2 | 303    |        2 |  4320.00 | 128          |          2 |
|   3 | 506    |        3 |  7800.00 | 32           |          3 |
|   4 | 225    |        1 |  2100.00 | 8            |          1 |
|   5 | 4      |        4 |  4000.00 | 202          |          1 |
|   6 | 202    |        1 |  2500.00 | 4            |          1 |
|   7 | 123    |        3 |  3400.00 | 1024         |          1 |
|   8 | 101    |        1 |  2950.00 | 256          |          1 |
|   9 | 11     |        4 |  7320.00 | 3            |          2 |
|  10 | 5      |        5 |  5000.00 | 5            |          2 |
|  11 | 707    |        5 | 10580.00 | 2            |          3 |
|  12 | 555    |        4 |  9230.00 | 64           |          3 |
|  14 | 754    |        2 |  3225.00 | 2048         |          2 |
|  15 | 6      |        6 |  6000.00 | 6            |          3 |
|  16 | 45     |        4 |  4500.00 | 45           |          3 |
|  17 | 65     |        3 |  2999.00 | 4096         |          1 |
|  18 | 12     |        1 |  1250.00 | 12           |          1 |
|  19 | 78     |        3 |  3134.00 | 8192         |          2 |
|  20 | 23     |        2 |  2500.00 | 23           |          2 |
|  21 | 7      |        1 |  1700.00 | 7            |          1 |
+-----+--------+----------+----------+--------------+------------+
20 rows in set (0.00 sec)

```
</details>

### Задача 3
Вывести данные о номерах, у которых любая цена за номер меньше средней цены по всем номерам.

```sql
SELECT *
FROM room
WHERE price < ALL(SELECT AVG(price) FROM room)
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT *
    -> FROM room
    -> WHERE price < ALL(SELECT AVG(price) FROM room)
    -> ;
+-----+--------+----------+---------+--------------+------------+
| _id | number | capacity | price   | phone_number | comfort_id |
+-----+--------+----------+---------+--------------+------------+
|   1 | 213    |        2 | 2950.00 | 512          |          1 |
|   4 | 225    |        1 | 2100.00 | 8            |          1 |
|   5 | 4      |        4 | 4000.00 | 202          |          1 |
|   6 | 202    |        1 | 2500.00 | 4            |          1 |
|   7 | 123    |        3 | 3400.00 | 1024         |          1 |
|   8 | 101    |        1 | 2950.00 | 256          |          1 |
|  13 | 128    |        2 |  999.00 | 1            |          1 |
|  14 | 754    |        2 | 3225.00 | 2048         |          2 |
|  17 | 65     |        3 | 2999.00 | 4096         |          1 |
|  18 | 12     |        1 | 1250.00 | 12           |          1 |
|  19 | 78     |        3 | 3134.00 | 8192         |          2 |
|  20 | 23     |        2 | 2500.00 | 23           |          2 |
|  21 | 7      |        1 | 1700.00 | 7            |          1 |
+-----+--------+----------+---------+--------------+------------+
13 rows in set (0.00 sec)

```
</details>

### Задача 4
Вывести данные о номерах, у которых не самая низкая цена.

```sql
SELECT *
FROM room AS r
WHERE EXISTS(SELECT price FROM room WHERE price < r.Price)
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT *
    -> FROM room AS r
    -> WHERE EXISTS(SELECT price FROM room WHERE price < r.Price)
    -> ;
+-----+--------+----------+----------+--------------+------------+
| _id | number | capacity | price    | phone_number | comfort_id |
+-----+--------+----------+----------+--------------+------------+
|   1 | 213    |        2 |  2950.00 | 512          |          1 |
|   2 | 303    |        2 |  4320.00 | 128          |          2 |
|   3 | 506    |        3 |  7800.00 | 32           |          3 |
|   4 | 225    |        1 |  2100.00 | 8            |          1 |
|   5 | 4      |        4 |  4000.00 | 202          |          1 |
|   6 | 202    |        1 |  2500.00 | 4            |          1 |
|   7 | 123    |        3 |  3400.00 | 1024         |          1 |
|   8 | 101    |        1 |  2950.00 | 256          |          1 |
|   9 | 11     |        4 |  7320.00 | 3            |          2 |
|  10 | 5      |        5 |  5000.00 | 5            |          2 |
|  11 | 707    |        5 | 10580.00 | 2            |          3 |
|  12 | 555    |        4 |  9230.00 | 64           |          3 |
|  14 | 754    |        2 |  3225.00 | 2048         |          2 |
|  15 | 6      |        6 |  6000.00 | 6            |          3 |
|  16 | 45     |        4 |  4500.00 | 45           |          3 |
|  17 | 65     |        3 |  2999.00 | 4096         |          1 |
|  18 | 12     |        1 |  1250.00 | 12           |          1 |
|  19 | 78     |        3 |  3134.00 | 8192         |          2 |
|  20 | 23     |        2 |  2500.00 | 23           |          2 |
|  21 | 7      |        1 |  1700.00 | 7            |          1 |
+-----+--------+----------+----------+--------------+------------+
20 rows in set (0.00 sec)

```
</details>

### Задача 5
Если имеется цена за номер, равная 2000 руб., то показать сведения о номере и отсортировать по количеству человек.

```sql
SELECT *
FROM room
WHERE EXISTS(SELECT price FROM room WHERE price = 2000)
ORDER BY capacity
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT *
    -> FROM room
    -> WHERE EXISTS(SELECT price FROM room WHERE price = 2000)
    -> ORDER BY capacity
    -> ;
Empty set (0.00 sec)

```
</details>

```sql
INSERT INTO room(number, capacity, price, phone_number, comfort_id) 
VALUE ('20', 2, 2000, '27', 2)
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT *
    -> FROM room
    -> WHERE EXISTS(SELECT price FROM room WHERE price = 2000)
    -> ORDER BY capacity
    -> ;
+-----+--------+----------+----------+--------------+------------+
| _id | number | capacity | price    | phone_number | comfort_id |
+-----+--------+----------+----------+--------------+------------+
|   4 | 225    |        1 |  2100.00 | 8            |          1 |
|   6 | 202    |        1 |  2500.00 | 4            |          1 |
|   8 | 101    |        1 |  2950.00 | 256          |          1 |
|  18 | 12     |        1 |  1250.00 | 12           |          1 |
|  21 | 7      |        1 |  1700.00 | 7            |          1 |
|   1 | 213    |        2 |  2950.00 | 512          |          1 |
|   2 | 303    |        2 |  4320.00 | 128          |          2 |
|  13 | 128    |        2 |   999.00 | 1            |          1 |
|  14 | 754    |        2 |  3225.00 | 2048         |          2 |
|  20 | 23     |        2 |  2500.00 | 23           |          2 |
|  22 | 20     |        2 |  2000.00 | 27           |          2 |
|   3 | 506    |        3 |  7800.00 | 32           |          3 |
|   7 | 123    |        3 |  3400.00 | 1024         |          1 |
|  17 | 65     |        3 |  2999.00 | 4096         |          1 |
|  19 | 78     |        3 |  3134.00 | 8192         |          2 |
|   5 | 4      |        4 |  4000.00 | 202          |          1 |
|   9 | 11     |        4 |  7320.00 | 3            |          2 |
|  12 | 555    |        4 |  9230.00 | 64           |          3 |
|  16 | 45     |        4 |  4500.00 | 45           |          3 |
|  10 | 5      |        5 |  5000.00 | 5            |          2 |
|  11 | 707    |        5 | 10580.00 | 2            |          3 |
|  15 | 6      |        6 |  6000.00 | 6            |          3 |
+-----+--------+----------+----------+--------------+------------+
22 rows in set (0.00 sec)

```
</details>

### Задача 6
Вывести данные о номерах, с количеством человек меньше среднего по всем номерам.

```sql
SELECT *
FROM room
WHERE capacity IN(
  SELECT capacity FROM room WHERE room.capacity <
    (SELECT AVG(room.capacity) FROM room)
  )
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT *
    -> FROM room
    -> WHERE capacity IN(
    -> SELECT capacity FROM room WHERE room.capacity <
    -> (SELECT AVG(room.capacity) FROM room)
    -> )
    -> ;
+-----+--------+----------+---------+--------------+------------+
| _id | number | capacity | price   | phone_number | comfort_id |
+-----+--------+----------+---------+--------------+------------+
|   1 | 213    |        2 | 2950.00 | 512          |          1 |
|   2 | 303    |        2 | 4320.00 | 128          |          2 |
|   4 | 225    |        1 | 2100.00 | 8            |          1 |
|   6 | 202    |        1 | 2500.00 | 4            |          1 |
|   8 | 101    |        1 | 2950.00 | 256          |          1 |
|  13 | 128    |        2 |  999.00 | 1            |          1 |
|  14 | 754    |        2 | 3225.00 | 2048         |          2 |
|  18 | 12     |        1 | 1250.00 | 12           |          1 |
|  20 | 23     |        2 | 2500.00 | 23           |          2 |
|  21 | 7      |        1 | 1700.00 | 7            |          1 |
|  22 | 20     |        2 | 2000.00 | 27           |          2 |
+-----+--------+----------+---------+--------------+------------+
11 rows in set (0.00 sec)

```
</details>

## Работа 16.O. «Создание запросов на изменение данных»

```sql
INSERT INTO checkin(date_ts, enter_date, leave_date, room_id, client_id)
VALUE('2018-11-22 10:12:35', '2018-11-22', '2018-12-31', 11, 24)
;
```

### Задача 1
Добавить три записи в таблицу Клиенты.

```sql
INSERT INTO client(last_name, first_name, second_name, sex, passport_number, birth_date, address, comment) VALUES
    ('Романов', 'Николай', 'Павлович', 'm', '2506179618', '1996-08-06', 'ул. Волкова, д. 164, г. Йошкар-Ола, Республика Марий Эл, 424000', NULL),
    ('Цой', 'Роберт', 'Максимович', 'm', '1938231560', '2008-05-05', 'пр. Ленина, д. 14, пом. 3, г. Саранск, Республика Мордовия, 430005', NULL),
    ('Быков', 'Константин', 'Алексеевич', 'm', '2311186109', '1961-12-05', 'Карамышевская набережная, д. 44, г. Москва, 123423', 'живописец, педагог и писатель')
;

```

<details>
<summary><b>Запрос</b></summary>

```
mysql> INSERT INTO client(last_name, first_name, second_name, sex, passport_number, birth_date, address, comment) VALUES
    -> ('Романов', 'Николай', 'Павлович', 'm', '2506179618', '1996-08-06', 'ул. Волкова, д. 164, г. Йошкар-Ола, Республика Марий Эл, 424000', NULL),
    -> ('Цой', 'Роберт', 'Максимович', 'm', '1938231560', '2008-05-05', 'пр. Ленина, д. 14, пом. 3, г. Саранск, Республика Мордовия, 430005', NULL),
    -> ('Быков', 'Константин', 'Алексеевич', 'm', '2311186109', '1961-12-05', 'Карамышевская набережная, д. 44, г. Москва, 123423', 'живописец, педагог и писатель')
    -> ;
Query OK, 3 rows affected (0.00 sec)
Records: 3  Duplicates: 0  Warnings: 0

mysql> SELECT
    -> _id,
    -> CONCAT(last_name, ' ', first_name, ' ', second_name) AS "ФИО",
    -> CASE
    -> WHEN sex = "m" THEN 'м'
    -> WHEN sex = "f" THEN 'ж'
    -> END AS "Пол",
    -> CONCAT(SUBSTRING(passport_number, 1, 4), ' ', SUBSTRING(passport_number, 5)) AS "Паспорт",
    -> birth_date AS "Дата рождения",
    -> IF (LENGTH(address) > 20, CONCAT(SUBSTRING(address, 1, 30), '...'), address) AS "Адрес",
    -> IF (comment IS NOT NULL, comment, '') AS "Комментарий"
    -> FROM client
    -> ;
+-----+-----------------------------------+------+-------------+---------------+-----------------------------------+--------------------------------------------+
| _id | ФИО                               | Пол  | Паспорт     | Дата рождения | Адрес                             | Комментарий                                |
+-----+-----------------------------------+------+-------------+---------------+-----------------------------------+--------------------------------------------+
|   1 | Капралов Герман Петрович          | м    | 6921 698435 | 1961-10-21    | ул. Дуки, д. 80, г. Брянск, Бр... |                                            |
|   2 | Сидоров Сидор Сидорович           | ж    | 7863 523156 | 1975-03-08    | ул. Советская, д. 23, г. Тверь... |                                            |
|   3 | Иванов Иван Иванович              | м    | 0569 836879 | 1985-02-16    | Воскресенский б-р, д. 3, г. Ве... | Не любит шум                               |
|   4 | Суворова Галина Ивановна          | ж    | 9874 563215 | 1975-04-03    | пл. Ленина, д. 2, г. Махачкала... |                                            |
|   5 | Петров Степан Викторович          | м    | 0786 534882 | 1965-08-21    | ул. Калиновская, д. 38, г. Кос... |                                            |
|   6 | Решетникова Анна Владимировна     | ж    | 6798 563549 | 1973-08-09    | ул. Победы, д. 3, корп. С, г. ... | Крайне обидчива                            |
|   7 | Ян Мария Григорьевна              | ж    | 9804 356987 | 1994-05-24    | ул. Свободы, д. 46, г. Ярослав... |                                            |
|   8 | Агафонов Валерий Борисович        | м    | 6349 197041 | 1941-03-10    | ул. Марата, д. 9, г. Курск, Ку... | певец                                      |
|   9 | Самохвалов Юрий Петрович          | м    | 7888 632153 | 1952-02-22    | ул. Холодильная, д. 58а, г. Тю... | Очень уважаемый человек                    |
|  10 | Чижиков Михаил Николаевич         | м    | 5468 654932 | 2001-07-14    | ул. Московская, д. 55, г. Каза... |                                            |
|  11 | Капралова Светлана Борисовна      | ж    | 5428 965246 | 1975-04-19    | 4-я линия В.О., д. 13, лит. А,... |                                            |
|  12 | Лапина Марина Александровна       | ж    | 0428 456828 | 1988-03-17    | пр-т Ворошиловский, д. 2/2, оф... |                                            |
|  13 | Красавин Вадим Анатольевич        | м    | 7689 254981 | 1985-03-30    | пр-т К. Маркса, д. 12А, г. Омс... | Отличный парень                            |
|  14 | Пень Юрий Васильевич              | м    | 7899 245684 | 1949-01-01    | ул. Книповича, д. 9а, г. Мурма... |                                            |
|  15 | Соловьев Владимир Рудовольфович   | м    | 5679 546321 | 1963-10-20    | наб. Варкауса, д. 1А, г. Петро... | российский журналист, радио- и телеведущий |
|  16 | Мединская Ирина Глебовна          | ж    | 7788 654587 | 2003-12-31    | ул. Карла Либкнехта, д. 55, г.... |                                            |
|  17 | Агапова Софья Филипповна          | ж    | 4529 999542 | 1948-02-13    | ул. Жарова, д. 10, г. Иваново,... | Добрая бабуля                              |
|  18 | Соколов Михаил Иванович           | м    | 5793 249563 | 1988-07-16    | ул. Ленина, д. 40, г. Майкоп, ... |                                            |
|  19 | Рогов Александр Владимирович      | м    | 8743 698421 | 1953-05-30    | ул. Улагашева, д. 13, г. Горно... |                                            |
|  20 | Васильев Александр Александрович  | м    | 5468 983123 | 1958-08-12    | пр-т Калинина, д. 8, г. Барнау... | Историк моды                               |
|  21 | Фролов Иван Павлович              | м    | 7892 697635 | 1979-08-03    | ул. Амурская, д. 150, г. Благо... |                                            |
|  22 | Ампилов Виктор Иванович           | м    | 6548 652325 | 2005-10-02    | ул. Большая Московская, д. 1, ... |                                            |
|  23 | Суриков Василий Петрович          | м    | 5498 324568 | 1956-12-20    | ул. 7-я Гвардейская, д. 12, г.... |                                            |
|  24 | Матвиенко Александр Александрович | м    | 5469 842632 | 1996-05-02    | ул. К. Либкнехта, д. 2, г. Арх... | футболист                                  |
|  25 | Фролова Анна Тарасовна            | ж    | 7842 359821 | 1997-07-19    | ул. Шаумяна, д. 47, г. Астраха... |                                            |
|  26 | Симонов Александр Михайлович      | м    | 4569 487532 | 1974-11-15    | ул. Пушкина, д. 95, г. Уфа, Ре... |                                            |
|  27 | Северов Нестор Петрович           | м    | 7865 243896 | 1965-04-29    | ул. Ленина, д. 55, г. Улан-Удэ... | Новенький                                  |
|  28 | Просов Владимир Тимофеевич        | м    | 1998 653478 | 1991-03-03    | Мясницкий проезд, д. 4, стр. 1... |                                            |
|  29 | Романов Николай Павлович          | м    | 2506 179618 | 1996-08-06    | ул. Волкова, д. 164, г. Йошкар... |                                            |
|  30 | Цой Роберт Максимович             | м    | 1938 231560 | 2008-05-05    | пр. Ленина, д. 14, пом. 3, г. ... |                                            |
|  31 | Быков Константин Алексеевич       | м    | 2311 186109 | 1961-12-05    | Карамышевская набережная, д. 4... | живописец, педагог и писатель              |
+-----+-----------------------------------+------+-------------+---------------+-----------------------------------+--------------------------------------------+
31 rows in set (0.00 sec)

```
</details>

### Задача 2
Изменить цены за номер, увеличив их на 15%.

```sql
UPDATE room
  SET price = price * 1.15
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT * FROM room;
+-----+--------+----------+----------+--------------+------------+
| _id | number | capacity | price    | phone_number | comfort_id |
+-----+--------+----------+----------+--------------+------------+
|   1 | 213    |        2 |  2950.00 | 512          |          1 |
|   2 | 303    |        2 |  4320.00 | 128          |          2 |
|   3 | 506    |        3 |  7800.00 | 32           |          3 |
|   4 | 225    |        1 |  2100.00 | 8            |          1 |
|   5 | 4      |        4 |  4000.00 | 202          |          1 |
|   6 | 202    |        1 |  2500.00 | 4            |          1 |
|   7 | 123    |        3 |  3400.00 | 1024         |          1 |
|   8 | 101    |        1 |  2950.00 | 256          |          1 |
|   9 | 11     |        4 |  7320.00 | 3            |          2 |
|  10 | 5      |        5 |  5000.00 | 5            |          2 |
|  11 | 707    |        5 | 10580.00 | 2            |          3 |
|  12 | 555    |        4 |  9230.00 | 64           |          3 |
|  13 | 128    |        2 |   999.00 | 1            |          1 |
|  14 | 754    |        2 |  3225.00 | 2048         |          2 |
|  15 | 6      |        6 |  6000.00 | 6            |          3 |
|  16 | 45     |        4 |  4500.00 | 45           |          3 |
|  17 | 65     |        3 |  2999.00 | 4096         |          1 |
|  18 | 12     |        1 |  1250.00 | 12           |          1 |
|  19 | 78     |        3 |  3134.00 | 8192         |          2 |
|  20 | 23     |        2 |  2500.00 | 23           |          2 |
|  21 | 7      |        1 |  1700.00 | 7            |          1 |
|  22 | 20     |        2 |  2000.00 | 27           |          2 |
+-----+--------+----------+----------+--------------+------------+
22 rows in set (0.00 sec)

mysql> UPDATE room
    -> SET price = price * 1.15
    -> ;
Query OK, 22 rows affected (0.00 sec)
Rows matched: 22  Changed: 22  Warnings: 0

mysql> SELECT * FROM room;
+-----+--------+----------+----------+--------------+------------+
| _id | number | capacity | price    | phone_number | comfort_id |
+-----+--------+----------+----------+--------------+------------+
|   1 | 213    |        2 |  3392.50 | 512          |          1 |
|   2 | 303    |        2 |  4968.00 | 128          |          2 |
|   3 | 506    |        3 |  8970.00 | 32           |          3 |
|   4 | 225    |        1 |  2415.00 | 8            |          1 |
|   5 | 4      |        4 |  4600.00 | 202          |          1 |
|   6 | 202    |        1 |  2875.00 | 4            |          1 |
|   7 | 123    |        3 |  3910.00 | 1024         |          1 |
|   8 | 101    |        1 |  3392.50 | 256          |          1 |
|   9 | 11     |        4 |  8418.00 | 3            |          2 |
|  10 | 5      |        5 |  5750.00 | 5            |          2 |
|  11 | 707    |        5 | 12167.00 | 2            |          3 |
|  12 | 555    |        4 | 10614.50 | 64           |          3 |
|  13 | 128    |        2 |  1148.85 | 1            |          1 |
|  14 | 754    |        2 |  3708.75 | 2048         |          2 |
|  15 | 6      |        6 |  6900.00 | 6            |          3 |
|  16 | 45     |        4 |  5175.00 | 45           |          3 |
|  17 | 65     |        3 |  3448.85 | 4096         |          1 |
|  18 | 12     |        1 |  1437.50 | 12           |          1 |
|  19 | 78     |        3 |  3604.10 | 8192         |          2 |
|  20 | 23     |        2 |  2875.00 | 23           |          2 |
|  21 | 7      |        1 |  1955.00 | 7            |          1 |
|  22 | 20     |        2 |  2300.00 | 27           |          2 |
+-----+--------+----------+----------+--------------+------------+
22 rows in set (0.00 sec)

```
</details>

### Задача 3
Изменить имена клиентов, имена которых Иван, Николай или Константин на Александр.

```sql
UPDATE client
  SET first_name = "Александр"
  WHERE first_name IN ("Иван", "Николай", "Константин")
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT _id, last_name AS "Фамилия", first_name AS "Имя", second_name AS "Отчество" FROM client;
+-----+-------------+------------+---------------+
| _id | Фамилия     | Имя        | Отчество      |
+-----+-------------+------------+---------------+
|   1 | Капралов    | Герман     | Петрович      |
|   2 | Сидоров     | Сидор      | Сидорович     |
|   3 | Иванов      | Иван       | Иванович      |
|   4 | Суворова    | Галина     | Ивановна      |
|   5 | Петров      | Степан     | Викторович    |
|   6 | Решетникова | Анна       | Владимировна  |
|   7 | Ян          | Мария      | Григорьевна   |
|   8 | Агафонов    | Валерий    | Борисович     |
|   9 | Самохвалов  | Юрий       | Петрович      |
|  10 | Чижиков     | Михаил     | Николаевич    |
|  11 | Капралова   | Светлана   | Борисовна     |
|  12 | Лапина      | Марина     | Александровна |
|  13 | Красавин    | Вадим      | Анатольевич   |
|  14 | Пень        | Юрий       | Васильевич    |
|  15 | Соловьев    | Владимир   | Рудовольфович |
|  16 | Мединская   | Ирина      | Глебовна      |
|  17 | Агапова     | Софья      | Филипповна    |
|  18 | Соколов     | Михаил     | Иванович      |
|  19 | Рогов       | Александр  | Владимирович  |
|  20 | Васильев    | Александр  | Александрович |
|  21 | Фролов      | Иван       | Павлович      |
|  22 | Ампилов     | Виктор     | Иванович      |
|  23 | Суриков     | Василий    | Петрович      |
|  24 | Матвиенко   | Александр  | Александрович |
|  25 | Фролова     | Анна       | Тарасовна     |
|  26 | Симонов     | Александр  | Михайлович    |
|  27 | Северов     | Нестор     | Петрович      |
|  28 | Просов      | Владимир   | Тимофеевич    |
|  29 | Романов     | Николай    | Павлович      |
|  30 | Цой         | Роберт     | Максимович    |
|  31 | Быков       | Константин | Алексеевич    |
+-----+-------------+------------+---------------+
31 rows in set (0.10 sec)

mysql> UPDATE client SET first_name = "Александр" WHERE first_name IN ("Иван", "Николай", "Константин");
Query OK, 4 rows affected (0.00 sec)
Rows matched: 4  Changed: 4  Warnings: 0

mysql> SELECT _id, last_name AS "Фамилия", first_name AS "Имя", second_name AS "Отчество" FROM client;
+-----+-------------+-----------+---------------+
| _id | Фамилия     | Имя       | Отчество      |
+-----+-------------+-----------+---------------+
|   1 | Капралов    | Герман    | Петрович      |
|   2 | Сидоров     | Сидор     | Сидорович     |
|   3 | Иванов      | Александр | Иванович      |
|   4 | Суворова    | Галина    | Ивановна      |
|   5 | Петров      | Степан    | Викторович    |
|   6 | Решетникова | Анна      | Владимировна  |
|   7 | Ян          | Мария     | Григорьевна   |
|   8 | Агафонов    | Валерий   | Борисович     |
|   9 | Самохвалов  | Юрий      | Петрович      |
|  10 | Чижиков     | Михаил    | Николаевич    |
|  11 | Капралова   | Светлана  | Борисовна     |
|  12 | Лапина      | Марина    | Александровна |
|  13 | Красавин    | Вадим     | Анатольевич   |
|  14 | Пень        | Юрий      | Васильевич    |
|  15 | Соловьев    | Владимир  | Рудовольфович |
|  16 | Мединская   | Ирина     | Глебовна      |
|  17 | Агапова     | Софья     | Филипповна    |
|  18 | Соколов     | Михаил    | Иванович      |
|  19 | Рогов       | Александр | Владимирович  |
|  20 | Васильев    | Александр | Александрович |
|  21 | Фролов      | Александр | Павлович      |
|  22 | Ампилов     | Виктор    | Иванович      |
|  23 | Суриков     | Василий   | Петрович      |
|  24 | Матвиенко   | Александр | Александрович |
|  25 | Фролова     | Анна      | Тарасовна     |
|  26 | Симонов     | Александр | Михайлович    |
|  27 | Северов     | Нестор    | Петрович      |
|  28 | Просов      | Владимир  | Тимофеевич    |
|  29 | Романов     | Александр | Павлович      |
|  30 | Цой         | Роберт    | Максимович    |
|  31 | Быков       | Александр | Алексеевич    |
+-----+-------------+-----------+---------------+
31 rows in set (0.00 sec)

```
</details>

### Задача 4
Удалить клиентов, возраст которых выше 60 лет.

```sql
DELETE client
  FROM client
  WHERE TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) > 60
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT _id, last_name AS "Фамилия", first_name AS "Имя", second_name AS "Отчество", TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) AS "Возраст" FROM client;
+-----+-------------+-----------+---------------+---------+
| _id | Фамилия     | Имя       | Отчество      | Возраст |
+-----+-------------+-----------+---------------+---------+
|   1 | Капралов    | Герман    | Петрович      |      62 |
|   2 | Сидоров     | Сидор     | Сидорович     |      49 |
|   3 | Иванов      | Александр | Иванович      |      39 |
|   4 | Суворова    | Галина    | Ивановна      |      49 |
|   5 | Петров      | Степан    | Викторович    |      58 |
|   6 | Решетникова | Анна      | Владимировна  |      50 |
|   7 | Ян          | Мария     | Григорьевна   |      29 |
|   8 | Агафонов    | Валерий   | Борисович     |      83 |
|   9 | Самохвалов  | Юрий      | Петрович      |      72 |
|  10 | Чижиков     | Михаил    | Николаевич    |      22 |
|  11 | Капралова   | Светлана  | Борисовна     |      49 |
|  12 | Лапина      | Марина    | Александровна |      36 |
|  13 | Красавин    | Вадим     | Анатольевич   |      39 |
|  14 | Пень        | Юрий      | Васильевич    |      75 |
|  15 | Соловьев    | Владимир  | Рудовольфович |      60 |
|  16 | Мединская   | Ирина     | Глебовна      |      20 |
|  17 | Агапова     | Софья     | Филипповна    |      76 |
|  18 | Соколов     | Михаил    | Иванович      |      35 |
|  19 | Рогов       | Александр | Владимирович  |      70 |
|  20 | Васильев    | Александр | Александрович |      65 |
|  21 | Фролов      | Александр | Павлович      |      44 |
|  22 | Ампилов     | Виктор    | Иванович      |      18 |
|  23 | Суриков     | Василий   | Петрович      |      67 |
|  24 | Матвиенко   | Александр | Александрович |      28 |
|  25 | Фролова     | Анна      | Тарасовна     |      26 |
|  26 | Симонов     | Александр | Михайлович    |      49 |
|  27 | Северов     | Нестор    | Петрович      |      59 |
|  28 | Просов      | Владимир  | Тимофеевич    |      33 |
|  29 | Романов     | Александр | Павлович      |      27 |
|  30 | Цой         | Роберт    | Максимович    |      16 |
|  31 | Быков       | Александр | Алексеевич    |      62 |
+-----+-------------+-----------+---------------+---------+
31 rows in set (0.00 sec)

mysql> DELETE client FROM client WHERE TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) > 60;
Query OK, 9 rows affected (0.01 sec)

mysql> SELECT _id, last_name AS "Фамилия", first_name AS "Имя", second_name AS "Отчество", TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) AS "Возраст" FROM client;
+-----+-------------+-----------+---------------+---------+
| _id | Фамилия     | Имя       | Отчество      | Возраст |
+-----+-------------+-----------+---------------+---------+
|   2 | Сидоров     | Сидор     | Сидорович     |      49 |
|   3 | Иванов      | Александр | Иванович      |      39 |
|   4 | Суворова    | Галина    | Ивановна      |      49 |
|   5 | Петров      | Степан    | Викторович    |      58 |
|   6 | Решетникова | Анна      | Владимировна  |      50 |
|   7 | Ян          | Мария     | Григорьевна   |      29 |
|  10 | Чижиков     | Михаил    | Николаевич    |      22 |
|  11 | Капралова   | Светлана  | Борисовна     |      49 |
|  12 | Лапина      | Марина    | Александровна |      36 |
|  13 | Красавин    | Вадим     | Анатольевич   |      39 |
|  15 | Соловьев    | Владимир  | Рудовольфович |      60 |
|  16 | Мединская   | Ирина     | Глебовна      |      20 |
|  18 | Соколов     | Михаил    | Иванович      |      35 |
|  21 | Фролов      | Александр | Павлович      |      44 |
|  22 | Ампилов     | Виктор    | Иванович      |      18 |
|  24 | Матвиенко   | Александр | Александрович |      28 |
|  25 | Фролова     | Анна      | Тарасовна     |      26 |
|  26 | Симонов     | Александр | Михайлович    |      49 |
|  27 | Северов     | Нестор    | Петрович      |      59 |
|  28 | Просов      | Владимир  | Тимофеевич    |      33 |
|  29 | Романов     | Александр | Павлович      |      27 |
|  30 | Цой         | Роберт    | Максимович    |      16 |
+-----+-------------+-----------+---------------+---------+
22 rows in set (0.00 sec)

```
</details>

### Задача 5
Изменить дату поселения клиентов, которые освободили номер с марта по май 2018 г. на 01.01.2018.

```sql
UPDATE checkin
  SET enter_date = '2018-01-01'
  WHERE leave_date BETWEEN '2018-03-01' AND '2018-05-31'
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT * FROM checkin ORDER BY leave_date;
+-----+---------------------+------------+------------+---------+-----------+
| _id | date_ts             | enter_date | leave_date | room_id | client_id |
+-----+---------------------+------------+------------+---------+-----------+
|  16 | 2018-04-01 12:45:03 | 2018-04-01 | 2018-04-22 |      18 |        22 |
|   4 | 2018-06-11 13:12:06 | 2018-06-11 | 2018-07-05 |       7 |        18 |
|  20 | 2018-11-22 10:12:35 | 2018-11-22 | 2018-12-31 |      11 |        24 |
|   7 | 2021-04-01 14:04:06 | 2021-04-01 | 2021-04-29 |       9 |        16 |
|  11 | 2022-04-12 10:44:56 | 2022-04-12 | 2022-06-18 |       8 |        15 |
|  12 | 2023-11-19 19:12:38 | 2023-11-19 | 2023-11-23 |       5 |        11 |
|  10 | 2023-11-17 16:11:52 | 2023-11-17 | 2023-11-25 |       5 |        12 |
|   3 | 2023-11-14 11:06:12 | 2023-11-14 | 2023-11-28 |       3 |         3 |
|   9 | 2023-11-16 12:10:23 | 2023-11-16 | 2023-12-10 |       1 |        10 |
|   5 | 2023-12-01 17:04:30 | 2023-12-01 | 2023-12-29 |       4 |         4 |
|  13 | 2023-11-16 12:31:20 | 2023-11-16 | 2023-12-31 |       2 |        13 |
|   6 | 2023-12-12 18:07:15 | 2023-12-12 | 2024-01-05 |       6 |         6 |
|   2 | 2023-12-28 09:32:48 | 2023-12-28 | 2024-01-17 |       2 |         2 |
+-----+---------------------+------------+------------+---------+-----------+
13 rows in set (0.00 sec)

mysql> UPDATE checkin
    -> SET enter_date = '2018-01-01'
    -> WHERE leave_date BETWEEN '2018-03-01' AND '2018-05-31'
    -> ;
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> SELECT * FROM checkin ORDER BY leave_date;
+-----+---------------------+------------+------------+---------+-----------+
| _id | date_ts             | enter_date | leave_date | room_id | client_id |
+-----+---------------------+------------+------------+---------+-----------+
|  16 | 2018-04-01 12:45:03 | 2018-01-01 | 2018-04-22 |      18 |        22 |
|   4 | 2018-06-11 13:12:06 | 2018-06-11 | 2018-07-05 |       7 |        18 |
|  20 | 2018-11-22 10:12:35 | 2018-11-22 | 2018-12-31 |      11 |        24 |
|   7 | 2021-04-01 14:04:06 | 2021-04-01 | 2021-04-29 |       9 |        16 |
|  11 | 2022-04-12 10:44:56 | 2022-04-12 | 2022-06-18 |       8 |        15 |
|  12 | 2023-11-19 19:12:38 | 2023-11-19 | 2023-11-23 |       5 |        11 |
|  10 | 2023-11-17 16:11:52 | 2023-11-17 | 2023-11-25 |       5 |        12 |
|   3 | 2023-11-14 11:06:12 | 2023-11-14 | 2023-11-28 |       3 |         3 |
|   9 | 2023-11-16 12:10:23 | 2023-11-16 | 2023-12-10 |       1 |        10 |
|   5 | 2023-12-01 17:04:30 | 2023-12-01 | 2023-12-29 |       4 |         4 |
|  13 | 2023-11-16 12:31:20 | 2023-11-16 | 2023-12-31 |       2 |        13 |
|   6 | 2023-12-12 18:07:15 | 2023-12-12 | 2024-01-05 |       6 |         6 |
|   2 | 2023-12-28 09:32:48 | 2023-12-28 | 2024-01-17 |       2 |         2 |
+-----+---------------------+------------+------------+---------+-----------+
13 rows in set (0.00 sec)

```
</details>

### Задача 6
Изменить номера телефонов в тех гостиничных номерах, в которых цена более 5000 руб.

```sql
UPDATE room
  SET phone_number = CONCAT('0', phone_number)
  WHERE price > 5000
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT * FROM room ORDER BY price DESC;
+-----+--------+----------+----------+--------------+------------+
| _id | number | capacity | price    | phone_number | comfort_id |
+-----+--------+----------+----------+--------------+------------+
|  11 | 707    |        5 | 12167.00 | 2            |          3 |
|  12 | 555    |        4 | 10614.50 | 64           |          3 |
|   3 | 506    |        3 |  8970.00 | 32           |          3 |
|   9 | 11     |        4 |  8418.00 | 3            |          2 |
|  15 | 6      |        6 |  6900.00 | 6            |          3 |
|  10 | 5      |        5 |  5750.00 | 5            |          2 |
|  16 | 45     |        4 |  5175.00 | 45           |          3 |
|   2 | 303    |        2 |  4968.00 | 128          |          2 |
|   5 | 4      |        4 |  4600.00 | 202          |          1 |
|   7 | 123    |        3 |  3910.00 | 1024         |          1 |
|  14 | 754    |        2 |  3708.75 | 2048         |          2 |
|  19 | 78     |        3 |  3604.10 | 8192         |          2 |
|  17 | 65     |        3 |  3448.85 | 4096         |          1 |
|   1 | 213    |        2 |  3392.50 | 512          |          1 |
|   8 | 101    |        1 |  3392.50 | 256          |          1 |
|   6 | 202    |        1 |  2875.00 | 4            |          1 |
|  20 | 23     |        2 |  2875.00 | 23           |          2 |
|   4 | 225    |        1 |  2415.00 | 8            |          1 |
|  22 | 20     |        2 |  2300.00 | 27           |          2 |
|  21 | 7      |        1 |  1955.00 | 7            |          1 |
|  18 | 12     |        1 |  1437.50 | 12           |          1 |
|  13 | 128    |        2 |  1148.85 | 1            |          1 |
+-----+--------+----------+----------+--------------+------------+
22 rows in set (0.00 sec)

mysql> UPDATE room SET phone_number = CONCAT('0', phone_number) WHERE price > 5000;
Query OK, 7 rows affected (0.09 sec)
Rows matched: 7  Changed: 7  Warnings: 0

mysql> SELECT * FROM room ORDER BY price DESC;
+-----+--------+----------+----------+--------------+------------+
| _id | number | capacity | price    | phone_number | comfort_id |
+-----+--------+----------+----------+--------------+------------+
|  11 | 707    |        5 | 12167.00 | 02           |          3 |
|  12 | 555    |        4 | 10614.50 | 064          |          3 |
|   3 | 506    |        3 |  8970.00 | 032          |          3 |
|   9 | 11     |        4 |  8418.00 | 03           |          2 |
|  15 | 6      |        6 |  6900.00 | 06           |          3 |
|  10 | 5      |        5 |  5750.00 | 05           |          2 |
|  16 | 45     |        4 |  5175.00 | 045          |          3 |
|   2 | 303    |        2 |  4968.00 | 128          |          2 |
|   5 | 4      |        4 |  4600.00 | 202          |          1 |
|   7 | 123    |        3 |  3910.00 | 1024         |          1 |
|  14 | 754    |        2 |  3708.75 | 2048         |          2 |
|  19 | 78     |        3 |  3604.10 | 8192         |          2 |
|  17 | 65     |        3 |  3448.85 | 4096         |          1 |
|   1 | 213    |        2 |  3392.50 | 512          |          1 |
|   8 | 101    |        1 |  3392.50 | 256          |          1 |
|   6 | 202    |        1 |  2875.00 | 4            |          1 |
|  20 | 23     |        2 |  2875.00 | 23           |          2 |
|   4 | 225    |        1 |  2415.00 | 8            |          1 |
|  22 | 20     |        2 |  2300.00 | 27           |          2 |
|  21 | 7      |        1 |  1955.00 | 7            |          1 |
|  18 | 12     |        1 |  1437.50 | 12           |          1 |
|  13 | 128    |        2 |  1148.85 | 1            |          1 |
+-----+--------+----------+----------+--------------+------------+
22 rows in set (0.00 sec)

```
</details>

### Задача 7
Удалить данные о поселении, в которых дата освобождения 31.12.2018.

```sql
DELETE
  FROM checkin
  WHERE leave_date = '2018-12-31'
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT * FROM checkin ORDER BY leave_date;
+-----+---------------------+------------+------------+---------+-----------+
| _id | date_ts             | enter_date | leave_date | room_id | client_id |
+-----+---------------------+------------+------------+---------+-----------+
|  16 | 2018-04-01 12:45:03 | 2018-01-01 | 2018-04-22 |      18 |        22 |
|   4 | 2018-06-11 13:12:06 | 2018-06-11 | 2018-07-05 |       7 |        18 |
|  20 | 2018-11-22 10:12:35 | 2018-11-22 | 2018-12-31 |      11 |        24 |
|   7 | 2021-04-01 14:04:06 | 2021-04-01 | 2021-04-29 |       9 |        16 |
|  11 | 2022-04-12 10:44:56 | 2022-04-12 | 2022-06-18 |       8 |        15 |
|  12 | 2023-11-19 19:12:38 | 2023-11-19 | 2023-11-23 |       5 |        11 |
|  10 | 2023-11-17 16:11:52 | 2023-11-17 | 2023-11-25 |       5 |        12 |
|   3 | 2023-11-14 11:06:12 | 2023-11-14 | 2023-11-28 |       3 |         3 |
|   9 | 2023-11-16 12:10:23 | 2023-11-16 | 2023-12-10 |       1 |        10 |
|   5 | 2023-12-01 17:04:30 | 2023-12-01 | 2023-12-29 |       4 |         4 |
|  13 | 2023-11-16 12:31:20 | 2023-11-16 | 2023-12-31 |       2 |        13 |
|   6 | 2023-12-12 18:07:15 | 2023-12-12 | 2024-01-05 |       6 |         6 |
|   2 | 2023-12-28 09:32:48 | 2023-12-28 | 2024-01-17 |       2 |         2 |
+-----+---------------------+------------+------------+---------+-----------+
13 rows in set (0.00 sec)

mysql> DELETE
    -> FROM checkin
    -> WHERE leave_date = '2018-12-31'
    -> ;
Query OK, 1 row affected (0.00 sec)

mysql> SELECT * FROM checkin ORDER BY leave_date;
+-----+---------------------+------------+------------+---------+-----------+
| _id | date_ts             | enter_date | leave_date | room_id | client_id |
+-----+---------------------+------------+------------+---------+-----------+
|  16 | 2018-04-01 12:45:03 | 2018-01-01 | 2018-04-22 |      18 |        22 |
|   4 | 2018-06-11 13:12:06 | 2018-06-11 | 2018-07-05 |       7 |        18 |
|   7 | 2021-04-01 14:04:06 | 2021-04-01 | 2021-04-29 |       9 |        16 |
|  11 | 2022-04-12 10:44:56 | 2022-04-12 | 2022-06-18 |       8 |        15 |
|  12 | 2023-11-19 19:12:38 | 2023-11-19 | 2023-11-23 |       5 |        11 |
|  10 | 2023-11-17 16:11:52 | 2023-11-17 | 2023-11-25 |       5 |        12 |
|   3 | 2023-11-14 11:06:12 | 2023-11-14 | 2023-11-28 |       3 |         3 |
|   9 | 2023-11-16 12:10:23 | 2023-11-16 | 2023-12-10 |       1 |        10 |
|   5 | 2023-12-01 17:04:30 | 2023-12-01 | 2023-12-29 |       4 |         4 |
|  13 | 2023-11-16 12:31:20 | 2023-11-16 | 2023-12-31 |       2 |        13 |
|   6 | 2023-12-12 18:07:15 | 2023-12-12 | 2024-01-05 |       6 |         6 |
|   2 | 2023-12-28 09:32:48 | 2023-12-28 | 2024-01-17 |       2 |         2 |
+-----+---------------------+------------+------------+---------+-----------+
12 rows in set (0.00 sec)

```
</details>

### Задача 8
Удалить клиентов, которые являются несовершеннолетними и имя Роберт.

```sql
DELETE
  FROM client
  WHERE TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) < 18 AND first_name = 'Роберт'
;
```

<details>
<summary><b>Запрос</b></summary>

```
mysql> SELECT _id, last_name AS "Фамилия", first_name AS "Имя", second_name AS "Отчество",
    -> TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) AS Возраст FROM client ORDER BY Возраст;
+-----+-------------+-----------+---------------+---------+
| _id | Фамилия     | Имя       | Отчество      | Возраст |
+-----+-------------+-----------+---------------+---------+
|  30 | Цой         | Роберт    | Максимович    |      16 |
|  22 | Ампилов     | Виктор    | Иванович      |      18 |
|  16 | Мединская   | Ирина     | Глебовна      |      20 |
|  10 | Чижиков     | Михаил    | Николаевич    |      22 |
|  25 | Фролова     | Анна      | Тарасовна     |      26 |
|  29 | Романов     | Александр | Павлович      |      27 |
|  24 | Матвиенко   | Александр | Александрович |      28 |
|   7 | Ян          | Мария     | Григорьевна   |      29 |
|  28 | Просов      | Владимир  | Тимофеевич    |      33 |
|  18 | Соколов     | Михаил    | Иванович      |      35 |
|  12 | Лапина      | Марина    | Александровна |      36 |
|   3 | Иванов      | Александр | Иванович      |      39 |
|  13 | Красавин    | Вадим     | Анатольевич   |      39 |
|  21 | Фролов      | Александр | Павлович      |      44 |
|   2 | Сидоров     | Сидор     | Сидорович     |      49 |
|   4 | Суворова    | Галина    | Ивановна      |      49 |
|  11 | Капралова   | Светлана  | Борисовна     |      49 |
|  26 | Симонов     | Александр | Михайлович    |      49 |
|   6 | Решетникова | Анна      | Владимировна  |      50 |
|   5 | Петров      | Степан    | Викторович    |      58 |
|  27 | Северов     | Нестор    | Петрович      |      59 |
|  15 | Соловьев    | Владимир  | Рудовольфович |      60 |
+-----+-------------+-----------+---------------+---------+
22 rows in set (0.08 sec)

mysql> DELETE FROM client
    -> WHERE TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) < 18 AND first_name = 'Роберт';
Query OK, 1 row affected (0.00 sec)

mysql> SELECT _id, last_name AS "Фамилия", first_name AS "Имя", second_name AS "Отчество",
    -> TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) AS Возраст FROM client ORDER BY Возраст;
+-----+-------------+-----------+---------------+---------+
| _id | Фамилия     | Имя       | Отчество      | Возраст |
+-----+-------------+-----------+---------------+---------+
|  22 | Ампилов     | Виктор    | Иванович      |      18 |
|  16 | Мединская   | Ирина     | Глебовна      |      20 |
|  10 | Чижиков     | Михаил    | Николаевич    |      22 |
|  25 | Фролова     | Анна      | Тарасовна     |      26 |
|  29 | Романов     | Александр | Павлович      |      27 |
|  24 | Матвиенко   | Александр | Александрович |      28 |
|   7 | Ян          | Мария     | Григорьевна   |      29 |
|  28 | Просов      | Владимир  | Тимофеевич    |      33 |
|  18 | Соколов     | Михаил    | Иванович      |      35 |
|  12 | Лапина      | Марина    | Александровна |      36 |
|   3 | Иванов      | Александр | Иванович      |      39 |
|  13 | Красавин    | Вадим     | Анатольевич   |      39 |
|  21 | Фролов      | Александр | Павлович      |      44 |
|   2 | Сидоров     | Сидор     | Сидорович     |      49 |
|   4 | Суворова    | Галина    | Ивановна      |      49 |
|  11 | Капралова   | Светлана  | Борисовна     |      49 |
|  26 | Симонов     | Александр | Михайлович    |      49 |
|   6 | Решетникова | Анна      | Владимировна  |      50 |
|   5 | Петров      | Степан    | Викторович    |      58 |
|  27 | Северов     | Нестор    | Петрович      |      59 |
|  15 | Соловьев    | Владимир  | Рудовольфович |      60 |
+-----+-------------+-----------+---------------+---------+
21 rows in set (0.00 sec)

```
</details>

## Работа 19.O. «Резервное копирование и восстановление данных через клиентскую консоль MySQL и через MySQL Workbench»

### 1 Цель работы
- изучить методы резервного копирования и восстановления БД;
- выполнить резервное копирование и восстановление БД с помощью утилиты mysqldump;
- выполнить резервное копирование и восстановление БД с помощью программы MySQL Workbench.

### 2	Условия задач
Выполнить резервное копирование данных в соответствии со своим вариантом (2 – Гостиница).

I. Резервное копирование и восстановление БД с помощью утилиты mysqldump.
1) Создать резервную копию БД.
2) Создать резервную копию одной таблицы.
3) Создать резервную копию нескольких таблиц БД.
4) Создать резервную копию и выполнить ее архивирование.
5) Создать резервную копию с ограничением where.
6) Резервировать права доступа на БД.
7) Восстановить базу данных из резервной копии.

II. Резервное копирование и восстановление БД с помощью программы MySQLWorckbench
1) Создать резервную копию БД.
2) Восстановить БД из резервной копии.

### 3.1 Резервное копирование и восстановление БД с помощью утилиты mysqldump

#### 3.1.1 Задача 1

```sql
mysqldump -u root hotel > c:\hotel_dump_data.sql

mysqldump --no-data -u root hotel > c:\hotel_dump.sql
```

#### 3.1.2 Задача 2

```sql
mysqldump -u root hotel client > c:\hotel_dump_client_tbl.sql
```


```
# mysql -u root
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 34
Server version: 8.0.30 MySQL Community Server - GPL

Copyright (c) 2000, 2022, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> CREATE DATABASE hotel_copy;
Query OK, 1 row affected (0.00 sec)

mysql> exit
Bye

# mysql -uroot hotel_copy < c:\hotel_dump_data.sql

# mysql -uroot
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 34
Server version: 8.0.30 MySQL Community Server - GPL

Copyright (c) 2000, 2022, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> use hotel_copy
Database changed
mysql> show tables;
+----------------------+
| Tables_in_hotel_copy |
+----------------------+
| checkin              |
| client               |
| client_discount      |
| comfort              |
| discount             |
| phone                |
| reservation          |
| room                 |
+----------------------+
8 rows in set (0.00 sec)
```

## Работа 20.O. «Создание учетных записей пользователей»

### 1	Цель работы
- изучить способы контроля доступа к данным и управления привилегиями;
- научиться обеспечивать информационную безопасность на уровне базы данных.

### 2	Условия задач
Создать пользователей БД в соответствии со своим вариантом (2 – Гостиница).
1) Создать несколько пользователей.
2) Создать пользователей с удаленным доступом.
3) Просмотреть список пользователей.
4) Удалить созданных пользователей.

### 3	Решение задач

```sql
DROP USER 'user1'@'localhost';
```

#### 3.1 Создание списка пользователей

```sql
CREATE USER 'user1'@'localhost'
  IDENTIFIED BY 'u123456';

CREATE USER 'user2'@'localhost'
  IDENTIFIED BY 'u234567';

CREATE USER 'user3'@'localhost'
  IDENTIFIED BY 'u345678';
```

```
mysql> CREATE USER 'user1'@'localhost' IDENTIFIED BY 'u123456';
Query OK, 0 rows affected (0.00 sec)

mysql> CREATE USER 'user2'@'localhost' IDENTIFIED BY 'u234567';
Query OK, 0 rows affected (0.00 sec)

mysql> CREATE USER 'user3'@'localhost' IDENTIFIED BY 'u345678';
Query OK, 0 rows affected (0.00 sec)

```

#### 3.2 Создание списка пользователей

```sql
CREATE USER 'remote_user1'@'%'
  IDENTIFIED BY 'u123456';

CREATE USER 'remote_user2'@'%.domain.com'
  IDENTIFIED BY 'u234567';

CREATE USER 'remote_user3'@'%.123.123.123'
  IDENTIFIED BY 'u345678';
```


```
mysql> CREATE USER 'remote_user1'@'%' IDENTIFIED BY 'u123456';
Query OK, 0 rows affected (0.00 sec)

mysql> CREATE USER 'remote_user2'@'%.domain.com' IDENTIFIED BY 'u234567';
Query OK, 0 rows affected (0.00 sec)

mysql> CREATE USER 'remote_user3'@'%.123.123.123' IDENTIFIED BY 'u345678';
Query OK, 0 rows affected (0.00 sec)

```

#### 3.3 Просмотреть список пользователей

```sql
-- MySQL < 5.7.0
SELECT user, host, password FROM mysql.user;

-- MySQL >= 5.7.0
SELECT user, host, authentication_string FROM mysql.user;
```


```
mysql> SELECT user, host, password FROM mysql.user;
ERROR 1054 (42S22): Unknown column 'password' in 'field list'
mysql> SELECT version();
+-----------+
| version() |
+-----------+
| 8.0.30    |
+-----------+
1 row in set (0.00 sec)

mysql> SELECT user, host, authentication_string FROM mysql.user;
+------------------+---------------+------------------------------------------------------------------------+
| user             | host          | authentication_string                                                  |
+------------------+---------------+------------------------------------------------------------------------+
| mysql.infoschema | %             | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| mysql.session    | %             | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| mysql.sys        | %             | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| remote_user1     | %             | *0B1F9CB415CD9BE16C125389771B0E4C00AFFBFC                              |
| root             | %             |                                                                        |
| remote_user3     | %.123.123.123 | *864A35F36DC83D1F79FC5D257DA4D71ACC70CF57                              |
| remote_user2     | %.domain.com  | *349822B25915514E64CC1CBDCF0EF51F99F520AA                              |
| user1            | localhost     | *0B1F9CB415CD9BE16C125389771B0E4C00AFFBFC                              |
| user2            | localhost     | *349822B25915514E64CC1CBDCF0EF51F99F520AA                              |
| user3            | localhost     | *864A35F36DC83D1F79FC5D257DA4D71ACC70CF57                              |
+------------------+---------------+------------------------------------------------------------------------+
10 rows in set (0.08 sec)

```

#### 3.4 Удалить созданных пользователей

```sql
DROP USER 'user1'@'localhost';

DROP USER 'user2'@'localhost';

DROP USER 'user3'@'localhost';

DROP USER 'remote_user1'@'%';

DROP USER 'remote_user2'@'%.domain.com';

DROP USER 'remote_user3'@'%.123.123.123';
```

```
mysql> DROP USER 'user1'@'localhost';
Query OK, 0 rows affected (0.00 sec)

mysql> DROP USER 'user2'@'localhost';
Query OK, 0 rows affected (0.00 sec)

mysql> DROP USER 'user3'@'localhost';
Query OK, 0 rows affected (0.00 sec)

mysql> DROP USER 'remote_user1'@'%';
Query OK, 0 rows affected (0.00 sec)

mysql> DROP USER 'remote_user2'@'%.domain.com';
Query OK, 0 rows affected (0.00 sec)

mysql> DROP USER 'remote_user3'@'%.123.123.123';
Query OK, 0 rows affected (0.00 sec)

mysql> SELECT user, host, authentication_string FROM mysql.user;
+------------------+------+------------------------------------------------------------------------+
| user             | host | authentication_string                                                  |
+------------------+------+------------------------------------------------------------------------+
| mysql.infoschema | %    | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| mysql.session    | %    | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| mysql.sys        | %    | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| root             | %    |                                                                        |
+------------------+------+------------------------------------------------------------------------+
4 rows in set (0.00 sec)
```

## Работа 21.O. «Реализация доступа пользователей к базе данных»

### 3.1 Задача 1
Проверить отсутствие пользователя @localhost на сервере.

```sql
SELECT EXISTS(SELECT 0 FROM mysql.user WHERE host = 'localhost');

SELECT EXISTS(SELECT 1 FROM mysql.user WHERE host = 'localhost');
```

```
mysql> SELECT EXISTS(SELECT 1 FROM mysql.user WHERE host = 'localhost');
+------------------------------------------------------------+
| EXISTS(SELECT 1 FROM mysql.user WHERE host = '@localhost') |
+------------------------------------------------------------+
|                                                          0 |
+------------------------------------------------------------+
1 row in set (0.00 sec)
```

### 3.2 Задача 2
Создать учетные записи для пользователей, заходящих с любого компьютера локальной сети, со следующими привилегиями:
- пользователь US1 (пароль uzaba) получает привилегии на добавление, редактирование, удаление всех полей таблиц; получает привилегии чтения всех таблиц баз данных db_utf8, db_cp1251;
- пользователь read (пароль readb) получает привилегии чтения всех таблиц баз данных;
- пользователь sman (пароль sales) получает привилегии на добавление, редактирование, удаление всех полей одной из таблиц; получает привилегии чтения всех таблиц базы данных.

```sql
CREATE USER 'US1'@'localhost' IDENTIFIED BY 'uzaba';
GRANT INSERT, UPDATE, DELETE ON hotel.* TO 'US1'@'localhost';
GRANT SELECT ON *.* TO 'US1'@'localhost';

CREATE USER 'read'@'localhost' IDENTIFIED BY 'readb';
GRANT SELECT ON *.* TO 'read'@'localhost';

CREATE USER 'sman'@'localhost' IDENTIFIED BY 'sales';
GRANT INSERT, UPDATE, DELETE ON hotel.client TO 'sman'@'localhost';
GRANT SELECT ON hotel.* TO 'sman'@'localhost';

FLUSH PRIVILEGES;
```

```
mysql> CREATE USER 'US1'@'localhost' IDENTIFIED BY 'uzaba';
Query OK, 0 rows affected (0.00 sec)

mysql> GRANT INSERT, UPDATE, DELETE ON hotel.* TO 'US1'@'localhost';
Query OK, 0 rows affected (0.00 sec)

mysql> GRANT SELECT ON *.* TO 'US1'@'localhost';
Query OK, 0 rows affected (0.00 sec)

mysql> CREATE USER 'read'@'localhost' IDENTIFIED BY 'readb';
Query OK, 0 rows affected (0.00 sec)

mysql> GRANT SELECT ON *.* TO 'read'@'localhost';
Query OK, 0 rows affected (0.00 sec)

mysql> CREATE USER 'sman'@'localhost' IDENTIFIED BY 'sales';
Query OK, 0 rows affected (0.00 sec)

mysql> GRANT SELECT ON hotel.* TO 'sman'@'localhost';
Query OK, 0 rows affected (0.00 sec)

mysql> GRANT INSERT, UPDATE, DELETE ON hotel.client TO 'sman'@'localhost';
Query OK, 0 rows affected (0.00 sec)

mysql> FLUSH PRIVILEGES;
Query OK, 0 rows affected (0.00 sec)
```

### 3.3 Задача 3
Получить всю информацию из таблиц, связанную с этими новыми пользователями, написав соответствующие запросы.

```sql
SELECT user, host, authentication_string FROM mysql.user;

SHOW GRANTS FOR 'US1'@'localhost';
SHOW GRANTS FOR 'read'@'localhost';
SHOW GRANTS FOR 'sman'@'localhost';

```

```
mysql> SELECT user, host, authentication_string FROM mysql.user;
+------------------+-----------+------------------------------------------------------------------------+
| user             | host      | authentication_string                                                  |
+------------------+-----------+------------------------------------------------------------------------+
| mysql.infoschema | %         | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| mysql.session    | %         | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| mysql.sys        | %         | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| root             | %         |                                                                        |
| US1              | localhost | *D9E02AD8535F40A7D8461D9CF9F21F20A9BB4C75                              |
| read             | localhost | *FFB84EDFCA632F49FCC914F2013E5A7742C0A989                              |
| sman             | localhost | *BEB047C6F77288C14C1A84817187B82F5003531E                              |
+------------------+-----------+------------------------------------------------------------------------+
7 rows in set (0.00 sec)

mysql> SHOW GRANTS FOR 'US1'@'localhost';
+-----------------------------------------------------------------------+
| Grants for US1@localhost                                              |
+-----------------------------------------------------------------------+
| GRANT SELECT ON *.* TO `US1`@`localhost`                              |
| GRANT INSERT, UPDATE, DELETE ON `hotel`.* TO `US1`@`localhost`        |
+-----------------------------------------------------------------------+
4 rows in set (0.00 sec)

mysql> SHOW GRANTS FOR 'read'@'localhost';
+-------------------------------------------+
| Grants for read@localhost                 |
+-------------------------------------------+
| GRANT SELECT ON *.* TO `read`@`localhost` |
+-------------------------------------------+
1 row in set (0.00 sec)

mysql> SHOW GRANTS FOR 'sman'@'localhost';
+------------------------------------------------------------------------+
| Grants for sman@localhost                                              |
+------------------------------------------------------------------------+
| GRANT USAGE ON *.* TO `sman`@`localhost`                               |
| GRANT SELECT ON `hotel`.* TO `sman`@`localhost`                        |
| GRANT INSERT, UPDATE, DELETE ON `hotel`.`client` TO `sman`@`localhost` |
+------------------------------------------------------------------------+
3 rows in set (0.00 sec)
```

### 3.4 Задача 4
Проверить работоспособность созданных учетных записей, выполняя разрешенные и запрещенные действия для каждой учетной записи.

#### 3.4.1 US1/uzaba

```sql
mysql -u US1 -p

USE hotel_copy

INSERT INTO discount (category_name, value)
  VALUE('VIP', 0,5);

SELECT * FROM discount ORDER BY _id DESC LIMIT 1;

INSERT INTO client(last_name, first_name, second_name, sex, passport_number, birth_date, address)
  VALUE ('Захаров', 'Андрей', 'Иринеевич', 'm', '4939630358', '1986-03-11', 'г. Нефтеюганск, Юбилейная ул., д. 7 кв.64');

USE hotel

INSERT INTO discount (category_name, value)
  VALUE('VIP', 0.5);

UPDATE discount
  SET value = value - 0.1
  WHERE category_name = 'VIP';

SELECT * FROM discount ORDER BY _id DESC LIMIT 1;

DELETE FROM discount
  WHERE category_name = 'VIP';

INSERT INTO client(last_name, first_name, second_name, sex, passport_number, birth_date, address)
  VALUE ('Захаров', 'Андрей', 'Иринеевич', 'm', '4939630358', '1986-03-11', 'г. Нефтеюганск, Юбилейная ул., д. 7 кв.64');

SELECT
  CONCAT(last_name, ' ', first_name, ' ', second_name) AS "ФИО*",
  IF(sex = 'm', 'м', 'ж') AS Пол,
  CONCAT(SUBSTRING(passport_number, 1, 4), ' ', SUBSTRING(passport_number, 5)) AS "Номер паспорта",
  birth_date AS "Дата рождения",
  IF (LENGTH(address) > 20, CONCAT(SUBSTRING(address, 1, 30), '...'), address) AS "Адрес"
  FROM client ORDER BY _id DESC LIMIT 1;

UPDATE client SET last_name = "Новиков" WHERE last_name = "Захаров";

SELECT last_name FROM client ORDER BY _id DESC LIMIT 1;

DELETE FROM client WHERE last_name = "Новиков";

```

```
# mysql -u US1 -p
Enter password: *****
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 9
Server version: 8.0.30 MySQL Community Server - GPL

Copyright (c) 2000, 2022, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> USE hotel_copy
Database changed

mysql> INSERT INTO discount (category_name, value)   VALUE('VIP', 0,5);
ERROR 1142 (42000): INSERT command denied to user 'US1'@'localhost' for table 'discount'
mysql> SELECT * FROM discount ORDER BY _id DESC LIMIT 1;
+-----+---------------+-------+
| _id | category_name | value |
+-----+---------------+-------+
|   6 | Сотрудник     |  0.33 |
+-----+---------------+-------+
6 rows in set (0.09 sec)

mysql> INSERT INTO client(last_name, first_name, second_name, sex, passport_number, birth_date, address)
    -> VALUE ('Захаров', 'Андрей', 'Иринеевич', 'm', '4939630358', '1986-03-11', 'г. Нефтеюганск, Юбилейная ул., д. 7 кв.64');
ERROR 1142 (42000): INSERT command denied to user 'US1'@'localhost' for table 'client'
mysql> USE hotel
Database changed
mysql> INSERT INTO discount (category_name, value)   VALUE('VIP', 0.5);
Query OK, 1 row affected (0.00 sec)

mysql> UPDATE discount   SET value = value - 0.1   WHERE category_name = 'VIP';
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> SELECT * FROM discount ORDER BY _id DESC LIMIT 1;
+-----+---------------+-------+
| _id | category_name | value |
+-----+---------------+-------+
|   7 | VIP           |  0.40 |
+-----+---------------+-------+
1 row in set (0.00 sec)

mysql> DELETE FROM discount   WHERE category_name = 'VIP';
Query OK, 1 row affected (0.00 sec)

mysql> INSERT INTO client(last_name, first_name, second_name, sex, passport_number, birth_date, address)
    -> VALUE ('Захаров', 'Андрей', 'Иринеевич', 'm', '4939630358', '1986-03-11', 'г. Нефтеюганск, Юбилейная ул., д. 7 кв.64');
Query OK, 1 row affected (0.01 sec)

mysql> SELECT CONCAT(last_name, ' ', first_name, ' ', second_name) AS "ФИО*", IF(sex = 'm', 'м', 'ж') AS Пол,
    -> CONCAT(SUBSTRING(passport_number, 1, 4), ' ', SUBSTRING(passport_number, 5)) AS "Номер паспорта",
    -> birth_date AS "Дата рождения",
    -> IF (LENGTH(address) > 20, CONCAT(SUBSTRING(address, 1, 30), '...'), address) AS "Адрес"
    -> FROM client ORDER BY _id DESC LIMIT 1;
+--------------------------+-----+----------------+---------------+-----------------------------------+
| ФИО*                     | Пол | Номер паспорта | Дата рождения | Адрес                             |
+--------------------------+-----+----------------+---------------+-----------------------------------+
| Захаров Андрей Иринеевич | м   | 4939 630358    | 1986-03-11    | г. Нефтеюганск, Юбилейная ул.,... |
+--------------------------+-----+----------------+---------------+-----------------------------------+
1 row in set (0.00 sec)

mysql> DELETE FROM client WHERE last_name = "Новиков";
Query OK, 1 row affected (0.01 sec)
```

#### 3.4.2 read/readb

```sql
mysql -u read -p

USE hotel_copy

INSERT INTO discount (category_name, value)
  VALUE('VIP', 0,5);

UPDATE discount
  SET value = value - 0.1
  WHERE _id = 1;

DELETE
  FROM discount
  WHERE _id = 1;

SELECT * FROM discount;

USE hotel

SELECT * FROM room LIMIT 5;

INSERT INTO client(last_name, first_name, second_name, sex, passport_number, birth_date, address)
  VALUE ('Захаров', 'Андрей', 'Иринеевич', 'm', '4939630358', '1986-03-11', 'г. Нефтеюганск, Юбилейная ул., д. 7 кв.64');

UPDATE discount
  SET value = 0.5
  WHERE _id = 5;

DELETE
  FROM room
  WHERE _id = 1;

```

```
# mysql -u read -p
Enter password: *****
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 10
Server version: 8.0.30 MySQL Community Server - GPL

Copyright (c) 2000, 2022, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> USE hotel_copy
Database changed
mysql> INSERT INTO discount (category_name, value)   VALUE('VIP', 0,5);
ERROR 1142 (42000): INSERT command denied to user 'read'@'localhost' for table 'discount'
mysql> UPDATE discount   SET value = value - 0.1   WHERE _id = 1;
ERROR 1142 (42000): UPDATE command denied to user 'read'@'localhost' for table 'discount'
mysql> DELETE FROM discount   WHERE _id = 1;
ERROR 1142 (42000): DELETE command denied to user 'read'@'localhost' for table 'discount'
mysql> SELECT * FROM discount;
+-----+---------------+-------+
| _id | category_name | value |
+-----+---------------+-------+
|   1 | Герой труда   |  0.15 |
|   2 | Ликвидатор    |  0.10 |
|   3 | Постоянный    |  0.25 |
|   4 | Ветеран труда |  0.10 |
|   5 | Многодетный   |  0.05 |
|   6 | Сотрудник     |  0.33 |
+-----+---------------+-------+
6 rows in set (0.00 sec)

mysql> USE hotel
Database changed
mysql> SELECT * FROM room LIMIT 5;
+-----+--------+----------+---------+--------------+------------+
| _id | number | capacity | price   | phone_number | comfort_id |
+-----+--------+----------+---------+--------------+------------+
|   1 | 213    |        2 | 3392.50 | 512          |          1 |
|   2 | 303    |        2 | 4968.00 | 128          |          2 |
|   3 | 506    |        3 | 8970.00 | 032          |          3 |
|   4 | 225    |        1 | 2415.00 | 8            |          1 |
|   5 | 4      |        4 | 4600.00 | 202          |          1 |
+-----+--------+----------+---------+--------------+------------+
5 rows in set (0.01 sec)

mysql> INSERT INTO client(last_name, first_name, second_name, sex, passport_number, birth_date, address, comment)
    -> VALUE ('Захаров', 'Андрей', 'Иринеевич', 'm', '4939630358', '1986-03-11', 'г. Нефтеюганск, Юбилейная ул., д. 7 кв.64');
ERROR 1142 (42000): INSERT command denied to user 'read'@'localhost' for table 'client'
mysql> UPDATE discount SET value = 0.5 WHERE _id = 5;
ERROR 1142 (42000): UPDATE command denied to user 'read'@'localhost' for table 'discount'
mysql> DELETE FROM room WHERE _id = 1;
ERROR 1142 (42000): DELETE command denied to user 'read'@'localhost' for table 'room'
```

#### 3.4.3 sman/sales

```sql
mysql -u sman -p

USE hotel_copy

USE hotel

INSERT INTO discount (category_name, value)
  VALUE('VIP', 0,5);

UPDATE discount
  SET value = 0.5
  WHERE _id = 5;

DELETE
  FROM room
  WHERE _id = 1;

INSERT INTO client(last_name, first_name, second_name, sex, passport_number, birth_date, address)
  VALUE ('Захаров', 'Андрей', 'Иринеевич', 'm', '4939630358', '1986-03-11', 'г. Нефтеюганск, Юбилейная ул., д. 7 кв.64');

UPDATE client
  SET last_name = "Новиков"
  WHERE last_name = "Захаров";

SELECT last_name
  FROM client
  ORDER BY _id DESC
  LIMIT 1;

DELETE
  FROM client
  WHERE last_name = "Новиков";

```

```
# mysql -u sman -p
Enter password: *****
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 15
Server version: 8.0.30 MySQL Community Server - GPL

Copyright (c) 2000, 2022, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> USE hotel_copy
ERROR 1044 (42000): Access denied for user 'sman'@'localhost' to database 'hotel_copy'
mysql> USE hotel
Database changed
mysql> INSERT INTO discount (category_name, value)   VALUE('VIP', 0,5);
ERROR 1142 (42000): INSERT command denied to user 'sman'@'localhost' for table 'discount'
mysql> UPDATE discount   SET value = 0.5   WHERE _id = 5;
ERROR 1142 (42000): UPDATE command denied to user 'sman'@'localhost' for table 'discount'
mysql> DELETE   FROM room   WHERE _id = 1;
ERROR 1142 (42000): DELETE command denied to user 'sman'@'localhost' for table 'room'
mysql> INSERT INTO client(last_name, first_name, second_name, sex, passport_number, birth_date, address)
    -> VALUE ('Захаров', 'Андрей', 'Иринеевич', 'm', '4939630358', '1986-03-11', 'г. Нефтеюганск, Юбилейная ул., д. 7 кв.64');
Query OK, 1 row affected (0.01 sec)

mysql> UPDATE client SET last_name = "Новиков" WHERE last_name = "Захаров";
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> SELECT last_name FROM client ORDER BY _id DESC LIMIT 1;
+-----------+
| last_name |
+-----------+
| Новиков   |
+-----------+
1 row in set (0.00 sec)

mysql> DELETE FROM client WHERE last_name = "Новиков";
Query OK, 1 row affected (0.00 sec)
```

### 3.5 Задача 5
Отменить какие-либо привилегии пользователей.

```sql
REVOKE DELETE ON hotel.* FROM US1@localhost;

REVOKE SELECT ON *.* FROM 'read'@'localhost';

REVOKE UPDATE ON hotel.client FROM sman@localhost;

SHOW GRANTS FOR 'US1'@'localhost';
SHOW GRANTS FOR 'read'@'localhost';
SHOW GRANTS FOR 'sman'@'localhost';
```

```
mysql> SHOW GRANTS FOR 'US1'@'localhost';
+----------------------------------------------------------------+
| Grants for US1@localhost                                       |
+----------------------------------------------------------------+
| GRANT SELECT ON *.* TO `US1`@`localhost`                       |
| GRANT INSERT, UPDATE, DELETE ON `hotel`.* TO `US1`@`localhost` |
+----------------------------------------------------------------+
2 rows in set (0.00 sec)

mysql> REVOKE DELETE ON hotel.* FROM US1@localhost;
Query OK, 0 rows affected (0.00 sec)

mysql> SHOW GRANTS FOR 'US1'@'localhost';
+--------------------------------------------------------+
| Grants for US1@localhost                               |
+--------------------------------------------------------+
| GRANT SELECT ON *.* TO `US1`@`localhost`               |
| GRANT INSERT, UPDATE ON `hotel`.* TO `US1`@`localhost` |
+--------------------------------------------------------+
2 rows in set (0.00 sec)

mysql> REVOKE SELECT ON *.* FROM 'read'@'localhost';
Query OK, 0 rows affected (0.00 sec)

mysql> SHOW GRANTS FOR 'read'@'localhost';
+------------------------------------------+
| Grants for read@localhost                |
+------------------------------------------+
| GRANT USAGE ON *.* TO `read`@`localhost` |
+------------------------------------------+
1 row in set (0.00 sec)

mysql> REVOKE UPDATE ON hotel.client FROM sman@localhost;
Query OK, 0 rows affected (0.00 sec)

mysql> SHOW GRANTS FOR 'sman'@'localhost';
+----------------------------------------------------------------+
| Grants for sman@localhost                                      |
+----------------------------------------------------------------+
| GRANT USAGE ON *.* TO `sman`@`localhost`                       |
| GRANT SELECT ON `hotel`.* TO `sman`@`localhost`                |
| GRANT INSERT, DELETE ON `hotel`.`client` TO `sman`@`localhost` |
+----------------------------------------------------------------+
3 rows in set (0.00 sec)
```

### 3.6 Задача 6
Проверить работоспособность созданных учетных записей, выполняя разрешенные и запрещенные действия для каждой учетной записи.

#### 3.6.1 US1/uzaba

```sql
mysql -u US1 -p

USE hotel_copy

SELECT * FROM discount ORDER BY _id DESC LIMIT 1;

USE hotel

INSERT INTO discount (category_name, value)
  VALUE('VIP', 0.5);

UPDATE discount
  SET value = value - 0.1
  WHERE category_name = 'VIP';

SELECT * FROM discount ORDER BY _id DESC LIMIT 1;

DELETE FROM discount
  WHERE category_name = 'VIP';

UPDATE client
  SET comment = "Благословенный"
  WHERE last_name = "Романов";

SELECT comment
  FROM client
  WHERE last_name = "Романов";

```

```
# mysql -u US1 -p
Enter password: *****
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 17
Server version: 8.0.30 MySQL Community Server - GPL

Copyright (c) 2000, 2022, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> USE hotel_copy
Database changed
mysql> SELECT * FROM discount ORDER BY _id DESC LIMIT 1;
+-----+---------------+-------+
| _id | category_name | value |
+-----+---------------+-------+
|   6 | Сотрудник     |  0.33 |
+-----+---------------+-------+
1 row in set (0.00 sec)

mysql> USE hotel
Database changed
mysql> INSERT INTO discount (category_name, value)   VALUE('VIP', 0.5);
Query OK, 1 row affected (0.00 sec)

mysql> UPDATE discount   SET value = value - 0.1   WHERE category_name = 'VIP';
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> SELECT * FROM discount ORDER BY _id DESC LIMIT 1;
+-----+---------------+-------+
| _id | category_name | value |
+-----+---------------+-------+
|   8 | VIP           |  0.40 |
+-----+---------------+-------+
1 row in set (0.00 sec)

mysql> DELETE FROM discount   WHERE category_name = 'VIP';
ERROR 1142 (42000): DELETE command denied to user 'US1'@'localhost' for table 'discount'
mysql> UPDATE client SET comment = "Благословенный" WHERE last_name = "Романов";
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> SELECT comment FROM client WHERE last_name = "Романов";
+----------------+
| comment        |
+----------------+
| Благословенный |
+----------------+
1 row in set (0.00 sec)
```

#### 3.6.2 read/readb

```sql
mysql -u read -p

USE hotel_copy

USE hotel

```

```
# mysql -u read -p
Enter password: *****
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 18
Server version: 8.0.30 MySQL Community Server - GPL

Copyright (c) 2000, 2022, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> USE hotel_copy
ERROR 1044 (42000): Access denied for user 'read'@'localhost' to database 'hotel_copy'
mysql> USE hotel
ERROR 1044 (42000): Access denied for user 'read'@'localhost' to database 'hotel'
mysql>
```

#### 3.4.3 sman/sales

```sql
mysql -u sman -p

USE hotel

INSERT INTO client(last_name, first_name, second_name, sex, passport_number, birth_date, address)
  VALUE ('Захаров', 'Андрей', 'Иринеевич', 'm', '4939630358', '1986-03-11', 'г. Нефтеюганск, Юбилейная ул., д. 7 кв.64');

UPDATE client
  SET last_name = "Новиков"
  WHERE last_name = "Захаров";

SELECT last_name
  FROM client
  ORDER BY _id DESC
  LIMIT 1;

DELETE
  FROM client
  WHERE last_name = "Новиков";

```

```
# mysql -u sman -p
Enter password: *****
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 19
Server version: 8.0.30 MySQL Community Server - GPL

Copyright (c) 2000, 2022, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> USE hotel
Database changed
mysql> INSERT INTO client(last_name, first_name, second_name, sex, passport_number, birth_date, address)
    -> VALUE ('Захаров', 'Андрей', 'Иринеевич', 'm', '4939630358', '1986-03-11', 'г. Нефтеюганск, Юбилейная ул., д. 7 кв.64');
Query OK, 1 row affected (0.00 sec)

mysql> UPDATE client   SET last_name = "Новиков"   WHERE last_name = "Захаров";
ERROR 1142 (42000): UPDATE command denied to user 'sman'@'localhost' for table 'client'
mysql> SELECT last_name   FROM client   ORDER BY _id DESC   LIMIT 1;
+-----------+
| last_name |
+-----------+
| Захаров   |
+-----------+
1 row in set (0.00 sec)

mysql> DELETE   FROM client   WHERE last_name = "Новиков";
Query OK, 0 rows affected (0.00 sec)
```

## Работа 22.O «Создание представлений»

### 3.1 Задача 1
Вывести данные о номерах, в которых цена номера более 5000 и комфортность полулюкс.

```sql
CREATE VIEW room_suite AS SELECT
  room._id, number, capacity, price, phone_number, type_name
  FROM room JOIN comfort ON room.comfort_id = comfort._id
  WHERE price > 5000 AND type_name = "полулюкс"
;

SELECT
  number AS Номер,
  capacity AS Вместимость,
  price AS Цена,
  phone_number AS Телефон,
  type_name AS Комфортность
  FROM room_suite
;
```

<details>
<summary><b>Выполнение запроса</b></summary>

```
mysql> CREATE VIEW room_suite AS SELECT
    -> room._id, number, capacity, price, phone_number, type_name
    -> FROM room JOIN comfort ON room.comfort_id = comfort._id
    -> WHERE price > 5000 AND type_name = "полулюкс" ;
Query OK, 0 rows affected (0.00 sec)

mysql> SELECT   number AS Номер,   capacity AS Вместимость,   price AS Цена,
    -> phone_number AS Телефон,   type_name AS Комфортность
    -> FROM room_suite ;
+-------+-------------+---------+---------+--------------+
| Номер | Вместимость | Цена    | Телефон | Комфортность |
+-------+-------------+---------+---------+--------------+
| 11    |           4 | 8418.00 | 03      | полулюкс     |
| 5     |           5 | 5750.00 | 05      | полулюкс     |
+-------+-------------+---------+---------+--------------+
2 rows in set (0.00 sec)

```
</details>

### 3.2 Задача 2
Создать представление, в котором вывести данные о номерах, в которых количество человек в номере от 1 до 3, а цена менее 3500 руб.

```sql
CREATE VIEW room_capacity AS SELECT
  room._id, number, capacity, price, phone_number, type_name
  FROM room JOIN comfort ON room.comfort_id = comfort._id
  WHERE capacity BETWEEN 1 AND 3 && price < 3500
  ORDER BY price
;

SELECT
  number AS Номер,
  capacity AS Вместимость,
  price AS Цена,
  phone_number AS Телефон,
  type_name AS Комфортность
  FROM room_capacity
  ORDER BY price
;
```

<details>
<summary><b>Выполнение запроса</b></summary>

```
mysql> CREATE VIEW room_capacity AS SELECT
    -> room._id, number, capacity, price, phone_number, type_name
    -> FROM room JOIN comfort ON room.comfort_id = comfort._id
    -> WHERE capacity BETWEEN 1 AND 3 && price < 3500
    -> ORDER BY price ;
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql> SELECT number AS Номер, capacity AS Вместимость, price AS Цена,
    -> phone_number AS Телефон,   type_name AS Комфортность
    -> FROM room_capacity   ORDER BY price ;
+-------+-------------+---------+---------+--------------+
| Номер | Вместимость | Цена    | Телефон | Комфортность |
+-------+-------------+---------+---------+--------------+
| 128   |           2 | 1148.85 | 1       | обычный      |
| 12    |           1 | 1437.50 | 12      | обычный      |
| 7     |           1 | 1955.00 | 7       | обычный      |
| 20    |           2 | 2300.00 | 27      | полулюкс     |
| 225   |           1 | 2415.00 | 8       | обычный      |
| 202   |           1 | 2875.00 | 4       | обычный      |
| 23    |           2 | 2875.00 | 23      | полулюкс     |
| 213   |           2 | 3392.50 | 512     | обычный      |
| 101   |           1 | 3392.50 | 256     | обычный      |
| 65    |           3 | 3448.85 | 4096    | обычный      |
+-------+-------------+---------+---------+--------------+
10 rows in set (0.00 sec)
```
</details>

### 3.3 Задача 3
Создать представление, в котором вывести количество человек, которые освободили номера в каждом году. Показать количество, не превышающее 5 человек, а код номера 2 или 4.

```sql
CREATE VIEW checkin_year AS SELECT
  YEAR(leave_date) AS leave_year, COUNT(*) AS leave_count
  FROM checkin
  WHERE room_id IN (2, 4)
  GROUP BY leave_year
  HAVING leave_count <= 5
  ORDER BY leave_year DESC
;

SELECT
  leave_year AS Год,
  leave_count AS "Количество освободивших номер"
  FROM checkin_year
  ORDER BY leave_year
;

```

<details>
<summary><b>Выполнение запроса</b></summary>

```
mysql> CREATE VIEW checkin_year AS SELECT
    -> YEAR(leave_date) AS leave_year, COUNT(*) AS leave_count
    -> FROM checkin   WHERE room_id IN (2, 4)
    -> GROUP BY leave_year   HAVING leave_count <= 5
    -> ORDER BY leave_year DESC ;
Query OK, 0 rows affected (0.00 sec)

mysql> SELECT   leave_year AS Год,
    -> leave_count AS "Количество освободивших номер"
    -> FROM checkin_year   ORDER BY leave_year ;
+------+-------------------------------+
| Год  | Количество освободивших номер |
+------+-------------------------------+
| 2023 |                             2 |
| 2024 |                             1 |
+------+-------------------------------+
2 rows in set (0.00 sec)
```
</details>

### 3.4 Задача 4
Создать представление, в котором создать вычисляемое поле, которое определит клиентов старше 44 лет.

```sql
CREATE VIEW client_age AS SELECT
  _id, last_name, first_name, second_name, birth_date, passport_number,
  TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) AS age,
  (SELECT IF(age > 44, TRUE, FALSE)) AS is_mature
  FROM client
;

SELECT
  CONCAT(last_name, ' ', first_name, ' ', second_name) AS ФИО,
  CONCAT(SUBSTRING(passport_number, 1, 4), ' ', SUBSTRING(passport_number, 5)) AS "Паспорт (серия номер)",
  birth_date AS "Дата рождения",
  age AS "Возраст"
  FROM client_age
  WHERE is_mature = True
;
```

<details>
<summary><b>Выполнение запроса</b></summary>

```
mysql> CREATE VIEW client_age AS SELECT
    -> _id, last_name, first_name, second_name, birth_date, passport_number,
    -> TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) AS age,
    -> (SELECT IF(age > 44, TRUE, FALSE)) AS is_mature
    -> FROM client ;
Query OK, 0 rows affected (0.00 sec)

mysql> SELECT   CONCAT(last_name, ' ', first_name, ' ', second_name) AS ФИО,
    -> CONCAT(SUBSTRING(passport_number, 1, 4), ' ', SUBSTRING(passport_number, 5)) AS "Паспорт (серия номер)",
    -> birth_date AS "Дата рождения",   age AS "Возраст"
    -> FROM client_age   WHERE is_mature = True ;
+---------------------------------+-----------------------+---------------+---------+
| ФИО                             | Паспорт (серия номер) | Дата рождения | Возраст |
+---------------------------------+-----------------------+---------------+---------+
| Сидоров Сидор Сидорович         | 7863 523156           | 1975-03-08    |      49 |
| Суворова Галина Ивановна        | 9874 563215           | 1975-04-03    |      49 |
| Петров Степан Викторович        | 0786 534882           | 1965-08-21    |      59 |
| Решетникова Анна Владимировна   | 6798 563549           | 1973-08-09    |      51 |
| Капралова Светлана Борисовна    | 5428 965246           | 1975-04-19    |      49 |
| Соловьев Владимир Рудовольфович | 5679 546321           | 1963-10-20    |      61 |
| Фролов Александр Павлович       | 7892 697635           | 1979-08-03    |      45 |
| Симонов Александр Михайлович    | 4569 487532           | 1974-11-15    |      50 |
| Северов Нестор Петрович         | 7865 243896           | 1965-04-29    |      59 |
+---------------------------------+-----------------------+---------------+---------+
9 rows in set (0.00 sec)
```

</details>

### Задача 4
Создать представление, в котором вывести номер, количество человек в номере, комфортность «1 категории» и «2 категории», в которых цена от 3000 руб. до 5000 руб.

```sql
CREATE VIEW room_cat_price AS SELECT
  number, capacity, price, type_name, comfort_id AS category
  FROM room LEFT JOIN comfort ON comfort._id = room.comfort_id
  WHERE price BETWEEN 3000 AND 5000 && comfort_id IN (1, 2)
;

SELECT
  number AS "Номер",
  capacity AS "Количество человек",
  CASE
    WHEN category = 1 THEN '1 категория'
    WHEN category = 2 THEN '2 категория'
    END AS "Категория",
  type_name AS "Комфортность",
  price AS "Цена"
  FROM room_cat_price
;

```

<details>
<summary><b>Выполнение запроса</b></summary>

```
mysql> CREATE VIEW room_cat_price AS SELECT
    -> number, capacity, price, type_name, comfort_id AS category
    -> FROM room LEFT JOIN comfort ON comfort._id = room.comfort_id
    -> WHERE price BETWEEN 3000 AND 5000 && comfort_id IN (1, 2) ;
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql> SELECT   number AS "Номер",   capacity AS "Количество человек",
    -> CASE     WHEN category = 1 THEN '1 категория'
    -> WHEN category = 2 THEN '2 категория'     END AS "Категория",
    -> type_name AS "Комфортность", price AS "Цена"
    -> FROM room_cat_price ;
+-------+--------------------+-------------+--------------+---------+
| Номер | Количество человек | Категория   | Комфортность | Цена    |
+-------+--------------------+-------------+--------------+---------+
| 213   |                  2 | 1 категория | обычный      | 3392.50 |
| 303   |                  2 | 2 категория | полулюкс     | 4968.00 |
| 4     |                  4 | 1 категория | обычный      | 4600.00 |
| 123   |                  3 | 1 категория | обычный      | 3910.00 |
| 101   |                  1 | 1 категория | обычный      | 3392.50 |
| 754   |                  2 | 2 категория | полулюкс     | 3708.75 |
| 65    |                  3 | 1 категория | обычный      | 3448.85 |
| 78    |                  3 | 2 категория | полулюкс     | 3604.10 |
+-------+--------------------+-------------+--------------+---------+
8 rows in set (0.00 sec)
```
</details>

## Работа 23.O «Создание хранимых процедур»

### 3.1 Задача 1
Создать хранимую процедуру без параметров. Созданная процедура позволяет определить общее количество заселений в номера по годам.

```sql
DELIMITER //

CREATE PROCEDURE GetCheckinsByYear()
BEGIN
  SELECT
    YEAR(checkin.enter_date) AS Год,
    COUNT(*) AS Заселений
    FROM checkin
    GROUP BY Год
    ORDER BY Год;
END//

DELIMITER ;

CALL GetCheckinsByYear;
```

<details>
<summary><b>Выполнение запроса</b></summary>

```
mysql> DELIMITER //
mysql> CREATE PROCEDURE GetCheckinsByYear()
    -> BEGIN
    -> SELECT
    -> YEAR(checkin.enter_date) AS Год,
    -> COUNT(*) AS Заселений
    -> FROM checkin
    -> GROUP BY Год
    -> ORDER BY Год;
    -> END//
Query OK, 0 rows affected (0.01 sec)

mysql> DELIMITER ;
mysql> CALL GetCheckinsByYear;
+------+-----------+
| Год  | Заселений |
+------+-----------+
| 2018 |         2 |
| 2021 |         1 |
| 2022 |         1 |
| 2023 |         8 |
+------+-----------+
4 rows in set (0.00 sec)

Query OK, 0 rows affected (0.01 sec)
```

</details>

### 3.2 Задача 2
Создать хранимую процедуру с одним параметром типа IN. Использовать в теле процедуры условный оператор Case. Созданная процедура позволяет подобрать оптимальные по стоимости номера в зависимости от категории комфортности, задаваемой входным параметром. Если входной параметр равен 0, то процедура определяет номера с ценой меньше средней, если он больше 3, то определяются номера с ценой больше средней.

```sql
DELIMITER //

CREATE PROCEDURE GetOptimalNumbers(IN category INT UNSIGNED)
BEGIN
  CASE
    WHEN category = 0 THEN (SELECT room.number, price FROM room
      WHERE price < ALL(SELECT AVG(price) FROM room));
    WHEN category = 1 THEN (SELECT room.number, price FROM room
      WHERE comfort_id = category AND price BETWEEN 1500 AND 3000);
    WHEN category = 2 THEN (SELECT room.number, price FROM room
      WHERE comfort_id = category AND price BETWEEN 3000 AND 5000);
    WHEN category = 3 THEN (SELECT room.number, price FROM room
      WHERE comfort_id = category AND price BETWEEN 7000 AND 10000);
    ELSE SELECT room.number, price FROM room
      WHERE price > ALL(SELECT AVG(price) FROM room);
  END CASE;
END//

DELIMITER ;

CALL GetOptimalNumbers(0);
CALL GetOptimalNumbers(1);
CALL GetOptimalNumbers(2);
CALL GetOptimalNumbers(3);
CALL GetOptimalNumbers(9);

DROP PROCEDURE GetOptimalNumbers;
```

<details>
<summary><b>Выполнение запроса</b></summary>

```
mysql> DELIMITER //
mysql> CREATE PROCEDURE GetOptimalNumbers(IN category INT UNSIGNED)
    -> BEGIN   CASE
    -> WHEN category = 0 THEN (SELECT room.number, price FROM room WHERE price < ALL(SELECT AVG(price) FROM room));
    -> WHEN category = 1 THEN (SELECT room.number, price FROM room WHERE comfort_id = category AND price BETWEEN 1500 AND 3000);
    -> WHEN category = 2 THEN (SELECT room.number, price FROM room WHERE comfort_id = category AND price BETWEEN 3000 AND 5000);
    -> WHEN category = 3 THEN (SELECT room.number, price FROM room WHERE comfort_id = category AND price BETWEEN 7000 AND 10000);
    -> ELSE SELECT room.number, price FROM room WHERE price > ALL(SELECT AVG(price) FROM room);
    -> END CASE;
    -> END//
Query OK, 0 rows affected (0.00 sec)

mysql> DELIMITER ;
mysql> CALL GetOptimalNumbers(0);
+--------+---------+
| number | price   |
+--------+---------+
| 213    | 3392.50 |
| 225    | 2415.00 |
| 4      | 4600.00 |
| 202    | 2875.00 |
| 123    | 3910.00 |
| 101    | 3392.50 |
| 128    | 1148.85 |
| 754    | 3708.75 |
| 65     | 3448.85 |
| 12     | 1437.50 |
| 78     | 3604.10 |
| 23     | 2875.00 |
| 7      | 1955.00 |
| 20     | 2300.00 |
+--------+---------+
14 rows in set (0.00 sec)

Query OK, 0 rows affected (0.02 sec)

mysql> CALL GetOptimalNumbers(1);
+--------+---------+
| number | price   |
+--------+---------+
| 225    | 2415.00 |
| 202    | 2875.00 |
| 7      | 1955.00 |
+--------+---------+
3 rows in set (0.00 sec)

Query OK, 0 rows affected (0.01 sec)

mysql> CALL GetOptimalNumbers(2);
+--------+---------+
| number | price   |
+--------+---------+
| 303    | 4968.00 |
| 754    | 3708.75 |
| 78     | 3604.10 |
+--------+---------+
3 rows in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)

mysql> CALL GetOptimalNumbers(3);
+--------+---------+
| number | price   |
+--------+---------+
| 506    | 8970.00 |
+--------+---------+
1 row in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)

mysql> CALL GetOptimalNumbers(9);
+--------+----------+
| number | price    |
+--------+----------+
| 303    |  4968.00 |
| 506    |  8970.00 |
| 11     |  8418.00 |
| 5      |  5750.00 |
| 707    | 12167.00 |
| 555    | 10614.50 |
| 6      |  6900.00 |
| 45     |  5175.00 |
+--------+----------+
8 rows in set (0.00 sec)

Query OK, 0 rows affected (0.01 sec)
```

</details>


### 3.3 Задача 3
Создать хранимую процедуру c двумя параметрами типа IN и OUT. Использовать в теле процедуры цикл While. Создаваемая процедура позволит осуществить наиболее компактное распределение по номерам заданного входным параметром количества людей (подразумевается полное заселение номеров) и вывести суммарную стоимость необходимых для этого номеров в качестве выходного параметра.

```sql
DELIMITER //

CREATE PROCEDURE GetCompactPlacement(IN people INT UNSIGNED, OUT total_price DECIMAL(8, 2))
BEGIN
  DECLARE added VARCHAR(10);
  DROP TEMPORARY TABLE IF EXISTS placement;
  CREATE TEMPORARY TABLE placement AS SELECT * FROM room LIMIT 0;
  DROP TEMPORARY TABLE IF EXISTS rooms_free;
  CREATE TEMPORARY TABLE rooms_free AS SELECT * FROM room WHERE _id NOT IN (
    SELECT DISTINCT room_id FROM checkin
      WHERE checkin.enter_date < NOW() AND checkin.leave_date > NOW() UNION
    SELECT DISTINCT room_id FROM reservation
      WHERE reservation.enter_date < NOW() AND reservation.leave_date > NOW()
  ) ORDER BY capacity DESC;

  /* Fill in vacant rooms until guests are over */
  WHILE people > 0 DO
    SET added = (
      SELECT number FROM rooms_free WHERE capacity <= people
        AND number NOT IN (SELECT number FROM placement)
        LIMIT 1
    );
    INSERT INTO placement SELECT * FROM rooms_free WHERE number = added;
    SET people = people - (SELECT capacity FROM placement WHERE number = added);
  END WHILE;

  SELECT number AS Номер, capacity AS Вместимость, price AS Цена FROM placement;
  SELECT SUM(price) INTO total_price FROM placement;
END//

DELIMITER ;

CALL GetCompactPlacement(80, @price);
SELECT @price AS "Общая стоимость номеров";

CALL GetCompactPlacement(25, @price);
SELECT @price AS "Общая стоимость номеров";

CALL GetCompactPlacement(0, @price);
SELECT @price AS "Общая стоимость номеров";

DROP PROCEDURE GetCompactPlacement;

DELIMITER //

CREATE PROCEDURE GetRoomsByPeople(IN people INT UNSIGNED, OUT total_price DECIMAL(8, 2))
BEGIN
  DECLARE added VARCHAR(10);
  DROP TEMPORARY TABLE IF EXISTS rooms;
  CREATE TEMPORARY TABLE rooms AS SELECT * FROM room LIMIT 0;
  CREATE TEMPORARY TABLE room_cp AS SELECT * FROM room;
  WHILE people > 0 DO
    SET added = (
      SELECT number FROM room WHERE capacity <= people
        AND number NOT IN (SELECT number FROM rooms)
        ORDER BY capacity DESC LIMIT 1
    );
    INSERT INTO rooms SELECT * FROM room WHERE number = added;
    SET people = people - (SELECT capacity FROM rooms WHERE number = added);
  END WHILE;
  SELECT number AS Номер, capacity AS Вместимость, price AS Цена FROM rooms;
  SELECT SUM(price) INTO total_price FROM rooms;
END//

DELIMITER ;

CALL GetRoomsByPeople(15, @price);
SELECT @price AS "Общая цена номеров";

CALL GetRoomsByPeople(4, @price);
SELECT @price AS "Общая цена номеров";

CALL GetRoomsByPeople(0, @price);
SELECT @price AS "Общая цена номеров";

DROP PROCEDURE GetRoomsByCapacity;
```

<details>
<summary><b>Temporary requests</b></summary>

```sql
DELIMITER //

CREATE PROCEDURE WhileProc()
BEGIN
  DECLARE i INT UNSIGNED DEFAULT 3;
  CREATE TEMPORARY TABLE rooms(number VARCHAR(10));
  WHILE i > 0 DO
    INSERT INTO rooms SELECT room.number FROM room WHERE capacity = i;
    SET i=i-1;
  END WHILE;
  SELECT * FROM rooms;
  DROP TABLE rooms;
END//

DELIMITER ;
CALL WhileProc;
DROP PROCEDURE WhileProc;

DELIMITER //

CREATE PROCEDURE WhileProc0()
BEGIN
  DECLARE i INT UNSIGNED DEFAULT 15;
  DROP TABLE IF EXISTS rooms;
  CREATE TABLE rooms AS SELECT * FROM room LIMIT 0;
  WHILE i > 0 DO
    INSERT INTO rooms
      SELECT * FROM room WHERE capacity <= i
        AND number NOT IN (SELECT number FROM rooms)
        ORDER BY capacity DESC LIMIT 1;
    SET i=i-1;
  END WHILE;
  SELECT * FROM rooms;
END//

DELIMITER ;
CALL WhileProc0;
DROP PROCEDURE WhileProc0;

DELIMITER //

CREATE PROCEDURE WhileProc1()
BEGIN
  DECLARE i INT UNSIGNED DEFAULT 15;
  DECLARE added VARCHAR(10);
  DROP TABLE IF EXISTS rooms;
  CREATE TABLE rooms AS SELECT * FROM room LIMIT 0;
  WHILE i > 0 DO
    SET added = (
      SELECT number FROM room WHERE capacity <= i
        AND number NOT IN (SELECT number FROM rooms)
        ORDER BY capacity DESC LIMIT 1
    );
    INSERT INTO rooms SELECT * FROM room WHERE number = added;
    SET i = i - (SELECT capacity FROM rooms WHERE number = added);
  END WHILE;
  SELECT * FROM rooms;
END//

DELIMITER ;
CALL WhileProc1;
DROP PROCEDURE WhileProc1;

SELECT * FROM room WHERE number NOT IN (SELECT * FROM rooms);
-- doesn't work: SELECT number FROM room WHERE NOT EXISTS (SELECT * FROM rooms);

DELIMITER //

CREATE PROCEDURE WhileProc1()
BEGIN
  DECLARE i INT UNSIGNED DEFAULT 3;
  DROP TABLE IF EXISTS rooms;
  CREATE TABLE rooms2 AS SELECT * FROM room;
  WHILE i > 0 DO
    INSERT INTO rooms
      SELECT room.number FROM room WHERE capacity <= i
        AND NOT EXISTS(SELECT * FROM rooms) ORDER BY capacity DESC LIMIT 1;
    SET i=i-1;
  END WHILE;
  SELECT * FROM rooms;
END//

DELIMITER ;
CALL WhileProc0;
DROP PROCEDURE WhileProc0;



SELECT number FROM room WHERE NOT EXISTS (SELECT number FROM rooms);
SELECT room.number FROM room WHERE NOT EXISTS(SELECT number FROM room);
SELECT room.number FROM room WHERE room.number NOT IN(506);

SELECT _id FROM room WHERE NOT EXISTS(SELECT _id FROM rooms);

SELECT id FROM product WHERE NOT EXISTS
(SELECT DISTINCT product_id FROM sale);

SELECT room.number FROM room WHERE capacity <= i AND NOT EXISTS(SELECT * FROM rooms) ORDER BY capacity DESC LIMIT 1;

-- CREATE TEMPORARY TABLE rooms SELECT * FROM room LIMIT 0;
-- DROP TEMPORARY TABLE IF EXISTS rooms;

CALL GetOptimalNumbers(0);
CALL GetOptimalNumbers(1);
CALL GetOptimalNumbers(2);
CALL GetOptimalNumbers(3);
CALL GetOptimalNumbers(9);

DROP PROCEDURE GetOptimalNumbers;
```

</details>

<details>
<summary><b>Выполнение запроса</b></summary>

```
mysql> DELIMITER //
mysql> CREATE PROCEDURE GetCompactPlacement(IN people INT UNSIGNED, OUT total_price DECIMAL(8, 2))
    -> BEGIN   DECLARE added VARCHAR(10);
    -> DROP TEMPORARY TABLE IF EXISTS placement;
    -> CREATE TEMPORARY TABLE placement AS SELECT * FROM room LIMIT 0;
    -> DROP TEMPORARY TABLE IF EXISTS rooms_free;
    -> CREATE TEMPORARY TABLE rooms_free AS SELECT * FROM room WHERE _id NOT IN (
    -> SELECT DISTINCT room_id FROM checkin WHERE checkin.enter_date < NOW() AND checkin.leave_date > NOW() UNION
    -> SELECT DISTINCT room_id FROM reservation WHERE reservation.enter_date < NOW() AND reservation.leave_date > NOW()
    -> ) ORDER BY capacity DESC;
    -> WHILE people > 0 DO
    -> SET added = (SELECT number FROM rooms_free WHERE capacity <= people
    -> AND number NOT IN (SELECT number FROM placement) LIMIT 1     );
    -> INSERT INTO placement SELECT * FROM rooms_free WHERE number = added;
    -> SET people = people - (SELECT capacity FROM placement WHERE number = added);   END WHILE;
    -> SELECT number AS Номер, capacity AS Вместимость, price AS Цена FROM placement;
    -> SELECT SUM(price) INTO total_price FROM placement;
    -> END//
Query OK, 0 rows affected (0.00 sec)

mysql> DELIMITER ;
mysql> CALL GetCompactPlacement(80, @price);
+-------+-------------+----------+
| Номер | Вместимость | Цена     |
+-------+-------------+----------+
| 6     |           6 |  6900.00 |
| 5     |           5 |  5750.00 |
| 707   |           5 | 12167.00 |
| 4     |           4 |  4600.00 |
| 11    |           4 |  8418.00 |
| 555   |           4 | 10614.50 |
| 45    |           4 |  5175.00 |
| 506   |           3 |  8970.00 |
| 123   |           3 |  3910.00 |
| 65    |           3 |  3448.85 |
| 78    |           3 |  3604.10 |
| 213   |           2 |  3392.50 |
| 303   |           2 |  4968.00 |
| 128   |           2 |  1148.85 |
| 754   |           2 |  3708.75 |
| 23    |           2 |  2875.00 |
| 20    |           2 |  2300.00 |
| 225   |           1 |  2415.00 |
| 202   |           1 |  2875.00 |
| 101   |           1 |  3392.50 |
| 12    |           1 |  1437.50 |
| 7     |           1 |  1955.00 |
+-------+-------------+----------+
22 rows in set (0.01 sec)

Query OK, 1 row affected (0.06 sec)

mysql> SELECT @price AS "Общая стоимость номеров";
+-------------------------+
| Общая стоимость номеров |
+-------------------------+
|               104025.55 |
+-------------------------+
1 row in set (0.00 sec)

mysql> CALL GetCompactPlacement(25, @price);
+-------+-------------+----------+
| Номер | Вместимость | Цена     |
+-------+-------------+----------+
| 6     |           6 |  6900.00 |
| 5     |           5 |  5750.00 |
| 707   |           5 | 12167.00 |
| 4     |           4 |  4600.00 |
| 11    |           4 |  8418.00 |
| 225   |           1 |  2415.00 |
+-------+-------------+----------+
6 rows in set (0.00 sec)

Query OK, 1 row affected (0.02 sec)

mysql> SELECT @price AS "Общая стоимость номеров";
+-------------------------+
| Общая стоимость номеров |
+-------------------------+
|                40250.00 |
+-------------------------+
1 row in set (0.00 sec)

mysql> CALL GetCompactPlacement(0, @price);
Empty set (0.00 sec)

Query OK, 1 row affected (0.00 sec)

mysql> SELECT @price AS "Общая стоимость номеров";
+-------------------------+
| Общая стоимость номеров |
+-------------------------+
|                    NULL |
+-------------------------+
1 row in set (0.00 sec)

```

</details>


### 3.4 Задача 4
Создать хранимую процедуру с параметром типа INOUT и INT. Использовать в теле процедуры цикл Repeat. Создаваемая процедура позволит осуществить наиболее экономичное распределение по номерам заданного параметром числа постояльцев (при этом возможно неполное заселение номеров) и вывести тем же параметром количество людей, оставшихся нерасселёнными (если мест в свободных номерах не хватает для всех постояльцев).

```sql
DELIMITER //

CREATE PROCEDURE GetSavingPlacement(INOUT people INT)
BEGIN
  DECLARE i INT DEFAULT 0;
  DECLARE room_id INT;
  DECLARE room_price DECIMAL(8, 2);
  DECLARE room_capacity INT;
  DECLARE rooms_count INT;
  DROP TEMPORARY TABLE IF EXISTS prices;
  CREATE TEMPORARY TABLE prices (
    _id INT,
    capacity INT,
    price_per_capita DECIMAL(8, 2)
  );
  DROP TEMPORARY TABLE IF EXISTS placement;
  CREATE TEMPORARY TABLE placement AS SELECT * FROM room LIMIT 0;
  DROP TEMPORARY TABLE IF EXISTS vacant;
  CREATE TEMPORARY TABLE vacant AS SELECT * FROM room WHERE _id NOT IN (
    SELECT DISTINCT room_id FROM checkin
      WHERE checkin.enter_date < NOW() AND checkin.leave_date > NOW() UNION
    SELECT DISTINCT room_id FROM reservation
      WHERE reservation.enter_date < NOW() AND reservation.leave_date > NOW()
  );
  SET rooms_count = (SELECT COUNT(*) FROM vacant);

  /* Getting room capacities per guest */
  REPEAT
    SET i = i + 1;
    SET room_id = (SELECT _id FROM vacant LIMIT 1);
    IF i = room_id THEN
      SET room_price = (SELECT price FROM room WHERE _id = i);
      SET room_capacity = (SELECT capacity FROM room WHERE _id = i);
      INSERT INTO prices(_id, capacity, price_per_capita)
        VALUE(i, room_capacity, room_price / room_capacity);
      DELETE FROM vacant WHERE _id = room_id;
    END IF;
  UNTIL i >= rooms_count
  END REPEAT;

  /* Fill in vacant rooms until guests or vacancies are over */
  SET i = rooms_count;
  WHILE people > 0 AND i > 0 DO
    SET people = people -
      IFNULL((SELECT capacity FROM prices ORDER BY price_per_capita LIMIT 1), 0);
    IF people < 0 THEN SET people = 0;
    END IF;
    SET i = i - 1;
    INSERT INTO placement SELECT * FROM room WHERE
      _id = (SELECT _id FROM prices ORDER BY price_per_capita LIMIT 1);
    DELETE FROM prices ORDER BY price_per_capita LIMIT 1;
  END WHILE;

  SELECT * FROM placement;

END//

DELIMITER ;

SET @guests = 80;
CALL GetSavingPlacement(@guests);
SELECT @guests AS "Не расселено человек";
DROP PROCEDURE GetSavingPlacement;

DELIMITER //

DELIMITER //

CREATE PROCEDURE GetSavingPlacement(INOUT people INT)
BEGIN
  DECLARE i INT DEFAULT 0;
  DECLARE room_id INT;
  DECLARE room_price DECIMAL(8, 2);
  DECLARE room_capacity INT;
  DECLARE rooms_count INT;
  DROP TEMPORARY TABLE IF EXISTS prices;
  CREATE TEMPORARY TABLE prices (
    _id INT,
    capacity INT,
    price_per_capita DECIMAL(8, 2)
  );
  DROP TEMPORARY TABLE IF EXISTS placement;
  CREATE TEMPORARY TABLE placement AS SELECT * FROM room LIMIT 0;
  DROP TEMPORARY TABLE IF EXISTS vacant;
  CREATE TEMPORARY TABLE vacant AS SELECT * FROM room WHERE _id NOT IN (
    SELECT DISTINCT room_id FROM checkin
      WHERE checkin.enter_date < NOW() AND checkin.leave_date > NOW() UNION
    SELECT DISTINCT room_id FROM reservation
      WHERE reservation.enter_date < NOW() AND reservation.leave_date > NOW()
  );
  SET rooms_count = (SELECT COUNT(*) FROM vacant);

  /* Getting room capacities per guest */
  REPEAT
    SET i = i + 1;
    SET room_id = (SELECT _id FROM vacant LIMIT 1);
    IF i = room_id THEN
      SET room_price = (SELECT price FROM room WHERE _id = i);
      SET room_capacity = (SELECT capacity FROM room WHERE _id = i);
      INSERT INTO prices(_id, capacity, price_per_capita)
        VALUE(i, room_capacity, room_price / room_capacity);
      DELETE FROM vacant WHERE _id = room_id;
    END IF;
  UNTIL i >= rooms_count
  END REPEAT;

  /* Fill in vacant rooms until guests or vacancies are over */
  SET i = 0;
  REPEAT
    SET people = people - 
      IFNULL((SELECT capacity FROM prices ORDER BY price_per_capita LIMIT 1), 0);
    IF people < 0 THEN SET people = 0;
    END IF;    
    SET i = i + 1;
    INSERT INTO placement SELECT * FROM room WHERE 
      _id = (SELECT _id FROM prices ORDER BY price_per_capita LIMIT 1);
    DELETE FROM prices ORDER BY price_per_capita LIMIT 1;
  UNTIL people = 0 OR i > rooms_count
  END REPEAT;

  SELECT * FROM placement;

END//

DELIMITER ;

CREATE PROCEDURE GetRooms(INOUT qty INT)
BEGIN
  DECLARE i INT DEFAULT 0;
  DECLARE room_id INT;
  DECLARE room_price DECIMAL(8, 2);
  DECLARE room_capacity INT;
  DECLARE people INT DEFAULT qty;
  DECLARE rooms_count INT;
  DROP TEMPORARY TABLE IF EXISTS rooms_cap;
  CREATE TEMPORARY TABLE rooms_cap (
    _id INT,
    capacity INT,
    price_per_capita DECIMAL(8, 2)
  );
  DROP TEMPORARY TABLE IF EXISTS placement;
  CREATE TEMPORARY TABLE placement AS SELECT * FROM room LIMIT 0;
  DROP TEMPORARY TABLE IF EXISTS rooms_free;
  CREATE TEMPORARY TABLE rooms_free AS SELECT * FROM room WHERE _id NOT IN (
  SELECT DISTINCT room_id FROM checkin LEFT JOIN reservation USING(room_id)
    WHERE checkin.leave_date > NOW() AND reservation.leave_date > NOW()
  ) ORDER BY _id;
  SET rooms_count = (SELECT COUNT(*) FROM room);

  REPEAT
    SET i = i + 1;
    SET room_id = (SELECT _id FROM rooms_free LIMIT 1);
    SELECT room_id;
    IF i = room_id THEN
      SET room_price = (SELECT price FROM room WHERE _id = i);
      SET room_capacity = (SELECT capacity FROM room WHERE _id = i);
      INSERT INTO rooms_cap(_id, capacity, price_per_capita)
        VALUE(i, room_capacity, room_price / room_capacity);
      DELETE FROM rooms_free WHERE _id = room_id;
    END IF;
  UNTIL i >= rooms_count
  END REPEAT;

  SET i = 0, qty = 0;
  REPEAT
    SET @c = (SELECT capacity FROM rooms_cap LIMIT 1);
    SET people = people - @c;
    SET i = i + 1;
    IF people < 0 THEN
      SET people = people + @c;
    ELSE SET qty = qty + 1;
      INSERT INTO placement SELECT * FROM room WHERE
        _id = (SELECT _id FROM rooms_cap LIMIT 1);
    END IF;
    DELETE FROM rooms_cap LIMIT 1;
  UNTIL people <= 0 OR i > rooms_count
  END REPEAT;

  SELECT * FROM placement;

END//

DELIMITER ;

SELECT * FROM room WHERE _id NOT IN (
  SELECT DISTINCT room_id FROM checkin LEFT JOIN reservation USING(room_id) 
    WHERE checkin.leave_date > NOW() AND reservation.leave_date > NOW()
  ) ORDER BY _id;
      
SET @quantity = 15;
CALL GetRooms(@quantity);
SELECT @quantity AS "Количество номеров";
DROP PROCEDURE GetRooms;
```

```sql
CREATE PROCEDURE GetRooms(INOUT qty INT)
BEGIN
  DECLARE i INT DEFAULT 0;
  DECLARE room_price DECIMAL(8, 2);
  DECLARE room_capacity INT UNSIGNED;
  DECLARE people INT DEFAULT qty;
  DECLARE rooms_count INT;
  DROP TEMPORARY TABLE IF EXISTS rooms;
  CREATE TEMPORARY TABLE rooms (
    _id INT,
    capacity INT UNSIGNED,
    price_per_capita DECIMAL(8, 2)
  );
  SET rooms_count = (SELECT COUNT(*) FROM room);

  REPEAT
    SET i = i + 1;
    SET room_price = (SELECT price FROM room WHERE _id = i);
    SET room_capacity = (SELECT capacity FROM room WHERE _id = i);
    INSERT INTO rooms(_id, capacity, price_per_capita)
      VALUE(i, room_capacity, room_price / room_capacity);
  UNTIL i >= rooms_count
  END REPEAT;

  SET i = 0, qty = 0;
  SELECT people AS Люди;
  WHILE people > 0 AND i <= rooms_count DO
    SET @c = CAST((SELECT capacity FROM rooms LIMIT 1) AS SIGNED);
    SET people = people - @c;
    DELETE FROM rooms LIMIT 1;
    SET i = i + 1;
    SELECT i;
    SELECT @c;
    SELECT people;
    IF people < 0 THEN SET people = people + @c;
    ELSE SET qty = qty + 1;
    END IF;
  END WHILE;

END//

SET people = people - CAST((SELECT capacity FROM rooms LIMIT 1) AS SIGNED);

SET people = people - (
      SELECT capacity FROM rooms LIMIT 1
      );

  SET qty = 0;
  WHILE qty <= rooms_count AND people > 0 DO
    SET people = people - (
      SELECT capacity FROM @rooms_sorted WHERE rnumber = qty + 1
      );
    SET qty = qty + 1;
  END WHILE;

SET @rn = (SELECT ROW_NUMBER() OVER (ORDER BY price) AS rnumber FROM room);


  WHILE qty <= (SELECT COUNT(*) FROM rooms) AND people > 0 DO
    SET people = people - (
      SELECT capacity FROM @rooms_sorted WHERE rnumber = qty + 1
      );
    SET qty = qty + 1;
  END WHILE;
  SELECT * FROM rooms ORDER BY price_per_capita;
  SELECT *, ROW_NUMBER() OVER (ORDER BY price_per_capita)
    AS rnumber FROM rooms;

  SET qty = SELECT COUNT(*) FROM rooms;



  SET @rooms_sorted = (SELECT *, ROW_NUMBER() OVER (ORDER BY price_per_capita)
    AS rnumber FROM rooms);

  DECLARE people INT;

  SET qty = i;
  SET people = qty;
  SET i = 1;
  WHILE i > (SELECT COUNT(*) FROM rooms) AND peope > 0 DO
    SET people = people - (
      SELECT capacity FROM @rooms_sorted WHERE rnumber = i
      );
    SET i = i + 1;
  END WHILE;
  SELECT * FROM rooms ORDER BY price_per_capita;
  SELECT *, ROW_NUMBER() OVER (ORDER BY price_per_capita)
    AS rnumber FROM rooms;

  DECLARE people INT DEFAULT qty;
  WHILE i > 0 DO
    INSERT INTO rooms
      SELECT room.number FROM room WHERE capacity <= i
        AND NOT EXISTS(SELECT * FROM rooms) ORDER BY capacity DESC LIMIT 1;
    SET i=i-1;
  END WHILE;

SELECT *, ROW_NUMBER() OVER (ORDER BY price)
    AS row_number FROM room;

 SELECT *, ROW_NUMBER() OVER (ORDER BY price) AS "row number" FROM room;

  WHILE people > 0 DO
    SET added = (
      SELECT number FROM room WHERE capacity <= people
        AND number NOT IN (SELECT number FROM rooms)
        ORDER BY capacity DESC LIMIT 1
    );
    INSERT INTO rooms SELECT * FROM room WHERE number = added;
    SET people = people - (SELECT capacity FROM rooms WHERE number = added);
  END WHILE;
  SELECT number AS Номер, capacity AS Вместимость, price AS Цена FROM rooms;
  SELECT SUM(price) INTO total_price FROM rooms;
END//

DELIMITER ;

SET @quantity = 50;
CALL GetRooms(@quantity);
SELECT @quantity AS "Количество номеров";
DROP PROCEDURE GetRooms;

CALL GetRoomsByPeople(4, @price);
SELECT @price AS "Общая цена номеров";

CALL GetRoomsByPeople(0, @price);
SELECT @price AS "Общая цена номеров";



SELECT COUNT(*), YEAR(date_ts) AS checkin_year
  FROM checkin GROUP BY checkin_year;
```


<details>
<summary><b>Выполнение запроса</b></summary>

```
mysql> DELIMITER //
mysql> CREATE PROCEDURE GetSavingPlacement(INOUT people INT)
    -> BEGIN   DECLARE i INT DEFAULT 0;   DECLARE room_id INT;   DECLARE room_price DECIMAL(8, 2);
    -> DECLARE room_capacity INT;   DECLARE rooms_count INT;
    -> DROP TEMPORARY TABLE IF EXISTS prices;
    -> CREATE TEMPORARY TABLE prices (_id INT, capacity INT, price_per_capita DECIMAL(8, 2));
    -> DROP TEMPORARY TABLE IF EXISTS placement;
    -> CREATE TEMPORARY TABLE placement AS SELECT * FROM room LIMIT 0;
    -> DROP TEMPORARY TABLE IF EXISTS vacant;
    -> CREATE TEMPORARY TABLE vacant AS SELECT * FROM room WHERE _id NOT IN (
    -> SELECT DISTINCT room_id FROM checkin WHERE checkin.enter_date < NOW() AND checkin.leave_date > NOW() UNION
    -> SELECT DISTINCT room_id FROM reservation WHERE reservation.enter_date < NOW() AND reservation.leave_date > NOW());
    -> SET rooms_count = (SELECT COUNT(*) FROM vacant);
    -> REPEAT     SET i = i + 1;
    -> SET room_id = (SELECT _id FROM vacant LIMIT 1);
    -> IF i = room_id THEN       SET room_price = (SELECT price FROM room WHERE _id = i);
    -> SET room_capacity = (SELECT capacity FROM room WHERE _id = i);
    -> INSERT INTO prices(_id, capacity, price_per_capita) VALUE(i, room_capacity, room_price / room_capacity);
    -> DELETE FROM vacant WHERE _id = room_id;     END IF;
    -> UNTIL i >= rooms_count   END REPEAT;
    -> SET i = rooms_count;
    -> WHILE people > 0 AND i > 0 DO
    -> SET people = people - IFNULL((SELECT capacity FROM prices ORDER BY price_per_capita LIMIT 1), 0);
    -> IF people < 0 THEN SET people = 0;     END IF;
    -> SET i = i - 1;
    -> INSERT INTO placement SELECT * FROM room WHERE _id = (SELECT _id FROM prices ORDER BY price_per_capita LIMIT 1);
    -> DELETE FROM prices ORDER BY price_per_capita LIMIT 1;
    -> END WHILE;    SELECT * FROM placement;  END//
Query OK, 0 rows affected (0.00 sec)

mysql> DELIMITER ;
mysql> SET @guests = 80;
Query OK, 0 rows affected (0.00 sec)

mysql> CALL GetSavingPlacement(@guests);
+-----+--------+----------+----------+--------------+------------+
| _id | number | capacity | price    | phone_number | comfort_id |
+-----+--------+----------+----------+--------------+------------+
|  13 | 128    |        2 |  1148.85 | 1            |          1 |
|  17 | 65     |        3 |  3448.85 | 4096         |          1 |
|  22 | 20     |        2 |  2300.00 | 27           |          2 |
|  10 | 5      |        5 |  5750.00 | 05           |          2 |
|  15 | 6      |        6 |  6900.00 | 06           |          3 |
|  22 | 20     |        2 |  2300.00 | 27           |          2 |
|  19 | 78     |        3 |  3604.10 | 8192         |          2 |
|  16 | 45     |        4 |  5175.00 | 045          |          3 |
|   7 | 123    |        3 |  3910.00 | 1024         |          1 |
|  18 | 12     |        1 |  1437.50 | 12           |          1 |
|  20 | 23     |        2 |  2875.00 | 23           |          2 |
|   1 | 213    |        2 |  3392.50 | 512          |          1 |
|  14 | 754    |        2 |  3708.75 | 2048         |          2 |
|  21 | 7      |        1 |  1955.00 | 7            |          1 |
|   9 | 11     |        4 |  8418.00 | 03           |          2 |
|   4 | 225    |        1 |  2415.00 | 8            |          1 |
|  11 | 707    |        5 | 12167.00 | 02           |          3 |
|   2 | 303    |        2 |  4968.00 | 128          |          2 |
|  12 | 555    |        4 | 10614.50 | 064          |          3 |
|   6 | 202    |        1 |  2875.00 | 4            |          1 |
|   3 | 506    |        3 |  8970.00 | 032          |          3 |
|   8 | 101    |        1 |  3392.50 | 256          |          1 |
+-----+--------+----------+----------+--------------+------------+
22 rows in set (0.01 sec)

Query OK, 0 rows affected (0.08 sec)

mysql> SELECT @guests AS "Не расселено человек";
+----------------------+
| Не расселено человек |
+----------------------+
|                   21 |
+----------------------+
1 row in set (0.00 sec)

mysql> CALL GetSavingPlacement(@guests);
+-----+--------+----------+---------+--------------+------------+
| _id | number | capacity | price   | phone_number | comfort_id |
+-----+--------+----------+---------+--------------+------------+
|  13 | 128    |        2 | 1148.85 | 1            |          1 |
|  17 | 65     |        3 | 3448.85 | 4096         |          1 |
|  22 | 20     |        2 | 2300.00 | 27           |          2 |
|  10 | 5      |        5 | 5750.00 | 05           |          2 |
|  15 | 6      |        6 | 6900.00 | 06           |          3 |
|  22 | 20     |        2 | 2300.00 | 27           |          2 |
|  19 | 78     |        3 | 3604.10 | 8192         |          2 |
+-----+--------+----------+---------+--------------+------------+
7 rows in set (0.01 sec)

Query OK, 0 rows affected (0.03 sec)

mysql> SELECT @guests AS "Не расселено человек";
+----------------------+
| Не расселено человек |
+----------------------+
|                    0 |
+----------------------+
1 row in set (0.00 sec)

mysql> CALL GetSavingPlacement(@guests);
Empty set (0.01 sec)

Query OK, 0 rows affected (0.01 sec)

mysql> SELECT @guests AS "Не расселено человек";
+----------------------+
| Не расселено человек |
+----------------------+
|                    0 |
+----------------------+
1 row in set (0.00 sec)

```

</details>

## Работа 24.O «Создание хранимых функций»

### 3.1 Задача 1
Вывести фамилию, инициалы и телефон клиента в одну строку. Фамилию ввести как параметр.

```sql
DELIMITER //

CREATE FUNCTION getClient(client_name VARCHAR(20)) RETURNS CHAR(64)
BEGIN
  DECLARE client_info CHAR(64);
  SELECT
    CONCAT(
      last_name, ' ',
      SUBSTRING(first_name, 1, 1), '.',
      SUBSTRING(second_name, 1, 1), '. ',
      IFNULL(CONCAT('+7', phone.number), '')
    ) INTO client_info
      FROM client LEFT JOIN phone ON client._id = phone.client_id
      WHERE last_name = client_name LIMIT 1;
  RETURN IFNULL(client_info, "Данных, соответствующих запросу, не обнаружено");
END//

DELIMITER ;

SELECT getClient('Иванов') AS "ФИО, телефон";
SELECT getClient('Абрамова') AS "Информация о клиенте";
SELECT getClient('Соколов') AS "Данные клиента";

DROP FUNCTION getClient;
```

<details>
<summary><b>Выполнение запроса</b></summary>

```
mysql> DELIMITER //
mysql> CREATE FUNCTION getClient(client_name VARCHAR(20)) RETURNS CHAR(64)
    -> BEGIN   DECLARE client_info CHAR(64);
    -> SELECT CONCAT(last_name, ' ', SUBSTRING(first_name, 1, 1), '.', SUBSTRING(second_name, 1, 1), '. ',
    -> IFNULL(CONCAT('+7', phone.number), '')     ) INTO client_info
    -> FROM client LEFT JOIN phone ON client._id = phone.client_id
    -> WHERE last_name = client_name LIMIT 1;
    -> RETURN IFNULL(client_info, "Данных, соответствующих запросу, не обнаружено");
    -> END//
Query OK, 0 rows affected (0.00 sec)

mysql> DELIMITER ;
mysql> SELECT getClient('Иванов') AS "ФИО, телефон";
+--------------------------+
| ФИО, телефон             |
+--------------------------+
| Иванов А.И. +79315685669 |
+--------------------------+
1 row in set (0.00 sec)

mysql> SELECT getClient('Абрамова') AS "Информация о клиенте";
+------------------------------------------------+
| Информация о клиенте                           |
+------------------------------------------------+
| Данных, соответствующих запросу, не обнаружено |
+------------------------------------------------+
1 row in set (0.00 sec)

mysql> SELECT getClient('Соколов') AS "Данные клиента";
+----------------+
| Данные клиента |
+----------------+
| Соколов М.И.   |
+----------------+
1 row in set (0.00 sec)

```

</details>

### 3.2 Задача 2
Вывести количество человек, которые были заселены в номере. Если количество человек больше 20, то вывести 25, иначе вывести 19.

```sql
DELIMITER //

CREATE FUNCTION getCheckinsQty(room_number VARCHAR(10)) RETURNS SMALLINT UNSIGNED
BEGIN
  DECLARE guests_qty SMALLINT UNSIGNED;
  SELECT COUNT(*) INTO guests_qty 
    FROM checkin JOIN room ON checkin.room_id = room._id
    WHERE room.number = room_number;
  IF guests_qty > 20
    THEN RETURN 25;
    ELSE RETURN 19;
  END IF;
END//

DELIMITER ;

INSERT INTO checkin(enter_date, leave_date, room_id, client_id)
  VALUES
    ('2024-11-22', '2024-11-25', 10, 1),
    ('2024-11-22', '2024-11-25', 10, 2),
    ('2024-11-22', '2024-11-25', 10, 3),
    ('2024-11-22', '2024-11-25', 10, 4),
    ('2024-11-22', '2024-11-25', 10, 5),
    ('2023-11-22', '2023-11-24', 11, 5),
    ('2024-11-25', '2024-11-27', 10, 6),
    ('2024-11-25', '2024-11-27', 10, 7),
    ('2024-11-25', '2024-11-27', 10, 8),
    ('2024-11-25', '2024-11-27', 10, 9),
    ('2024-11-25', '2024-11-27', 10, 10),
    ('2024-11-27', '2024-11-30', 10, 11),
    ('2024-11-27', '2024-11-30', 10, 12),
    ('2024-11-27', '2024-11-30', 10, 13),
    ('2024-11-27', '2024-11-30', 10, 14),
    ('2024-11-27', '2024-11-30', 10, 15),
    ('2024-11-30', '2024-12-05', 10, 16),
    ('2024-11-30', '2024-12-05', 10, 17),
    ('2024-11-30', '2024-12-05', 10, 18),
    ('2024-11-30', '2024-12-05', 10, 19),
    ('2024-11-30', '2024-12-05', 10, 20)
;

SELECT getCheckinsQty('213') AS "Количество поселённых";
SELECT getCheckinsQty('5') AS "Количество заселений";

DROP FUNCTION getCheckinsQty;

SELECT COUNT(*) FROM checkin WHERE room_id = 1;


Numbers: 213, 6, 5, 707
```

<details>
<summary><b>Выполнение запроса</b></summary>

```
mysql> DELIMITER //
mysql> CREATE FUNCTION getCheckinsQty(room_number VARCHAR(10)) RETURNS SMALLINT UNSIGNED
    -> BEGIN   DECLARE guests_qty SMALLINT UNSIGNED;
    -> SELECT COUNT(*) INTO guests_qty
    -> FROM checkin JOIN room ON checkin.room_id = room._id WHERE room.number = room_number;
    -> IF guests_qty > 20     THEN RETURN 25;     ELSE RETURN 19;   END IF;
    -> END//
Query OK, 0 rows affected (0.00 sec)

mysql> DELIMITER ;
mysql> SELECT getCheckinsQty('213') AS "Количество поселённых";
+-----------------------+
| Количество поселённых |
+-----------------------+
|                    19 |
+-----------------------+
1 row in set (0.00 sec)

mysql> SELECT getCheckinsQty('5') AS "Количество заселений";
+----------------------+
| Количество заселений |
+----------------------+
|                   19 |
+----------------------+
1 row in set (0.00 sec)

mysql> INSERT INTO checkin(enter_date, leave_date, room_id, client_id)
    -> VALUES
    -> ('2024-11-22', '2024-11-25', 10, 1),
    -> ('2024-11-22', '2024-11-25', 10, 2),
    -> ('2024-11-22', '2024-11-25', 10, 3),
    -> ('2024-11-22', '2024-11-25', 10, 4),
    -> ('2024-11-22', '2024-11-25', 10, 5),
    -> ('2023-11-22', '2023-11-24', 11, 5),
    -> ('2024-11-25', '2024-11-27', 10, 6),
    -> ('2024-11-25', '2024-11-27', 10, 7),
    -> ('2024-11-25', '2024-11-27', 10, 8),
    -> ('2024-11-25', '2024-11-27', 10, 9),
    -> ('2024-11-25', '2024-11-27', 10, 10),
    -> ('2024-11-27', '2024-11-30', 10, 11),
    -> ('2024-11-27', '2024-11-30', 10, 12),
    -> ('2024-11-27', '2024-11-30', 10, 13),
    -> ('2024-11-27', '2024-11-30', 10, 14),
    -> ('2024-11-27', '2024-11-30', 10, 15),
    -> ('2024-11-30', '2024-12-05', 10, 16),
    -> ('2024-11-30', '2024-12-05', 10, 17),
    -> ('2024-11-30', '2024-12-05', 10, 18),
    -> ('2024-11-30', '2024-12-05', 10, 19),
    -> ('2024-11-30', '2024-12-05', 10, 20);
Query OK, 21 rows affected (0.00 sec)
Records: 21  Duplicates: 0  Warnings: 0

mysql> SELECT getCheckinsQty('5') AS "Количество заселений";
+----------------------+
| Количество заселений |
+----------------------+
|                   25 |
+----------------------+
1 row in set (0.00 sec)

```

</details>

### 3.3 Задача 3
Создать функцию, которая выводит номер, в котором клиент заселялся наименьшее число раз. Код клиента вводится как параметр.

```sql
DELIMITER //

CREATE FUNCTION getRoomByClient(guest_id INT UNSIGNED) RETURNS VARCHAR(10)
BEGIN
  DECLARE n INT;
  DECLARE i INT DEFAULT 0;
  DECLARE checkins INT DEFAULT 2147483647; DECLARE c INT;
  DECLARE days_min INT DEFAULT 2147483647; DECLARE d INT;
  DECLARE rm_id INT UNSIGNED;
  DECLARE room_cur INT UNSIGNED;
  DROP TEMPORARY TABLE IF EXISTS client_checkins;
  CREATE TEMPORARY TABLE client_checkins AS
    SELECT
      room_id, room.number, COUNT(*) AS qty,
      ROW_NUMBER() OVER (ORDER BY COUNT(*) ASC) AS r
    FROM checkin JOIN room ON checkin.room_id = room._id
    WHERE client_id = guest_id GROUP BY room_id;
  SELECT COUNT(*) FROM client_checkins INTO n;
  
  /* Define the room with least number of days spent by the client
   * Used for rooms with equal checkins quantity
   */
  least_lp: LOOP
    SET i = i + 1;
    SELECT qty FROM client_checkins WHERE r = i INTO c;
    SELECT room_id FROM client_checkins WHERE r = i INTO room_cur;
    SELECT SUM(DATEDIFF(leave_date, enter_date)) AS days_amt
        FROM checkin WHERE client_id = guest_id
        GROUP BY room_id HAVING room_id = room_cur INTO d;
    IF i > n THEN LEAVE least_lp;
      ELSEIF c > checkins THEN LEAVE least_lp;
      ELSEIF d > days_min THEN LEAVE least_lp;
      ELSE
        SET checkins = c, days_min = d, rm_id = room_cur;
        ITERATE least_lp;
    END IF;
    END LOOP least_lp;

  RETURN (SELECT number FROM room WHERE _id = rm_id);
END//

DELIMITER ;

SELECT getRoomByClient(1) AS "Номер с наименьшим числом заселений";
SELECT getRoomByClient(5) AS "Наименее популярный номер";
DROP FUNCTION getRoomByClient;

-- Better alternative
DELIMITER //

CREATE FUNCTION getRoomByClientShort(guest_id INT UNSIGNED) RETURNS VARCHAR(10)
BEGIN
  DECLARE rm_id INT UNSIGNED;
  SELECT room_id
    FROM checkin JOIN room ON checkin.room_id = room._id
    WHERE client_id = guest_id GROUP BY room_id
    ORDER BY COUNT(*), SUM(DATEDIFF(leave_date, enter_date)) LIMIT 1
    INTO rm_id;
  RETURN (SELECT number FROM room WHERE _id = rm_id);
END//

DELIMITER ;

SELECT getRoomByClientShort(1);
DROP FUNCTION getRoomByClientShort;

DELIMITER //

CREATE PROCEDURE gC(IN guest_id INT UNSIGNED)
BEGIN
  DECLARE n INT;
  DECLARE i INT DEFAULT 0;
  DECLARE checkins INT DEFAULT 2147483647;
  DECLARE c INT;
  DECLARE days_min INT DEFAULT 2147483647;
  DECLARE d INT;
  DECLARE rm_id INT UNSIGNED;
  DECLARE room_cur INT UNSIGNED;
  DROP TEMPORARY TABLE IF EXISTS client_checkins;
  CREATE TEMPORARY TABLE client_checkins AS
    SELECT
      room_id, room.number, COUNT(*) AS qty,
      ROW_NUMBER() OVER (ORDER BY COUNT(*) ASC) AS r
    FROM checkin JOIN room ON checkin.room_id = room._id
    WHERE client_id = guest_id GROUP BY room_id;
  SELECT COUNT(*) FROM client_checkins INTO n;
  label1: LOOP
    SET i = i + 1;
    SELECT qty FROM client_checkins WHERE r = i INTO c;
    SELECT room_id FROM client_checkins WHERE r = i INTO room_cur;
    SELECT i;
    SELECT c;
    SELECT room_cur;
    SELECT checkins;
    SELECT days_min;
    SELECT SUM(DATEDIFF(leave_date, enter_date)) AS days_amt
        FROM checkin WHERE client_id = guest_id
        GROUP BY room_id HAVING room_id = room_cur INTO d;
    IF i > n THEN LEAVE label1;
      ELSEIF c > checkins THEN LEAVE label1;
      ELSEIF d > days_min THEN LEAVE label1;
      ELSE
        SET checkins = c;
        SET days_min = d;
        SET rm_id = room_cur;
        SELECT checkins;
        SELECT days_min;
        SELECT rm_id;
        ITERATE label1;
    END IF;
    END LOOP label1;
END//

DELIMITER ;

CALL gC(1);
DROP PROCEDURE gC;


SELECT
  room_id,
  room.number,
  COUNT(*) AS qty,
  SUM(DATEDIFF(leave_date, enter_date)) AS days_amt
  FROM checkin JOIN room ON checkin.room_id = room._id
  WHERE client_id = 1
  GROUP BY room_id
  ORDER BY qty, days_amt
;

SELECT
  room_id,
  room.number,
  COUNT(*) AS qty,
  SUM(DATEDIFF(leave_date, enter_date)) AS days_amt
  FROM checkin JOIN room ON checkin.room_id = room._id
  GROUP BY room_id
  ORDER BY qty, days_amt
;

SELECT room_id, client_id, DATEDIFF(leave_date, enter_date) FROM checkin ORDER BY client_id;

DELIMITER //

CREATE FUNCTION doiterate(p1 INT) RETURNS INT
BEGIN
  label1: LOOP
    SET p1 = p1 + 1;
    IF p1 < 10 THEN
      ITERATE label1;
    END IF;
    LEAVE label1;
  END LOOP label1;
  SET @x = p1;
  RETURN @x;
END//

DELIMITER ;

SELECT doiterate(1);

CREATE VIEW client_checkin AS SELECT
  *, ROW_NUMBER() OVER (ORDER BY _id asc) AS r
  FROM checkin
  WHERE client_id = 1
  ORDER BY room_id
;

SELECT *, ROW_NUMBER() OVER (ORDER BY _id asc) AS r FROM checkin ORDER BY client_id;
SELECT
  room_id,
  room.number,
  COUNT(*) AS qty,
  SUM(DATEDIFF(leave_date, enter_date)) AS days_amt,
  ROW_NUMBER() OVER (ORDER BY COUNT(*) ASC) AS r
  FROM checkin JOIN room ON checkin.room_id = room._id
  WHERE client_id = 1
  GROUP BY room_id
  ORDER BY qty
;

SELECT *, ROW_NUMBER() OVER (ORDER BY qty, days_amt ASC) AS r FROM
(SELECT
  room_id,
  room.number,
  COUNT(*) AS qty,
  SUM(DATEDIFF(leave_date, enter_date)) AS days_amt
  FROM checkin JOIN room ON checkin.room_id = room._id
  WHERE client_id = 1
  GROUP BY room_id
  ORDER BY qty, days_amt
) AS a
;

```

<details>
<summary><b>Выполнение запроса</b></summary>

```
mysql> DELIMITER //
mysql> CREATE FUNCTION getRoomByClient(guest_id INT UNSIGNED) RETURNS VARCHAR(10)
    -> BEGIN   DECLARE n INT;   DECLARE i INT DEFAULT 0;
    -> DECLARE checkins INT DEFAULT 2147483647; DECLARE c INT;
    -> DECLARE days_min INT DEFAULT 2147483647; DECLARE d INT;
    -> DECLARE rm_id INT UNSIGNED;   DECLARE room_cur INT UNSIGNED;
    -> DROP TEMPORARY TABLE IF EXISTS client_checkins;
    -> CREATE TEMPORARY TABLE client_checkins AS     SELECT
    -> room_id, room.number, COUNT(*) AS qty,
    -> ROW_NUMBER() OVER (ORDER BY COUNT(*) ASC) AS r
    -> FROM checkin JOIN room ON checkin.room_id = room._id
    -> WHERE client_id = guest_id GROUP BY room_id;
    -> SELECT COUNT(*) FROM client_checkins INTO n;
    -> least_lp: LOOP     SET i = i + 1;
    -> SELECT qty FROM client_checkins WHERE r = i INTO c;
    -> SELECT room_id FROM client_checkins WHERE r = i INTO room_cur;
    -> SELECT SUM(DATEDIFF(leave_date, enter_date)) AS days_amt
    -> FROM checkin WHERE client_id = guest_id
    -> GROUP BY room_id HAVING room_id = room_cur INTO d;
    -> IF i > n THEN LEAVE least_lp;
    -> ELSEIF c > checkins THEN LEAVE least_lp;
    -> ELSEIF d > days_min THEN LEAVE least_lp;
    -> ELSE SET checkins = c, days_min = d, rm_id = room_cur; ITERATE least_lp;
    -> END IF;     END LOOP least_lp;
    -> RETURN (SELECT number FROM room WHERE _id = rm_id);
    -> END//
Query OK, 0 rows affected (0.01 sec)

mysql> DELIMITER ;
mysql> SELECT getRoomByClient(1) AS "Номер с наименьшим числом заселений";
+-------------------------------------+
| Номер с наименьшим числом заселений |
+-------------------------------------+
| 5                                   |
+-------------------------------------+
1 row in set (0.01 sec)

mysql> SELECT getRoomByClient(5) AS "Наименее популярный номер";
+---------------------------+
| Наименее популярный номер |
+---------------------------+
| 707                       |
+---------------------------+
1 row in set (0.00 sec)

```

</details>

Show all views:
SHOW FULL TABLES IN hotel WHERE TABLE_TYPE LIKE 'VIEW';

SHOW FULL TABLES IN hotel WHERE TABLE_TYPE LIKE 'BASE TABLE';

## Работа 25.O «Создание триггеров»

### 3.1 Задача 1
Создать триггер BEFORE DELETE. Созданный триггер позволяет при удалении записи о клиенте автоматически удалять связанные с ним записи в таблицах поселений и броней.

```sql
DELIMITER //

CREATE TRIGGER delete_client
  BEFORE DELETE ON client FOR EACH ROW
  BEGIN
    DELETE FROM checkin     WHERE client_id = OLD._id;
    DELETE FROM reservation WHERE client_id = OLD._id;
END//

DELIMITER ;

SET @client_id = (SELECT _id FROM client WHERE last_name = "Захаров");

INSERT INTO checkin(enter_date, leave_date, room_id, client_id)
  VALUE ('2024-11-23', '2024-11-25', 6, @client_id)
;

INSERT INTO reservation(enter_date, leave_date, room_id, client_id)
  VALUE ('2024-11-23', '2024-11-25', 6, @client_id)
;

SELECT
  _id AS Код,
  CONCAT(last_name, ' ', SUBSTRING(first_name, 1, 1), '.', SUBSTRING(second_name, 1, 1), '.') AS "ФИО",
  CONCAT(SUBSTRING(passport_number, 1, 4), ' ', SUBSTRING(passport_number, 5)) AS "Номер паспорта",
  DATE_FORMAT(birth_date, "%b %d, %Y") AS "Дата рождения",
  IF (LENGTH(address) > 20, CONCAT(SUBSTRING(address, 1, 30), '...'), address) AS "Адрес"
FROM client WHERE _id = @client_id;

SELECT
  checkin._id AS "Код поселения",
  enter_date AS "Дата заселения",
  leave_date AS "Дата освобождения",
  client_id AS "Код клиента",
  CONCAT(last_name, ' ', SUBSTRING(first_name, 1, 1), '.', SUBSTRING(second_name, 1, 1), '.') AS "ФИО"
  FROM checkin JOIN client ON checkin.client_id = client._id
  WHERE client_id = @client_id;

SELECT
  reservation._id AS "Код брони",
  enter_date AS "Дата заселения",
  leave_date AS "Дата освобождения",
  client_id AS "Код клиента",
  CONCAT(last_name, ' ', SUBSTRING(first_name, 1, 1), '.', SUBSTRING(second_name, 1, 1), '.') AS "ФИО"
  FROM reservation JOIN client ON reservation.client_id = client._id 
  WHERE client_id = @client_id;

DELETE FROM client WHERE _id = @client_id;

DROP TRIGGER getClient;

```

<details>
<summary><b>Выполнение запроса</b></summary>

```
mysql> CREATE TRIGGER delete_client
    -> BEFORE DELETE ON client FOR EACH ROW
    -> BEGIN
    -> DELETE FROM checkin     WHERE client_id = OLD._id;
    -> DELETE FROM reservation WHERE client_id = OLD._id;
    -> END//
Query OK, 0 rows affected (0.00 sec)

mysql> DELIMITER ;
mysql> SET @client_id = (SELECT _id FROM client WHERE last_name = "Захаров");
Query OK, 0 rows affected (0.00 sec)

mysql> INSERT INTO checkin(enter_date, leave_date, room_id, client_id)
    -> VALUE ('2024-11-23', '2024-11-25', 6, @client_id) ;
Query OK, 1 row affected (0.00 sec)

mysql> INSERT INTO reservation(enter_date, leave_date, room_id, client_id)
    -> VALUE ('2024-11-23', '2024-11-25', 6, @client_id) ;
Query OK, 1 row affected (0.00 sec)

mysql> SELECT   _id AS Код,
    -> CONCAT(last_name, ' ', SUBSTRING(first_name, 1, 1), '.', SUBSTRING(second_name, 1, 1), '.') AS "ФИО",
    -> CONCAT(SUBSTRING(passport_number, 1, 4), ' ', SUBSTRING(passport_number, 5)) AS "Номер паспорта",
    -> DATE_FORMAT(birth_date, "%b %d, %Y") AS "Дата рождения",
    -> IF (LENGTH(address) > 20, CONCAT(SUBSTRING(address, 1, 30), '...'), address) AS "Адрес"
    -> FROM client WHERE _id = @client_id;
+-----+--------------+----------------+---------------+-----------------------------------+
| Код | ФИО          | Номер паспорта | Дата рождения | Адрес                             |
+-----+--------------+----------------+---------------+-----------------------------------+
|  34 | Захаров А.И. | 4939 630358    | Mar 11, 1986  | г. Нефтеюганск, Юбилейная ул.,... |
+-----+--------------+----------------+---------------+-----------------------------------+
1 row in set (0.00 sec)

mysql> SELECT   checkin._id AS "Код поселения",   enter_date AS "Дата заселения",
    -> leave_date AS "Дата освобождения",   client_id AS "Код клиента",
    -> CONCAT(last_name, ' ', SUBSTRING(first_name, 1, 1), '.', SUBSTRING(second_name, 1, 1), '.') AS "ФИО"
    -> FROM checkin JOIN client ON checkin.client_id = client._id   WHERE client_id = @client_id;
+---------------+----------------+-------------------+-------------+--------------+
| Код поселения | Дата заселения | Дата освобождения | Код клиента | ФИО          |
+---------------+----------------+-------------------+-------------+--------------+
|            45 | 2024-11-23     | 2024-11-25        |          34 | Захаров А.И. |
+---------------+----------------+-------------------+-------------+--------------+
1 row in set (0.00 sec)

mysql> SELECT   reservation._id AS "Код брони",   enter_date AS "Дата заселения",
    -> leave_date AS "Дата освобождения",   client_id AS "Код клиента",
    -> CONCAT(last_name, ' ', SUBSTRING(first_name, 1, 1), '.', SUBSTRING(second_name, 1, 1), '.') AS "ФИО"
    -> FROM reservation JOIN client ON reservation.client_id = client._id   WHERE client_id = @client_id;
+-----------+----------------+-------------------+-------------+--------------+
| Код брони | Дата заселения | Дата освобождения | Код клиента | ФИО          |
+-----------+----------------+-------------------+-------------+--------------+
|        11 | 2024-11-23     | 2024-11-25        |          34 | Захаров А.И. |
+-----------+----------------+-------------------+-------------+--------------+
1 row in set (0.00 sec)

mysql> DELETE FROM client WHERE _id = @client_id;
Query OK, 1 row affected (0.00 sec)

mysql> SELECT * FROM client WHERE _id = @client_id;
Empty set (0.00 sec)

mysql> SELECT * FROM checkin WHERE client_id = @client_id;
Empty set (0.00 sec)

mysql> SELECT * FROM reservation WHERE client_id = @client_id;
Empty set (0.00 sec)





mysql> select * from client;
+-----+-------------+------------+---------------+-----+-----------------+------------+----------------------------------------------------------------------------------+--------------------------------------------+
| _id | last_name   | first_name | second_name   | sex | passport_number | birth_date | address                                                                          | comment                                    |
+-----+-------------+------------+---------------+-----+-----------------+------------+----------------------------------------------------------------------------------+--------------------------------------------+
|   2 | Сидоров     | Сидор      | Сидорович     | m   | 7863523156      | 1975-03-08 | ул. Советская, д. 23, г. Тверь, Тверская обл., 170100                            | NULL                                       |
|   3 | Иванов      | Александр  | Иванович      | m   | 0569836879      | 1985-02-16 | Воскресенский б-р, д. 3, г. Великий Новгород, Новгородская область, 173002       | Не любит шум                               |
|   4 | Суворова    | Галина     | Ивановна      | f   | 9874563215      | 1975-04-03 | пл. Ленина, д. 2, г. Махачкала, Республика Дагестан, 367000                      | NULL                                       |
|   5 | Петров      | Степан     | Викторович    | m   | 0786534882      | 1965-08-21 | ул. Калиновская, д. 38, г. Кострома, Костромская обл., 156013                    | NULL                                       |
|   6 | Решетникова | Анна       | Владимировна  | f   | 6798563549      | 1973-08-09 | ул. Победы, д. 3, корп. С, г. Назрань, Республика Ингушетия, 386102              | Крайне обидчива                            |
|   7 | Ян          | Мария      | Григорьевна   | f   | 9804356987      | 1994-05-24 | ул. Свободы, д. 46, г. Ярославль, Ярославская обл., 150000                       | NULL                                       |
|  10 | Чижиков     | Михаил     | Николаевич    | m   | 5468654932      | 2001-07-14 | ул. Московская, д. 55, г. Казань, Республика Татарстан, 420021                   | NULL                                       |
|  11 | Капралова   | Светлана   | Борисовна     | f   | 5428965246      | 1975-04-19 | 4-я линия В.О., д. 13, лит. А, г. Санкт-Петербург, 199004                        | NULL                                       |
|  12 | Лапина      | Марина     | Александровна | f   | 0428456828      | 1988-03-17 | пр-т Ворошиловский, д. 2/2, офис 403, г. Ростов-на-Дону, Ростовская обл., 344006 | NULL                                       |
|  13 | Красавин    | Вадим      | Анатольевич   | m   | 7689254981      | 1985-03-30 | пр-т К. Маркса, д. 12А, г. Омск, Омская обл., 644010                             | Отличный парень                            |
|  15 | Соловьев    | Владимир   | Рудовольфович | m   | 5679546321      | 1963-10-20 | наб. Варкауса, д. 1А, г. Петрозаводск, Республика Карелия, 185031                | российский журналист, радио- и телеведущий |
|  16 | Мединская   | Ирина      | Глебовна      | f   | 7788654587      | 2003-12-31 | ул. Карла Либкнехта, д. 55, г. Киров, Кировская обл., 610020                     | NULL                                       |
|  18 | Соколов     | Михаил     | Иванович      | m   | 5793249563      | 1988-07-16 | ул. Ленина, д. 40, г. Майкоп, Республика Адыгея, 385000                          | NULL                                       |
|  21 | Фролов      | Александр  | Павлович      | m   | 7892697635      | 1979-08-03 | ул. Амурская, д. 150, г. Благовещенск, Амурская обл., 675000                     | NULL                                       |
|  22 | Ампилов     | Виктор     | Иванович      | m   | 6548652325      | 2005-10-02 | ул. Большая Московская, д. 1, г. Владимир, Владимирская обл., 600000             | NULL                                       |
|  24 | Матвиенко   | Александр  | Александрович | m   | 5469842632      | 1996-05-02 | ул. К. Либкнехта, д. 2, г. Архангельск, Архангельская обл., 163000               | футболист                                  |
|  25 | Фролова     | Анна       | Тарасовна     | f   | 7842359821      | 1997-07-19 | ул. Шаумяна, д. 47, г. Астрахань, Астраханская обл., 414000                      | NULL                                       |
|  26 | Симонов     | Александр  | Михайлович    | m   | 4569487532      | 1974-11-15 | ул. Пушкина, д. 95, г. Уфа, Республика Башкортостан, 450008                      | NULL                                       |
|  27 | Северов     | Нестор     | Петрович      | m   | 7865243896      | 1965-04-29 | ул. Ленина, д. 55, г. Улан-Удэ, Республика Бурятия, 670000                       | Новенький                                  |
|  28 | Просов      | Владимир   | Тимофеевич    | m   | 1998653478      | 1991-03-03 | Мясницкий проезд, д. 4, стр. 1, г. Москва, 107078                                | NULL                                       |
|  29 | Романов     | Александр  | Павлович      | m   | 2506179618      | 1996-08-06 | ул. Волкова, д. 164, г. Йошкар-Ола, Республика Марий Эл, 424000                  | Благословенный                             |
|  34 | Захаров     | Андрей     | Иринеевич     | m   | 4939630358      | 1986-03-11 | г. Нефтеюганск, Юбилейная ул., д. 7 кв.64                                        | NULL                                       |
+-----+-------------+------------+---------------+-----+-----------------+------------+----------------------------------------------------------------------------------+--------------------------------------------+
22 rows in set (0.01 sec)
```

</details>

### 3.2 Задача 2
Создать триггер AFTER INSERT с оператором CASE. Созданный триггер позволяет при добавлении записи о клиенте в зависимости от пола и возраста клиента добавлять ему ту или иную скидку.

```sql
INSERT INTO discount(category_name, value)
  VALUES ('Пенсионер', 0.2), ('Пенсионерка', 0.3), ('Новый клиент', 0.1)
;

SELECT * FROM discount;

DELIMITER //

CREATE TRIGGER add_client
  AFTER INSERT ON client FOR EACH ROW
  BEGIN
    DECLARE age INT UNSIGNED;
    SELECT TIMESTAMPDIFF(YEAR, birth_date, CURDATE())
      FROM client WHERE _id = NEW._id INTO age;
    CASE
      WHEN NEW.sex = 'm' AND age >= 65 THEN INSERT
        INTO client_discount(client_id, discount_id) VALUE(NEW._id, 9);
      WHEN NEW.sex = 'f' AND age >= 60 THEN INSERT
        INTO client_discount(client_id, discount_id) VALUE(NEW._id, 10);
      ELSE INSERT
        INTO client_discount(client_id, discount_id) VALUE(NEW._id, 11);
  END CASE;
END//

DELIMITER ;

SELECT *
  FROM discount JOIN client ON discount.client_id = client_id
    JOIN discount ON a.discount_id = discount_id
  ;

SELECT
  category_name AS Категория,
  value AS 'Размер скидки',
  client_id AS 'Код клиента',
  CONCAT(last_name, ' ', SUBSTRING(first_name, 1, 1), '.', SUBSTRING(second_name, 1, 1), '.') AS "ФИО",
  TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) AS Возраст
  FROM discount INNER JOIN
    (client_discount JOIN client ON client_discount.client_id = client._id)
    ON discount._id = client_discount.discount_id
;

INSERT INTO client(last_name, first_name, second_name, sex, passport_number, birth_date, address, comment) VALUES
INSERT INTO client(last_name, first_name, second_name, sex, passport_number, birth_date, address) VALUES
  ('Грачёв', 'Семен', 'Антонович', 'm', '4780476033', '1987-02-01', 'г. Нижний Новгород, Заводская ул., д. 16 кв.82'),
  ('Журова', 'Анжела', 'Ефремовна', 'f', '4860400927', '2003-09-01', 'г. Димитровград, Зеленый пер., д. 10 кв.211'),
  ('Зобова', 'Марфа', 'Дмитриевна', 'f', '4983283790', '1962-04-17', 'г. Тула, Заводская ул., д. 8 кв.34'),
  ('Лашкин', 'Макар', 'Никанорович', 'm', '4234199604', '1957-10-23', 'г. Жуковский, Озерная ул., д. 25 кв.32'),
  ('Михальченко', 'Алексей', 'Леонтьевич', 'm', '4983190013', '1962-12-25', 'г. Копейск, Речная ул., д. 10 кв.15')
;



SELECT *, TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) AS age FROM client;

SET @client_id = (SELECT _id FROM client WHERE last_name = "Захаров");

DROP TRIGGER add_client;

SELECT
  _id AS Код,
  CONCAT(last_name, ' ', SUBSTRING(first_name, 1, 1), '.', SUBSTRING(second_name, 1, 1), '.') AS "ФИО",
  CONCAT(SUBSTRING(passport_number, 1, 4), ' ', SUBSTRING(passport_number, 5)) AS "Номер паспорта",
  DATE_FORMAT(birth_date, "%b %d, %Y") AS "Дата рождения",
  IF (LENGTH(address) > 20, CONCAT(SUBSTRING(address, 1, 30), '...'), address) AS "Адрес"
FROM client WHERE _id = @client_id;

SELECT
  checkin._id AS "Код поселения",
  enter_date AS "Дата заселения",
  leave_date AS "Дата освобождения",
  client_id AS "Код клиента",
  CONCAT(last_name, ' ', SUBSTRING(first_name, 1, 1), '.', SUBSTRING(second_name, 1, 1), '.') AS "ФИО"
  FROM checkin JOIN client ON checkin.client_id = client._id
  WHERE client_id = @client_id;

SELECT
  reservation._id AS "Код брони",
  enter_date AS "Дата заселения",
  leave_date AS "Дата освобождения",
  client_id AS "Код клиента",
  CONCAT(last_name, ' ', SUBSTRING(first_name, 1, 1), '.', SUBSTRING(second_name, 1, 1), '.') AS "ФИО"
  FROM reservation JOIN client ON reservation.client_id = client._id
  WHERE client_id = @client_id;

DELETE FROM client WHERE _id = @client_id;

DROP TRIGGER getClient;

```

<details>
<summary><b>Выполнение запроса</b></summary>

```
mysql> INSERT INTO discount(category_name, value)
    -> VALUES ('Пенсионер', 0.2), ('Пенсионерка', 0.3), ('Новый клиент', 0.1);
Query OK, 3 rows affected (0.00 sec)
Records: 3  Duplicates: 0  Warnings: 0

mysql> SELECT * FROM discount;
+-----+---------------+-------+
| _id | category_name | value |
+-----+---------------+-------+
|   1 | Герой труда   |  0.15 |
|   2 | Ликвидатор    |  0.10 |
|   3 | Постоянный    |  0.25 |
|   4 | Ветеран труда |  0.10 |
|   5 | Многодетный   |  0.05 |
|   6 | Сотрудник     |  0.33 |
|   8 | VIP           |  0.40 |
|   9 | Пенсионер     |  0.20 |
|  10 | Пенсионерка   |  0.30 |
|  11 | Новый клиент  |  0.10 |
+-----+---------------+-------+
10 rows in set (0.00 sec)

mysql> CREATE TRIGGER add_client   AFTER INSERT ON client FOR EACH ROW
    -> BEGIN     DECLARE age INT UNSIGNED;
    -> SELECT TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) FROM client WHERE _id = NEW._id INTO age;
    -> CASE WHEN NEW.sex = 'm' AND age >= 65 THEN INSERT INTO client_discount(client_id, discount_id) VALUE(NEW._id, 9);
    -> WHEN NEW.sex = 'f' AND age >= 60 THEN INSERT INTO client_discount(client_id, discount_id) VALUE(NEW._id, 10);
    -> ELSE INSERT         INTO client_discount(client_id, discount_id) VALUE(NEW._id, 11);   END CASE;
    -> END//
Query OK, 0 rows affected (0.01 sec)

mysql> DELIMITER ;
mysql> SELECT   category_name AS Категория,   value AS 'Размер скидки',   client_id AS 'Код клиента',
    -> CONCAT(last_name, ' ', SUBSTRING(first_name, 1, 1), '.', SUBSTRING(second_name, 1, 1), '.') AS "ФИО",
    -> TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) AS Возраст
    -> FROM discount INNER JOIN (client_discount JOIN client ON client_discount.client_id = client._id)
    -> ON discount._id = client_discount.discount_id ;
+---------------+---------------+-------------+---------------+---------+
| Категория     | Размер скидки | Код клиента | ФИО           | Возраст |
+---------------+---------------+-------------+---------------+---------+
| Постоянный    |          0.25 |           2 | Сидоров С.С.  |      49 |
| Постоянный    |          0.25 |           3 | Иванов А.И.   |      39 |
| Многодетный   |          0.05 |           4 | Суворова Г.И. |      49 |
| Постоянный    |          0.25 |           5 | Петров С.В.   |      59 |
| Ветеран труда |          0.10 |           5 | Петров С.В.   |      59 |
| Герой труда   |          0.15 |          13 | Красавин В.А. |      39 |
| Герой труда   |          0.15 |          15 | Соловьев В.Р. |      61 |
+---------------+---------------+-------------+---------------+---------+
7 rows in set (0.00 sec)

mysql> INSERT INTO client(last_name, first_name, second_name, sex, passport_number, birth_date, address) VALUES
    -> ('Грачёв', 'Семен', 'Антонович', 'm', '4780476033', '1987-02-01', 'г. Нижний Новгород, Заводская ул., д. 16 кв.82'),
    -> ('Журова', 'Анжела', 'Ефремовна', 'f', '4860400927', '2003-09-01', 'г. Димитровград, Зеленый пер., д. 10 кв.211'),
     -> ('Зобова', 'Марфа', 'Дмитриевна', 'f', '4983283790', '1962-04-17', 'г. Тула, Заводская ул., д. 8 кв.34'),
    -> ('Лашкин', 'Макар', 'Никанорович', 'm', '4234199604', '1957-10-23', 'г. Жуковский, Озерная ул., д. 25 кв.32'),
    -> ('Михальченко', 'Алексей', 'Леонтьевич', 'm', '4983190013', '1962-12-25', 'г. Копейск, Речная ул., д. 10 кв.15') ;
Query OK, 5 rows affected (0.01 sec)
Records: 5  Duplicates: 0  Warnings: 0

mysql> SELECT   category_name AS Категория,   value AS 'Размер скидки',   client_id AS 'Код клиента',
    -> CONCAT(last_name, ' ', SUBSTRING(first_name, 1, 1), '.', SUBSTRING(second_name, 1, 1), '.') AS "ФИО",
    -> TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) AS Возраст
    -> FROM discount INNER JOIN     (client_discount JOIN client ON client_discount.client_id = client._id)
    -> ON discount._id = client_discount.discount_id ;
+---------------+---------------+-------------+------------------+---------+
| Категория     | Размер скидки | Код клиента | ФИО              | Возраст |
+---------------+---------------+-------------+------------------+---------+
| Постоянный    |          0.25 |           2 | Сидоров С.С.     |      49 |
| Постоянный    |          0.25 |           3 | Иванов А.И.      |      39 |
| Многодетный   |          0.05 |           4 | Суворова Г.И.    |      49 |
| Постоянный    |          0.25 |           5 | Петров С.В.      |      59 |
| Ветеран труда |          0.10 |           5 | Петров С.В.      |      59 |
| Герой труда   |          0.15 |          13 | Красавин В.А.    |      39 |
| Герой труда   |          0.15 |          15 | Соловьев В.Р.    |      61 |
| Новый клиент  |          0.10 |          37 | Грачёв С.А.      |      37 |
| Новый клиент  |          0.10 |          38 | Журова А.Е.      |      21 |
| Пенсионерка   |          0.30 |          39 | Зобова М.Д.      |      62 |
| Пенсионер     |          0.20 |          40 | Лашкин М.Н.      |      67 |
| Новый клиент  |          0.10 |          41 | Михальченко А.Л. |      61 |
+---------------+---------------+-------------+------------------+---------+
12 rows in set (0.00 sec)

```

</details>

## Работа 26.O «Создание курсоров»

### 3.1 Задача 1
Создать курсор внутри хранимой процедуры. Созданная процедура с курсором позволяет определить количество свободных мест в каждом из номеров с учётом заселения и бронирования на указанную входящим параметром дату, а также вывести общее количество свободных мест в выходной параметр.

```sql
DELIMITER //

CREATE PROCEDURE GetVacantPlaces(IN target_date DATE, OUT places INT UNSIGNED)
COMMENT 'Displays the list of vacant places in rooms on a given date'
BEGIN
  DECLARE is_done BOOL DEFAULT FALSE;
  DECLARE rm_i INT UNSIGNED;
  DECLARE rm_c TINYINT UNSIGNED;
  DECLARE occupied TINYINT UNSIGNED;
  DECLARE available TINYINT UNSIGNED;
  DECLARE room_cur CURSOR FOR SELECT _id, capacity FROM room;
  DECLARE CONTINUE HANDLER FOR NOT FOUND SET is_done = TRUE;
  DROP TEMPORARY TABLE IF EXISTS vacant_spaces;
  CREATE TEMPORARY TABLE vacant_spaces
    (room_id INT UNSIGNED, vacant TINYINT UNSIGNED);

  OPEN room_cur;

  /* Iterate over rooms to calculate available places */
  handle_rooms: LOOP
    FETCH room_cur INTO rm_i, rm_c;
    IF is_done THEN
      LEAVE handle_rooms;
    END IF;
    SELECT COUNT(*) FROM checkin
      WHERE room_id = rm_i AND target_date BETWEEN enter_date AND leave_date
      INTO occupied;
    SET available = rm_c - occupied;
    SELECT COUNT(*) FROM reservation
      WHERE room_id = rm_i AND target_date BETWEEN enter_date AND leave_date
      INTO occupied;
    SET available = available - occupied;
    INSERT INTO vacant_spaces(room_id, vacant)
      VALUE(rm_i, available);
  END LOOP;

  CLOSE room_cur;

  SELECT room_id, number, capacity, vacant
    FROM vacant_spaces JOIN room ON vacant_spaces.room_id = room._id
    ORDER BY vacant DESC;
  SELECT SUM(vacant) FROM vacant_spaces INTO places;
END//

DELIMITER ;

CALL GetVacantPlaces('2024-11-22', @places);
SELECT @places AS "Общее количество свободных мест";

DROP PROCEDURE GetVacantPlaces;
```
&thinsp;
<details>
<summary><b>Выполнение запроса</b></summary>

```
mysql> DELIMITER //
mysql> CREATE PROCEDURE GetVacantPlaces(IN target_date DATE, OUT places INT UNSIGNED)
    -> COMMENT 'Displays the list of vacant places in rooms on a given date'
    -> BEGIN   DECLARE is_done BOOL DEFAULT FALSE;
    -> DECLARE rm_i INT UNSIGNED;   DECLARE rm_c TINYINT UNSIGNED;
    -> DECLARE occupied TINYINT UNSIGNED;   DECLARE available TINYINT UNSIGNED;
    -> DECLARE room_cur CURSOR FOR SELECT _id, capacity FROM room;
    -> DECLARE CONTINUE HANDLER FOR NOT FOUND SET is_done = TRUE;
    -> DROP TEMPORARY TABLE IF EXISTS vacant_spaces;
    -> CREATE TEMPORARY TABLE vacant_spaces (room_id INT UNSIGNED, vacant TINYINT UNSIGNED);
    -> OPEN room_cur;
    -> handle_rooms: LOOP
    -> FETCH room_cur INTO rm_i, rm_c;
    -> IF is_done THEN       LEAVE handle_rooms;
    -> END IF;
    -> SELECT COUNT(*) FROM checkin WHERE room_id = rm_i AND target_date BETWEEN enter_date AND leave_date
    -> INTO occupied;     SET available = rm_c - occupied;
    -> SELECT COUNT(*) FROM reservation WHERE room_id = rm_i AND target_date BETWEEN enter_date AND leave_date
    -> INTO occupied;     SET available = available - occupied;
    -> INSERT INTO vacant_spaces(room_id, vacant)       VALUE(rm_i, available);
    -> END LOOP;
    -> CLOSE room_cur;
    -> SELECT room_id, number, capacity, vacant
    -> FROM vacant_spaces JOIN room ON vacant_spaces.room_id = room._id     ORDER BY vacant DESC;
    -> SELECT SUM(vacant) FROM vacant_spaces INTO places;
    -> END//
Query OK, 0 rows affected (0.00 sec)

mysql> DELIMITER ;
mysql> CALL GetVacantPlaces('2024-11-22', @places);
+---------+--------+----------+--------+
| room_id | number | capacity | vacant |
+---------+--------+----------+--------+
|      15 | 6      |        6 |      6 |
|      11 | 707    |        5 |      5 |
|       5 | 4      |        4 |      4 |
|       9 | 11     |        4 |      4 |
|      12 | 555    |        4 |      4 |
|      16 | 45     |        4 |      4 |
|       3 | 506    |        3 |      3 |
|       7 | 123    |        3 |      3 |
|      17 | 65     |        3 |      3 |
|      19 | 78     |        3 |      3 |
|       1 | 213    |        2 |      2 |
|       2 | 303    |        2 |      2 |
|      13 | 128    |        2 |      2 |
|      14 | 754    |        2 |      2 |
|      20 | 23     |        2 |      2 |
|      22 | 20     |        2 |      2 |
|       4 | 225    |        1 |      1 |
|       6 | 202    |        1 |      1 |
|       8 | 101    |        1 |      1 |
|      18 | 12     |        1 |      1 |
|      21 | 7      |        1 |      1 |
|      10 | 5      |        5 |      0 |
+---------+--------+----------+--------+
22 rows in set (0.01 sec)

Query OK, 1 row affected (0.06 sec)

mysql> SELECT @places AS "Общее количество свободных мест";
+---------------------------------+
| Общее количество свободных мест |
+---------------------------------+
|                              56 |
+---------------------------------+
1 row in set (0.00 sec)

```

</details>

### 3.2 Задача 2
Создать курсор внутри хранимой процедуры. Созданная процедура позволяет определить общий срок пребывания заданного клиента в указанном номере, который выводится в выходной параметр. Идентификаторы клиента и номера задаются входными параметрами. Если номер не указан, то помимо общего срока длительность пребывания вычисляется отдельно для каждого из номеров, в которые происходило заселение. Если идентификатор клиента не задан, то помимо общего срока длительность определяется отдельно для каждого из клиентов.

```sql
DELIMITER //

CREATE PROCEDURE GetStayDuration(IN target_client INT UNSIGNED, IN target_room INT UNSIGNED, OUT total_days SMALLINT UNSIGNED)
COMMENT 'Display clients stay duration in any given room'
BEGIN
  DECLARE done INT DEFAULT 0;
  DECLARE cl_i INT UNSIGNED;
  DECLARE rm_i INT UNSIGNED;
  DECLARE days_qty SMALLINT UNSIGNED;
  DECLARE checkin_cur CURSOR FOR SELECT client_id, room_id,
    DATEDIFF(leave_date, enter_date) AS days_qty FROM checkin;
  DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
  DROP TEMPORARY TABLE IF EXISTS staying;
  CREATE TEMPORARY TABLE staying
    (client_id INT UNSIGNED, room_id INT UNSIGNED, stay SMALLINT UNSIGNED);

  OPEN checkin_cur;

  /* Iterate over checkins to calculate stay duration */
  REPEAT
    FETCH checkin_cur INTO cl_i, rm_i, days_qty;
    IF NOT done THEN
      INSERT INTO staying(client_id, room_id, stay)
      VALUE(cl_i, rm_i, days_qty);
    END IF;
  UNTIL done END REPEAT;

  CLOSE checkin_cur;

  SELECT client_id, room_id, SUM(stay) AS duration FROM staying
    WHERE client_id = IFNULL(target_client, client_id)
      AND room_id = IFNULL(target_room, room_id)
    GROUP BY client_id, room_id ORDER BY client_id, room_id;
  SELECT SUM(stay) FROM staying
    WHERE client_id = IFNULL(target_client, client_id)
      AND room_id = IFNULL(target_room, room_id)
    INTO total_days;

END//

DELIMITER ;

CALL GetStayDuration(1, 1, @days_total);
SELECT @days_total AS "Общая продолжительность пребывания в гостинице";

CALL GetStayDuration(1, NULL, @days_total);
SELECT @days_total AS "Общая продолжительность пребывания в гостинице";

CALL GetStayDuration(NULL, 1, @days_total);
SELECT @days_total AS "Общая продолжительность пребывания в гостинице";

CALL GetStayDuration(NULL, NULL, @days_total);
SELECT @days_total AS "Общая продолжительность пребывания в гостинице";

DROP PROCEDURE GetStayDuration;

CASE
    WHEN target_client IS NOT NULL AND target_room IS NOT NULL THEN
      SELECT client_id, room_id, SUM(stay) AS duration FROM staying
        WHERE client_id = target_client AND room_id = target_room
        GROUP BY client_id, room_id
        ORDER BY client_id, room_id;
      SELECT SUM(stay) FROM staying
        WHERE client_id = target_client AND room_id = target_room
        INTO total_days;
    WHEN target_client IS NOT NULL AND target_room IS NULL THEN
      SELECT client_id, room_id, SUM(stay) AS duration FROM staying
        WHERE client_id = target_client
        GROUP BY client_id, room_id
        ORDER BY client_id, room_id;
      SELECT SUM(stay) FROM staying
        WHERE client_id = target_client
        INTO total_days;
    WHEN target_client IS NULL AND target_room IS NOT NULL THEN
    SELECT client_id, room_id, SUM(stay) AS duration FROM staying
        WHERE room_id = target_room
        GROUP BY client_id, room_id
        ORDER BY client_id, room_id;
      SELECT SUM(stay) FROM staying
        WHERE room_id = target_room
        INTO total_days;
    ELSE
      SELECT client_id, room_id, SUM(stay) AS duration FROM staying
        GROUP BY client_id, room_id
        ORDER BY client_id, room_id;
      SELECT SUM(stay) FROM staying
        INTO total_days;
  END CASE;

```

<details>
<summary><b>Выполнение запроса</b></summary>

```
mysql> DELIMITER //
mysql> CREATE PROCEDURE GetStayDuration(IN target_client INT UNSIGNED, IN target_room INT UNSIGNED, OUT total_days SMALLINT UNSIGNED)
    -> COMMENT 'Display clients stay duration in any given room'
    -> BEGIN
    -> DECLARE done INT DEFAULT 0;
    -> DECLARE cl_i INT UNSIGNED;
    -> DECLARE rm_i INT UNSIGNED;
    -> DECLARE days_qty SMALLINT UNSIGNED;
    -> DECLARE checkin_cur CURSOR FOR SELECT client_id, room_id, DATEDIFF(leave_date, enter_date) AS days_qty FROM checkin;
    -> DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
    -> DROP TEMPORARY TABLE IF EXISTS staying;
    -> CREATE TEMPORARY TABLE staying (client_id INT UNSIGNED, room_id INT UNSIGNED, stay SMALLINT UNSIGNED);
    -> OPEN checkin_cur;
    -> /* Iterate over checkins to calculate stay duration */
    -> REPEAT
    -> FETCH checkin_cur INTO cl_i, rm_i, days_qty;
    -> IF NOT done THEN
    -> INSERT INTO staying(client_id, room_id, stay) VALUE(cl_i, rm_i, days_qty);
    -> END IF;
    -> UNTIL done END REPEAT;
    -> CLOSE checkin_cur;
    -> SELECT client_id, room_id, SUM(stay) AS duration FROM staying
    -> WHERE client_id = IFNULL(target_client, client_id) AND room_id = IFNULL(target_room, room_id)
    -> GROUP BY client_id, room_id ORDER BY client_id, room_id;
    -> SELECT SUM(stay) FROM staying
    -> WHERE client_id = IFNULL(target_client, client_id) AND room_id = IFNULL(target_room, room_id)
    -> INTO total_days;
    -> END//
Query OK, 0 rows affected (0.00 sec)

mysql> DELIMITER ;
mysql> CALL GetStayDuration(1, 1, @days_total);
+-----------+---------+----------+
| client_id | room_id | duration |
+-----------+---------+----------+
|         1 |       1 |       48 |
+-----------+---------+----------+
1 row in set (0.01 sec)

Query OK, 1 row affected (0.02 sec)

mysql> SELECT @days_total AS "Общая продолжительность пребывания в гостинице";
+------------------------------------------------+
| Общая продолжительность пребывания в гостинице |
+------------------------------------------------+
|                                             48 |
+------------------------------------------------+
1 row in set (0.00 sec)

mysql> CALL GetStayDuration(1, NULL, @days_total);
+-----------+---------+----------+
| client_id | room_id | duration |
+-----------+---------+----------+
|         1 |       1 |       48 |
|         1 |      10 |        3 |
+-----------+---------+----------+
2 rows in set (0.00 sec)

Query OK, 1 row affected (0.01 sec)

mysql> SELECT @days_total AS "Общая продолжительность пребывания в гостинице";
+------------------------------------------------+
| Общая продолжительность пребывания в гостинице |
+------------------------------------------------+
|                                             51 |
+------------------------------------------------+
1 row in set (0.00 sec)

mysql> CALL GetStayDuration(NULL, 1, @days_total);
+-----------+---------+----------+
| client_id | room_id | duration |
+-----------+---------+----------+
|         1 |       1 |       48 |
|        10 |       1 |       24 |
+-----------+---------+----------+
2 rows in set (0.00 sec)

Query OK, 1 row affected (0.01 sec)

mysql> SELECT @days_total AS "Общая продолжительность пребывания в гостинице";
+------------------------------------------------+
| Общая продолжительность пребывания в гостинице |
+------------------------------------------------+
|                                             72 |
+------------------------------------------------+
1 row in set (0.00 sec)

mysql> CALL GetStayDuration(NULL, NULL, @days_total);
+-----------+---------+----------+
| client_id | room_id | duration |
+-----------+---------+----------+
|         1 |       1 |       48 |
|         1 |      10 |        3 |
|         2 |       2 |      405 |
|         2 |      10 |        3 |
|         3 |       3 |       14 |
|         3 |      10 |        3 |
|         4 |       4 |       28 |
|         4 |      10 |        3 |
|         5 |      10 |        3 |
|         5 |      11 |        2 |
|         6 |       6 |       24 |
|         6 |      10 |        2 |
|         7 |      10 |        2 |
|         8 |      10 |        2 |
|         9 |      10 |       18 |
|        10 |       1 |       24 |
|        10 |      10 |        2 |
|        11 |       5 |        4 |
|        11 |      10 |        3 |
|        12 |       5 |        8 |
|        12 |      10 |        3 |
|        13 |       2 |       45 |
|        13 |      10 |        3 |
|        14 |       7 |       26 |
|        14 |      10 |        3 |
|        15 |       8 |       67 |
|        15 |      10 |        3 |
|        16 |       9 |       28 |
|        16 |      10 |        5 |
|        17 |      10 |      423 |
|        18 |       7 |       24 |
|        18 |      10 |        5 |
|        19 |      10 |        5 |
|        20 |      10 |        5 |
|        20 |      11 |       46 |
|        22 |      18 |       21 |
|        23 |      13 |      116 |
|        23 |      14 |       20 |
|        24 |      11 |       39 |
+-----------+---------+----------+
39 rows in set (0.00 sec)

Query OK, 1 row affected (0.08 sec)

mysql> SELECT @days_total AS "Общая продолжительность пребывания в гостинице";
+------------------------------------------------+
| Общая продолжительность пребывания в гостинице |
+------------------------------------------------+
|                                           1488 |
+------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

## Работа 27.O «Выполнение и отмена транзакций»

### 3.1 Задача 1
Создать транзакцию внутри хранимой процедуры. Созданная процедура позволяет добавить запись о новом поселений на указанную входящими параметрами дату, продолжительность пребывания, идентификатор номера и идентификатор клиента. При наличии свободных мест в указанном номере (исходя из данных о поселениях и бронях) на весь период предполагаемого пребывания сформированная запись окончательно фиксируется в базе данных, при отсутствии — операция отменяется. При успешном добавлении в выходной параметр выводится идентификатор добавленной записи, при откате транзакции — значение NULL.

```sql
DELIMITER //

CREATE PROCEDURE AddCheckin(
  IN begin_date DATE, IN duration_days SMALLINT UNSIGNED,
  IN target_client INT UNSIGNED, IN target_room INT,
  OUT result_id INT UNSIGNED
)
COMMENT 'Insert a new checkin record if the target room has a vacant place'
BEGIN
  DECLARE end_date DATE;
  DECLARE available TINYINT UNSIGNED;
  DECLARE busy_check TINYINT UNSIGNED;
  DECLARE busy_res TINYINT UNSIGNED;
  DECLARE occupied TINYINT UNSIGNED;

  SET AUTOCOMMIT=0;
  SET end_date = DATE_ADD(begin_date, INTERVAL duration_days DAY);
  SET available = (SELECT capacity FROM room WHERE _id = target_room);
  SET busy_check = (
    SELECT COUNT(*) FROM checkin WHERE room_id = target_room AND
    ((begin_date < enter_date AND end_date > enter_date)
    OR (begin_date >= enter_date AND begin_date < leave_date)
  ));
  SET busy_res = (
    SELECT COUNT(*) FROM reservation WHERE room_id = target_room AND
    ((begin_date < enter_date AND end_date > enter_date)
    OR (begin_date >= enter_date AND begin_date < leave_date)
  ));
  SET occupied = busy_check + busy_res;
  INSERT INTO checkin(enter_date, leave_date, room_id, client_id)
    VALUE(begin_date, end_date, target_room, target_client);
  SELECT * FROM checkin ORDER BY _id DESC LIMIT 1;
  IF (occupied < available)
    THEN SET result_id = (SELECT _id FROM checkin ORDER BY _id DESC LIMIT 1);
      /* alternative */
      SELECT _id FROM checkin ORDER BY _id DESC LIMIT 1 INTO result_id;
      COMMIT;
    ELSE SET result_id = NULL;
      ROLLBACK;
  END IF;
END//

DELIMITER ;

CALL AddCheckin('2024-11-25', 20, 40, 10, @res);
SELECT @res AS "Номер добавленной записи";
SELECT * FROM checkin ORDER BY _id DESC LIMIT 1;

CALL AddCheckin('2024-11-25', 20, 40, 11, @res);
SELECT @res AS "Номер добавленной записи";
SELECT * FROM checkin ORDER BY _id DESC LIMIT 1;

CALL AddCheckin('2024-11-25', 20, 40, 10, @res);
SELECT @res AS "Номер добавленной записи";
SELECT * FROM checkin ORDER BY _id DESC LIMIT 1;

DROP PROCEDURE AddCheckin;
```
&thinsp;
<details>
<summary><b>Выполнение запроса</b></summary>

```
mysql> DELIMITER //
mysql> CREATE PROCEDURE AddCheckin(   IN begin_date DATE, IN duration_days SMALLINT UNSIGNED,
    -> IN target_client INT UNSIGNED, IN target_room INT,   OUT result_id INT UNSIGNED )
    -> COMMENT 'Insert a new checkin record if the target room has a vacant place'
    -> BEGIN   DECLARE end_date DATE;
    -> DECLARE available TINYINT UNSIGNED;   DECLARE busy_check TINYINT UNSIGNED;
    -> DECLARE busy_res TINYINT UNSIGNED;   DECLARE occupied TINYINT UNSIGNED;
    -> SET AUTOCOMMIT=0;
    -> SET end_date = DATE_ADD(begin_date, INTERVAL duration_days DAY);
    -> SET available = (SELECT capacity FROM room WHERE _id = target_room);
    -> SET busy_check = (
    -> SELECT COUNT(*) FROM checkin WHERE room_id = target_room AND
    -> ((begin_date < enter_date AND end_date > enter_date)
    -> OR (begin_date >= enter_date AND begin_date < leave_date)   ));
    -> SET busy_res = (
    -> SELECT COUNT(*) FROM reservation WHERE room_id = target_room AND
    -> ((begin_date < enter_date AND end_date > enter_date)
    -> OR (begin_date >= enter_date AND begin_date < leave_date)   ));
    -> SET occupied = busy_check + busy_res;
    -> INSERT INTO checkin(enter_date, leave_date, room_id, client_id)
    -> VALUE(begin_date, end_date, target_room, target_client);
    -> SELECT * FROM checkin ORDER BY _id DESC LIMIT 1;
    -> IF (occupied < available)
    -> THEN SET result_id = (SELECT _id FROM checkin ORDER BY _id DESC LIMIT 1); COMMIT;
    -> ELSE SET result_id = NULL;       ROLLBACK;
    -> END IF;
    -> END//
Query OK, 0 rows affected (0.00 sec)

mysql> DELIMITER ;
mysql> CALL AddCheckin('2024-11-25', 20, 40, 10, @res);
+-----+---------------------+------------+------------+---------+-----------+
| _id | date_ts             | enter_date | leave_date | room_id | client_id |
+-----+---------------------+------------+------------+---------+-----------+
|  47 | 2024-11-25 23:37:59 | 2024-11-25 | 2024-12-15 |      10 |        40 |
+-----+---------------------+------------+------------+---------+-----------+
1 row in set (0.00 sec)

Query OK, 0 rows affected (0.01 sec)

mysql> SELECT @res AS "Номер добавленной записи";
+--------------------------+
| Номер добавленной записи |
+--------------------------+
|                     NULL |
+--------------------------+
1 row in set (0.00 sec)

mysql> SELECT * FROM checkin ORDER BY _id DESC LIMIT 1;
+-----+---------------------+------------+------------+---------+-----------+
| _id | date_ts             | enter_date | leave_date | room_id | client_id |
+-----+---------------------+------------+------------+---------+-----------+
|  44 | 2024-11-22 23:55:25 | 2023-11-22 | 2023-11-24 |      11 |         5 |
+-----+---------------------+------------+------------+---------+-----------+
1 row in set (0.00 sec)

mysql> CALL AddCheckin('2024-11-25', 20, 40, 11, @res);
+-----+---------------------+------------+------------+---------+-----------+
| _id | date_ts             | enter_date | leave_date | room_id | client_id |
+-----+---------------------+------------+------------+---------+-----------+
|  48 | 2024-11-25 23:38:12 | 2024-11-25 | 2024-12-15 |      11 |        40 |
+-----+---------------------+------------+------------+---------+-----------+
1 row in set (0.00 sec)

Query OK, 0 rows affected (0.01 sec)

mysql> SELECT @res AS "Номер добавленной записи";
+--------------------------+
| Номер добавленной записи |
+--------------------------+
|                       48 |
+--------------------------+
1 row in set (0.00 sec)

mysql> SELECT * FROM checkin ORDER BY _id DESC LIMIT 1;
+-----+---------------------+------------+------------+---------+-----------+
| _id | date_ts             | enter_date | leave_date | room_id | client_id |
+-----+---------------------+------------+------------+---------+-----------+
|  48 | 2024-11-25 23:38:12 | 2024-11-25 | 2024-12-15 |      11 |        40 |
+-----+---------------------+------------+------------+---------+-----------+
1 row in set (0.00 sec)

```

</details>
