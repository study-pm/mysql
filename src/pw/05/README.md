# Практическая работа 4.2. Разработка серверной части данных в СУБД MySQL. Создание индексов (простых, уникальных)

- [1. Цель работы](#1-цель-работы)
- [2. Условия задач](#2-условия-задач)
- [3. Решение задач](#3-решение-задач)
  - [3.1 Задача 1](#31-задача-1)
- [Заключение](#заключение)

## 1. Цель работы
- изучить cтруктуры данных СУБД, общий подход к организации представлений, таблиц, индексов и кластеров;
- сформировать умение создавать объекты баз данных в современных СУБД.

## 2. Условия задач
1) Создать простые и уникальные индексы для своих таблиц (не менее пяти).

## 3. Решение задач

### 3.1 Задача 1
Создать простые и уникальные индексы для своих таблиц (не менее пяти). Листинги 1, 2, 3, 4 демонстрируют скрипты запросов на создание индексов. Рисунки  1, 2, 3, 4 иллюстрируют результаты выполнения запросов.

*[Листинг 1 – Команда создания уникального индекса для таблицы КОМФОРТАБЕЛЬНОСТЬ](./01.sql)*
```sql
CREATE UNIQUE INDEX type_name ON comfort (type_name);
```

```
mysql> CREATE UNIQUE INDEX type_name ON comfort (type_name);
Query OK, 0 rows affected (0.09 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESCRIBE hotel;
ERROR 1146 (42S02): Table 'hotel.hotel' doesn't exist
mysql> DESCRIBE comfort;
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| _id       | int unsigned | NO   | PRI | NULL    | auto_increment |
| type_name | varchar(10)  | NO   | UNI | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
2 rows in set (0.00 sec)

mysql> SHOW CREATE TABLE comfort;
+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table   | Create Table
         |
+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| comfort | CREATE TABLE `comfort` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `type_name` varchar(10) NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `type_name` (`type_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

*Рисунок 1 – Создание уникального индекса для таблицы КОМФОРТАБЕЛЬНОСТЬ*

*[Листинг 2 – Команда добавления простого и уникального индексов для таблицы КЛИЕНТЫ](./02.sql)*
```sql
ALTER TABLE	client
	ADD INDEX (last_name),
	ADD UNIQUE INDEX (passport_number)
	;
```

```
mysql> ALTER TABLE client
    -> ADD INDEX (last_name),
    -> ADD UNIQUE INDEX (passport_number)
    -> ;
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESCRIBE client;
+-----------------+--------------+------+-----+---------+----------------+
| Field           | Type         | Null | Key | Default | Extra          |
+-----------------+--------------+------+-----+---------+----------------+
| _id             | int unsigned | NO   | PRI | NULL    | auto_increment |
| last_name       | varchar(20)  | NO   | MUL | NULL    |                |
| first_name      | varchar(20)  | NO   |     | NULL    |                |
| second_name     | varchar(20)  | NO   |     | NULL    |                |
| passport_number | char(10)     | NO   | UNI | NULL    |                |
| birth_date      | date         | NO   |     | NULL    |                |
| address         | varchar(100) | YES  |     | NULL    |                |
| comment         | text         | YES  |     | NULL    |                |
+-----------------+--------------+------+-----+---------+----------------+
8 rows in set (0.00 sec)

mysql> SHOW CREATE TABLE client;
+--------+---------------------------------------------------------------------
-------------------------------------------------------------------------------
--------------+
| Table  | Create Table

              |
+--------+---------------------------------------------------------------------
-------------------------------------------------------------------------------
--------------+
| client | CREATE TABLE `client` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `last_name` varchar(20) NOT NULL,
  `first_name` varchar(20) NOT NULL,
  `second_name` varchar(20) NOT NULL,
  `passport_number` char(10) NOT NULL,
  `birth_date` date NOT NULL,
  `address` varchar(100) DEFAULT NULL,
  `comment` text,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `passport_number` (`passport_number`),
  KEY `last_name` (`last_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+--------+---------------------------------------------------------------------
-------------------------------------------------------------------------------
--------------+
1 row in set (0.00 sec)
```

*Рисунок 2 – Добавление простого и уникального индекса для таблицы КЛИЕНТЫ*

*[Листинг 3 – Команда создания простых индексов для таблицы БРОНИ](./03.sql)*
```sql
CREATE INDEX enter_date ON reservation (enter_date DESC);
CREATE INDEX leave_date ON reservation (leave_date DESC);
```

```
mysql> CREATE INDEX enter_date ON reservation (enter_date DESC);
Query OK, 0 rows affected (0.00 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> CREATE INDEX leave_date ON reservation (leave_date DESC);
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESCRIBE reservation;
+------------+--------------+------+-----+-------------------+-------------------+
| Field      | Type         | Null | Key | Default           | Extra             |
+------------+--------------+------+-----+-------------------+-------------------+
| _id        | int unsigned | NO   | PRI | NULL              | auto_increment    |
| date_ts    | timestamp    | NO   |     | CURRENT_TIMESTAMP | DEFAULT_GENERATED |
| enter_date | date         | NO   | MUL | NULL              |                   |
| leave_date | date         | NO   | MUL | NULL              |                   |
| room_id    | int unsigned | NO   |     | NULL              |                   |
| client_id  | int unsigned | NO   |     | NULL              |                   |
+------------+--------------+------+-----+-------------------+-------------------+
6 rows in set (0.00 sec)

mysql> SHOW INDEXES FROM reservation;
+-------------+------------+------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
| Table       | Non_unique | Key_name   | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |
+-------------+------------+------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
| reservation |          0 | PRIMARY    |            1 | _id         | A         |           0 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
| reservation |          1 | enter_date |            1 | enter_date  | D         |           0 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
| reservation |          1 | leave_date |            1 | leave_date  | D         |           0 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
+-------------+------------+------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
3 rows in set (0.00 sec)

mysql> SHOW CREATE TABLE reservation;
+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table       | Create Table
                                                                                                                                                                                                                   |
+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| reservation | CREATE TABLE `reservation` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `date_ts` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `enter_date` date NOT NULL,
  `leave_date` date NOT NULL,
  `room_id` int unsigned NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  KEY `enter_date` (`enter_date` DESC),
  KEY `leave_date` (`leave_date` DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

*Рисунок 3 – Создание простых индексов для таблицы БРОНИ*

*[Листинг 4 – Команда добавления простых индексов для таблицы ПОСЕЛЕНИЯ](./04.sql)*
```sql
ALTER TABLE checkin
	ADD INDEX (enter_date DESC),
	ADD INDEX (leave_date DESC)
	;
```

```
mysql> ALTER TABLE  checkin
    -> ADD INDEX (enter_date DESC),
    -> ADD INDEX (leave_date DESC)
    -> ;
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW COLUMNS FROM checkin;
+------------+--------------+------+-----+-------------------+-------------------+
| Field      | Type         | Null | Key | Default           | Extra             |
+------------+--------------+------+-----+-------------------+-------------------+
| _id        | int unsigned | NO   | PRI | NULL              | auto_increment    |
| date_ts    | timestamp    | NO   |     | CURRENT_TIMESTAMP | DEFAULT_GENERATED |
| enter_date | date         | NO   | MUL | NULL              |                   |
| leave_date | date         | NO   | MUL | NULL              |                   |
| room_id    | int unsigned | NO   |     | NULL              |                   |
| client_id  | int unsigned | NO   |     | NULL              |                   |
+------------+--------------+------+-----+-------------------+-------------------+
6 rows in set (0.00 sec)

mysql> SHOW INDEX FROM checkin;
+---------+------------+------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
| Table   | Non_unique | Key_name   | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |
+---------+------------+------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
| checkin |          0 | PRIMARY    |            1 | _id         | A         |           0 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
| checkin |          1 | enter_date |            1 | enter_date  | D         |           0 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
| checkin |          1 | leave_date |            1 | leave_date  | D         |           0 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
+---------+------------+------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
3 rows in set (0.00 sec)


mysql> SHOW CREATE TABLE checkin;
+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table   | Create Table
                                                                                                                                                                                                           |
+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| checkin | CREATE TABLE `checkin` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `date_ts` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `enter_date` date NOT NULL,
  `leave_date` date NOT NULL,
  `room_id` int unsigned NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  KEY `enter_date` (`enter_date` DESC),
  KEY `leave_date` (`leave_date` DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

*Рисунок 4 – Добавление простых индексов для таблицы ПОСЕЛЕНИЯ*

<details>
<summary><em>Создание уникального индекса для таблицы НОМЕРА</em></summary>

```
mysql> ALTER TABLE room ADD UNIQUE INDEX (phone_number);
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESCRIBE room;
+--------------+------------------+------+-----+---------+----------------+
| Field        | Type             | Null | Key | Default | Extra          |
+--------------+------------------+------+-----+---------+----------------+
| _id          | int unsigned     | NO   | PRI | NULL    | auto_increment |
| number       | varchar(10)      | NO   | UNI | NULL    |                |
| capacity     | tinyint unsigned | NO   |     | NULL    |                |
| price        | decimal(8,2)     | NO   |     | NULL    |                |
| phone_number | varchar(10)      | NO   | UNI | NULL    |                |
| comfort_id   | int unsigned     | NO   |     | NULL    |                |
+--------------+------------------+------+-----+---------+----------------+
6 rows in set (0.00 sec)

mysql> SHOW CREATE TABLE room;
+-------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table
                                                                                                                                                                                               |
+-------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| room  | CREATE TABLE `room` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `number` varchar(10) NOT NULL,
  `capacity` tinyint unsigned NOT NULL,
  `price` decimal(8,2) NOT NULL,
  `phone_number` varchar(10) NOT NULL,
  `comfort_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `number` (`number`),
  UNIQUE KEY `phone_number` (`phone_number`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)
```

</details>


<details>
<summary><em>Создание уникального индекса для таблицы СКИДКИ</em></summary>

```
mysql> ALTER TABLE discount ADD UNIQUE INDEX (category_name);
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW COLUMNS FROM discount;
+---------------+--------------+------+-----+---------+----------------+
| Field         | Type         | Null | Key | Default | Extra          |
+---------------+--------------+------+-----+---------+----------------+
| _id           | int unsigned | NO   | PRI | NULL    | auto_increment |
| category_name | varchar(30)  | NO   | UNI | NULL    |                |
| value         | decimal(3,2) | NO   |     | NULL    |                |
+---------------+--------------+------+-----+---------+----------------+
3 rows in set (0.00 sec)

mysql> SHOW CREATE TABLE discount;
+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table    | Create Table
                                                        |
+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| discount | CREATE TABLE `discount` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `category_name` varchar(30) NOT NULL,
  `value` decimal(3,2) NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `category_name` (`category_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

<details>
<summary><em>Создание уникального индекса для таблицы ТЕЛЕФОНЫ</em></summary>

```
mysql> CREATE UNIQUE INDEX phone_number ON phone(number);
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESCRIBE phone;
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| _id       | int unsigned | NO   | PRI | NULL    | auto_increment |
| number    | char(10)     | NO   | UNI | NULL    |                |
| client_id | int unsigned | NO   |     | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
3 rows in set (0.00 sec)

mysql> SHOW CREATE TABLE phone;
+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table
                                    |
+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| phone | CREATE TABLE `phone` (
  `_id` int unsigned NOT NULL AUTO_INCREMENT,
  `number` char(10) NOT NULL,
  `client_id` int unsigned NOT NULL,
  PRIMARY KEY (`_id`),
  UNIQUE KEY `phone_number` (`number`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

</details>

## Заключение
По итогам работы были изучены cтруктуры данных СУБД, общий подход к организации представлений, таблиц, индексов и кластеров, сформировано умение создавать объекты баз данных в современных СУБД. В ходе работы были cозданы простые и уникальные индексы для своих таблиц.
